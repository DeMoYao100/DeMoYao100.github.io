<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="Moyao の小屋" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Moyao の小屋" type="application/atom+xml"><link rel="alternate" type="application/json" title="Moyao の小屋" href="https://demoyao100.github.io/feed.json"/><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.2"><link rel="modulepreload" href="/js/chunk-346TEOXD.js"></link><link rel="modulepreload" href="/js/chunk-QA6RGM2S.js"></link><link rel="modulepreload" href="/js/chunk-QAWHJ5B3.js"></link><link rel="modulepreload" href="/js/index.esm-SMPOVEZ5.js"></link><link rel="modulepreload" href="/js/post-H6TTLEOZ.js"></link><link rel="modulepreload" href="/js/quicklink-RU6FD7L7.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1giciszlczyj20zk0m816d.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicis3attqj20zk0m8k7l.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1giciryrr3rj20zk0m8nhk.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicit4jrvuj20zk0m8785.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicitcxhpij20zk0m8hdt.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg" as="image" fetchpriority="high"><meta name="keywords" content="ctf,"/><meta name="description" content="&lt;h6 id=&quot;some-reverse-questions-i-didnt-have-time-to-solve-or-didnt-solve-out&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#some-reverse-questions-i-didnt-have-time-to-solve-or-didnt-solve-out&quot;&gt;#&lt;/a&gt; Some reverse questions I didn’t have time to solve. (Or didn’t solve out…)&lt;/h6&gt;"/><link rel="canonical" href="https://demoyao100.github.io/2022/11/02/hnctfRe/"><title>hnctfRe</title><meta name="generator" content="Hexo 7.0.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">hnctfRe</h1><div class="meta"><span class="item" title="Created: 2022-11-02 21:08:02"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">Posted on</span><time itemprop="dateCreated datePublished" datetime="2022-11-02T21:08:02+08:00">2022-11-02</time></span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i></span><span class="text">Symbols count in article</span><span>16k</span><span class="text">words</span></span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i></span><span class="text">Reading time</span><span>14 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">testName</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1giciszlczyj20zk0m816d.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicis3attqj20zk0m8k7l.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1giciryrr3rj20zk0m8nhk.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicit4jrvuj20zk0m8785.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicitcxhpij20zk0m8hdt.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">Home</a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="en"><link itemprop="mainEntityOfPage" href="https://demoyao100.github.io/2022/11/02/hnctfRe/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="Moyao"/><meta itemprop="description" content="Hi,I'm Moyao, Write down something interesting I met
feel free to mail me if you have something wanted to talk about
mail: &amp;lt;moyaoxue@outlook.com&amp;gt;
"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Moyao の小屋"/></span><div class="body md" itemprop="articleBody"><h6 id="some-reverse-questions-i-didnt-have-time-to-solve-or-didnt-solve-out"><a class="markdownIt-Anchor" href="#some-reverse-questions-i-didnt-have-time-to-solve-or-didnt-solve-out">#</a> Some reverse questions I didn’t have time to solve. (Or didn’t solve out…)</h6>
<span id="more"></span>
<h3 id="help_me"><a class="markdownIt-Anchor" href="#help_me">#</a> Help_Me!</h3>
<h5 id="my-exp"><a class="markdownIt-Anchor" href="#my-exp">#</a> My exp:</h5>
<pre><code>#include&lt;bits/stdc++.h&gt;
using namespace std;
int v12[1000]=&#123;0&#125;;
int v13[1000]=&#123;0&#125;;
long long maxn;
int v[1000];
void dfs(int cns,int n,int num,long long sum)&#123;
    if (num&gt;200 || n==20)
    &#123;
        if (n!=20)
        sum-=v12[n];
        cns--;
        if (sum&gt;=maxn)&#123;
            maxn=sum;
            cout&lt;&lt;&quot;sum  =  &quot;&lt;&lt;sum&lt;&lt;&quot;    :  &quot;&lt;&lt;&quot;cns=&quot;&lt;&lt;cns&lt;&lt;&quot;   &quot;;
            for (int i=0;i&lt;cns;i++)&#123;
                cout&lt;&lt;v[i]&lt;&lt;&quot; &quot;;
            &#125;
            cout&lt;&lt;endl;
        &#125;
        return ;
    &#125;
    
    for (int i=n+1;i&lt;=20;i++)&#123;
        v[cns]=i;
        
        dfs(cns+1,i,num+v13[i],sum+v12[i]);
    &#125;
&#125;


int main()&#123;
    
    v12[0] = 26;
    v12[1] = 59;
    v12[2] = 30;
    v12[3] = 19;
    v12[4] = 66;
    v12[5] = 85;
    v12[6] = 94;
    v12[7] = 8;
    v12[8] = 3;
    v12[9] = 44;
    v12[20] = 1000;
    v12[10] = 5;
    v12[11] = 1;
    v12[12] = 41;
    v12[13] = 82;
    v12[14] = 76;
    v12[15] = 1;
    v12[16] = 12;
    v12[17] = 81;
    v12[18] = 73;
    v12[19] = 32;
    v12[20]=1;
    v13[0] = 71;
    v13[1] = 34;
    v13[20] = 1000;
    v13[2] = 82;
    v13[3] = 23;
    v13[4] = 1;
    v13[5] = 88;
    v13[6] = 12;
    v13[7] = 57;
    v13[8] = 10;
    v13[9] = 68;
    v13[10] = 5;
    v13[11] = 33;
    v13[12] = 37;
    v13[13] = 69;
    v13[14] = 98;
    v13[15] = 24;
    v13[16] = 26;
    v13[17] = 83;
    v13[18] = 16;
    v13[19] = 26;
    v13[20]=1;
    maxn=0;
    dfs(0,-1,0,1);
&#125;
</code></pre>
<h5 id="official-exp"><a class="markdownIt-Anchor" href="#official-exp">#</a> Official exp:</h5>
<pre><code>#include &quot;iostream&quot;
#include &quot;stdio.h&quot;
using namespace std;
int val[50]=&#123;26, 59, 30, 19, 66, 85, 94, 8, 3, 44, 5, 1, 41, 82, 76, 1,    12,    81,    73,    32&#125;,
w[50]=&#123;71, 34, 82, 23, 1,88,12,57, 10, 68, 5, 33,    37,    69,    98,    24, 26,    83, 16, 26&#125;;
int dp[21][301];
int main()
&#123;
    int t=200;
    int m = 20;
    for(int i=1;i&lt;=m;i++) 
        for(int j=t;j&gt;=0;j--)  
    &#123;
        if(j&gt;=w[i])//容量可以放 
        &#123;
            int tmp;
            dp[i][j]=max(dp[i-1][j-w[i]]+val[i],dp[i-1][j]);
        &#125;  
        else
        &#123;
            dp[i][j]=dp[i-1][j];
        &#125;              
    &#125;
    //dp[i][j] = max(dp[i-1][j-w[i]]+val[i],dp[i-1][j]);
    int x = 20;
    int y = 200;
    while(x!=0)
    &#123;
        if(dp[x-1][y-w[x]]+val[x] &gt; dp[x-1][y])        
        &#123;
            printf(&quot;%d,&quot;,x); 
            y-=w[x];
        &#125;
        x-=1;
    &#125;
    return 0;
&#125;
</code></pre>
<p>A 0-1 bag problem. And notice that you should <c style="color: #FF0000;">ADD</c> v12, not MULTIPLY, like in the ida…</p>
<h3 id="cm2"><a class="markdownIt-Anchor" href="#cm2">#</a> CM2</h3>
<h6 id="dont-understand-how-to-debug-to-find-the-place-though-by-guessing-i-work-it-out-anyway"><a class="markdownIt-Anchor" href="#dont-understand-how-to-debug-to-find-the-place-though-by-guessing-i-work-it-out-anyway">#</a> Don’t understand how to debug to find the place… Though by guessing I work it out anyway.</h6>
<h5 id="officail-wp"><a class="markdownIt-Anchor" href="#officail-wp">#</a> Officail wp:</h5>
<p><img loading="lazy" data-src="hnctfRe/cm2.png" alt="cm2"></p>
<h3 id="try2debugplusplus"><a class="markdownIt-Anchor" href="#try2debugplusplus">#</a> Try2debugPlusPlus</h3>
<p>Nop the  <code>IsDebuggerPresent()</code> (noticed that there are two of them) and get the key(remember to set breakpoint after  <code>printf()</code> ):</p>
<p><img loading="lazy" data-src="hnctfRe/debug2_1.png" alt="debug2_1"></p>
<p>Though is easy for us to decrypt the tea_encrypt, question setter seems to have forgotten something…</p>
<p><img loading="lazy" data-src="hnctfRe/debug2_2.png" alt="debug2_2"></p>
<h3 id="what_1in_d11"><a class="markdownIt-Anchor" href="#what_1in_d11">#</a> What_1in_D11</h3>
<p>Repair the upx’s features(easy in this problem, to study more you can refer to <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-326995-1-1.html">this blog</a>)</p>
<p>And  <code>upx -d</code>  to unpacked the .dll, check it in ida, we got:</p>
<p><img loading="lazy" data-src="hnctfRe/dll_1.png" alt="dll"></p>
<h5 id="official-writeup"><a class="markdownIt-Anchor" href="#official-writeup">#</a> Official writeup:</h5>
<h6 id="a-btea-encrypt-which-i-am-not-fimilar-with-yet-shall-get-more-study-about-encryption-and-decryption-later"><a class="markdownIt-Anchor" href="#a-btea-encrypt-which-i-am-not-fimilar-with-yet-shall-get-more-study-about-encryption-and-decryption-later">#</a> (A btea encrypt, which I am not fimilar with yet. Shall get more study about encryption and decryption later.)</h6>
<pre><code>#include &lt;stdio.h&gt;  
#include &lt;stdint.h&gt;  
#define DELTA 0x9e3779b9  
#define MX (((z&gt;&gt;5^y&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))  
void btea(uint32_t *v, int n, uint32_t const key[4])  
&#123;  
    uint32_t y, z, sum;  
    unsigned p, rounds, e;  
    if (n &gt; 1)            /* Coding Part */  
    &#123;  
        rounds = 6 + 52/n;  
        sum = 0;  
        z = v[n-1];  
        do  
        &#123;  
            sum += DELTA;  
            e = (sum &gt;&gt; 2) &amp; 3;  
            for (p=0; p&lt;n-1; p++)  
            &#123;  
                y = v[p+1];  
                z = v[p] += MX;  
            &#125;  
            y = v[0];  
            z = v[n-1] += MX;  
        &#125;  
        while (--rounds);  
    &#125;  
    else if (n &lt; -1)      /* Decoding Part */  
    &#123;  
        n = -n;  
        rounds = 6 + 52/n;  
        sum = rounds*DELTA;  
        y = v[0];  
        do  
        &#123;  
            e = (sum &gt;&gt; 2) &amp; 3;  
            for (p=n-1; p&gt;0; p--)  
            &#123;  
                z = v[p-1];  
                y = v[p] -= MX;  
            &#125;  
            z = v[n-1];  
            y = v[0] -= MX;  
            sum -= DELTA;  
        &#125;  
        while (--rounds);  
    &#125;  
&#125;  
int main()  
&#123;  
    unsigned int enc[8]=&#123;0x22a577c1,0x1c12c03,0xc74c3ebd,0xa9d03c85,0xadb8ffb3&#125;;
    uint32_t const k[4]= &#123;55,66,77,88&#125;;  
    int n= 5; //n的绝对值表示v的长度，取正表示加密，取负表示解密  
    // v为要加密的数据是两个32位无符号整数  
    // k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位  
    btea(enc, -n, k);  
    for(int i=0;i&lt;5;i++)
    &#123;
            printf(&quot;%x&quot;,enc[i]);
        &#125;
    return 0;  
&#125;  
</code></pre>
<h3 id="mazes"><a class="markdownIt-Anchor" href="#mazes">#</a> Mazes</h3>
<h6 id="a-bit-complex-wait-until-later"><a class="markdownIt-Anchor" href="#a-bit-complex-wait-until-later">#</a> A bit complex, wait until later…</h6>
<h3 id="stub"><a class="markdownIt-Anchor" href="#stub">#</a> stub</h3>
<h6 id="never-seen-before-later"><a class="markdownIt-Anchor" href="#never-seen-before-later">#</a> Never seen before, later…</h6>
<h3 id="ez_maze"><a class="markdownIt-Anchor" href="#ez_maze">#</a> ez_maze</h3>
<p>We get a .exe file, from its’ icon we know that we should uncompile it to .pyc with  <code>pyinstxtractor</code></p>
<p><img loading="lazy" data-src="hnctfRe/ez_maze_1.png" alt="ez_maze"></p>
<p>Then, we got a package  <code>_extracted</code> :</p>
<h6 id="complex-it-is"><a class="markdownIt-Anchor" href="#complex-it-is">#</a> complex it is…</h6>
<p><img loading="lazy" data-src="hnctfRe/extracted.png" alt="extracted"></p>
<p>Find a file named  <code>maze</code>  (without a suffix one!) Change its suffix into  <code>.pyc</code>  and Try  <code>compyle6 -o maze.py maze.pyc</code> , it went wrong:</p>
<p><img loading="lazy" data-src="hnctfRe/uncompyle6.png" alt="compyle6"></p>
<p>That’s when you find out that pyinstxtractor didn’t fix your .pyc file’s magic number.</p>
<p><img loading="lazy" data-src="hnctfRe/cmakeInstall.png" alt="cmake"></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/231188.htm">The link problem setter gives you</a>, which does no help at all…The  <code>magic number</code>  of the file  <code>struct</code>  is destroy as well…</p>
<p><img loading="lazy" data-src="hnctfRe/magicNumber_1.jpg" alt="magicNumber_1"></p>
<p>I been trying tools like  <code>uncompyle6</code> (which does not support python 3.10, and install python 3.9 does not help at all. Later I should look into this problem and try to solved it…)  and  <code>pycdc</code> (which is said to support high edition, but can not identify the magic number as well) However, when I tried to add some magic number from other python edition(Python 3.8b2, if I remember it right), and put it in an <a target="_blank" rel="noopener" href="https://tool.lu/pyc/">online uncompiler</a>. It just worked…</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Here-is-SG/p/15885799.html">a blog from my classmate that may help(though I do not really think so…)</a></p>
</blockquote>
<h5 id="some-magic-number"><a class="markdownIt-Anchor" href="#some-magic-number">#</a> some magic number:</h5>
<pre><code>enum PycMagic &#123;
    MAGIC_1_0 = 0x00999902,
    MAGIC_1_1 = 0x00999903, /* Also covers 1.2 */
    MAGIC_1_3 = 0x0A0D2E89,
    MAGIC_1_4 = 0x0A0D1704,
    MAGIC_1_5 = 0x0A0D4E99,
    MAGIC_1_6 = 0x0A0DC4FC,

    MAGIC_2_0 = 0x0A0DC687,
    MAGIC_2_1 = 0x0A0DEB2A,
    MAGIC_2_2 = 0x0A0DED2D,
    MAGIC_2_3 = 0x0A0DF23B,
    MAGIC_2_4 = 0x0A0DF26D,
    MAGIC_2_5 = 0x0A0DF2B3,
    MAGIC_2_6 = 0x0A0DF2D1,
    MAGIC_2_7 = 0x0A0DF303,

    MAGIC_3_0 = 0x0A0D0C3A,
    MAGIC_3_1 = 0x0A0D0C4E,
    MAGIC_3_2 = 0x0A0D0C6C,
    MAGIC_3_3 = 0x0A0D0C9E,
    MAGIC_3_4 = 0x0A0D0CEE,
    MAGIC_3_5 = 0x0A0D0D16,
    MAGIC_3_5_3 = 0x0A0D0D17,
    MAGIC_3_6 = 0x0A0D0D33,
    MAGIC_3_7 = 0x0A0D0D42,
    MAGIC_3_8 = 0x0A0D0D55,
    MAGIC_3_9 = 0x0A0D0D61,
&#125;;
</code></pre>
<p>uncompyle:(to long the maze is, I didn’t put it here)</p>
<p><img loading="lazy" data-src="hnctfRe/uncompyle.jpg" alt="uncompyle"></p>
<p>Dfs script(From official wp):</p>
<pre><code>map1=[...]
map2 =  [[0 for i in range(len(map1))] for i in range(len(map1)) ]
flag=&quot;&quot;
def DFS(x,y):
    global flag
    if x == len(map1) - 2 and y == len(map1) - 2: #判断边界
        print(flag)
    if map1[x+1][y] == 0 and map2[x+1][y] == 0:
        map2[x][y] = 1
        flag += 's'
        DFS(x+1,y)
        flag = flag[:-1]
        map2[x][y] = 0
    if map1[x-1][y] == 0 and map2[x-1][y] == 0:
        map2[x][y] = 1
        flag += 'w'
        DFS(x-1,y)
        flag = flag[:-1]
        map2[x][y] = 0
    if map1[x][y+1] == 0 and map2[x][y+1] == 0:
        map2[x][y] = 1
        flag += 'd'
        DFS(x,y+1)
        flag = flag[:-1]
        map2[x][y] = 0
    if map1[x][y-1] == 0 and map2[x][y-1] == 0:
        map2[x][y] = 1
        flag += 'a'
        DFS(x,y-1)
        flag = flag[:-1]
        map2[x][y] = 0
y=1
x=1
DFS(x,y)
</code></pre>
<h3 id="findit"><a class="markdownIt-Anchor" href="#findit">#</a> findit</h3>
<p>Gets a .exe file, check whether shell exists.</p>
<p><img loading="lazy" data-src="hnctfRe/findItShell.png" alt="shell"></p>
<h5 id="open-it-with-ida"><a class="markdownIt-Anchor" href="#open-it-with-ida">#</a> Open it with ida.</h5>
<p><img loading="lazy" data-src="hnctfRe/finditIda_1.png" alt="ida1"><br>
<img loading="lazy" data-src="hnctfRe/finditIda_2.png" alt="ida2"><br>
<img loading="lazy" data-src="hnctfRe/finditIda_3.png" alt="ida3"></p>
<p>A complex encryption. The key and the flag both needs to be brute forces out. I shall do a emersion later…</p>
<h5 id="official-wp"><a class="markdownIt-Anchor" href="#official-wp">#</a> Official wp:</h5>
<pre><code>mid=[32,59,121,60,125,45,32,17,38,0,43,45,48,48,28,42,11,20,49,100,63,119,103,53,173,46,136,158,49,78,78,176]
enc=[29,70,92,84,87,19,61,43,62,60,29,9,18,63,6,6,42,14,124,110,109,60,105,191,7,162,64,104,92,61,223,179]
flag=[0]*32
flag[31]=179
flag[30]=223
print(flag)
#th1s_3ncryt_is_s0_e@sy!1
key = [ord(i) for i in &quot;HN_CTF&quot;]
def decrypt(arr):
    for i in range(0,len(arr)//4):
        tmp = arr[4*i:4*i+4]
        st = &quot;&quot;
        st+=chr(tmp[3]^key[i%6])
        st+=chr(tmp[0]^key[i%6])
        st+=chr(tmp[2]^key[i%6])
        st+=chr(tmp[1]^key[i%6])
        print(st,end='')
    print()   
    pass
def dfs(deep):
    global flag
    if(deep==0):
        decrypt(flag)
    else:
        for i in range(0,0xff):
            if( enc[deep-1] == (0x12+deep-1)^ ((i+12)%24 )^ i ^ flag[deep]):
                flag[deep-1] = i
                dfs(deep-1)
dfs(31)
</code></pre>
<h3 id="flower"><a class="markdownIt-Anchor" href="#flower">#</a> flower</h3>
<p>From ida, there are a lot of junkcodes inside, and we have to patch them before I can analyze the code.</p>
<p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1512089-1-1.html">junkcode</a></p>
<h5 id="some-script-to-nop-the-junkcodes"><a class="markdownIt-Anchor" href="#some-script-to-nop-the-junkcodes">#</a> Some script to nop the junkcodes:</h5>
<p><img loading="lazy" data-src="hnctfRe/flower_junkcode_1.png" alt="junkcode1"></p>
<h5 id="scripts1"><a class="markdownIt-Anchor" href="#scripts1">#</a> scripts1:</h5>
<pre><code>import idc
import idautils
start =0x00401000
end = 0x00401401
bad=[0x75,0x02,0x74,0x01,0xc7]

for i in range(start,end):
    if idc.get_wide_byte(i) == 0x75:
        flag=1
        for j in range(len(bad)):
            if(idc.get_wide_byte(i+j)!= bad[j]):
                flag=0
                break
        if flag==1:
            for j in range(len(bad)):
                patch_byte(i+j,0x90)
                print(&quot;success&quot;)
</code></pre>
<h5 id="scripts2"><a class="markdownIt-Anchor" href="#scripts2">#</a> scripts2:</h5>
<p><img loading="lazy" data-src="hnctfRe/flower_junkcode_2.png" alt="junkcode2"></p>
<pre><code>import idc
import idautils
start =0x00401000
end = 0x00401401
bad=[0xe8,0x01,0x00,0x00,0x00,0xe8,0x36,0x83,0x04,0x24,0x08,0xc3,0xe8]

for i in range(start,end):
    if idc.get_wide_byte(i) == 0xe8:
        flag=1
        for j in range(len(bad)):
            if(idc.get_wide_byte(i+j)!= bad[j]):
                flag=0
                break
        if flag==1:
            for j in range(len(bad)):
                patch_byte(i+j,0x90)
                print(&quot;success&quot;)
</code></pre>
<h6 id="some-interlude"><a class="markdownIt-Anchor" href="#some-interlude">#</a> Some interlude:</h6>
<p><img loading="lazy" data-src="hnctfRe/flowerPDF.png" alt="PDF"></p>
<h5 id="anyway-the-uncompilation-shall-look-like-this"><a class="markdownIt-Anchor" href="#anyway-the-uncompilation-shall-look-like-this">#</a> Anyway, the uncompilation shall look like this:</h5>
<p><img loading="lazy" data-src="hnctfRe/flowerIda.png" alt="ida"></p>
<h5 id="the-encrypt-function"><a class="markdownIt-Anchor" href="#the-encrypt-function">#</a> The encrypt function:</h5>
<p><img loading="lazy" data-src="hnctfRe/flowerEncrypt.png" alt="encrypt"></p>
<h5 id="now-we-get-the-encryption-we-can-know-that-it-is-a-rc4-encryption-and-here-comes-the-official-exp"><a class="markdownIt-Anchor" href="#now-we-get-the-encryption-we-can-know-that-it-is-a-rc4-encryption-and-here-comes-the-official-exp">#</a> Now we get the encryption, we can know that it is a RC4- encryption, and here comes the official exp:</h5>
<pre><code>#include &lt;iostream&gt;
using namespace std;
unsigned int ar[40] = &#123; 0x4d,0xffffffe6,0x49,0xffffff95,0x3,0x2d,0x2b,0xffffffba,0xffffffea,0x6d,0xffffffff,0x59,0x70,0x0,0x1b,0xffffffa9,0x2c,0xffffffb0,0x32,0xffffff98,0x6f,0xffffff8c,0x56,0xffffffa2,0x4c,0x79,0x7f &#125;;
// c[i]_ = c[i]^c[(i+1)%27]
// c[26]_ = c[26]^c_[0]
unsigned char st[16] = &quot;Hello_Ctfers!!!&quot;;
void O0oo00OOo00o0(unsigned char *m, int mlen, int keylen) &#123;
        unsigned char s[256];
        unsigned char t[256];
        int i;
        for ( i = 0; i &lt; 256; i++) &#123; //初始化s和t向量 
                s[i] = i;
                t[i] = st[i%keylen];
        &#125;        
        int j = 0;
        for ( i = 0; i &lt; 256; i++) &#123;
                j = (j + s[i] + t[i]) % 256;
                swap(s[i],s[j]);
                //根据t向量打乱s盒 
        &#125;
        unsigned char k[64];//保存秘钥流，或者直接进行异或 
        i = 0; j = 0; 
        int tmp;
        int index ;
        for ( index = 0; index &lt; mlen; index++) &#123;   //生成与明文长度一致的秘钥流 
                i = (i + 3) % 256;
                j = (j + s[i]+1) % 256;
                swap(s[i],s[j]); 
                tmp = (s[i] + s[j]) % 256;
                k[index] = s[tmp];//保存秘钥 
        &#125;
        for (i = 0; i &lt; mlen; i++)
        &#123;
                m[i] = m[i] ^ k[i];//主要进行了一步异或，加密的逆过程就是解密 
        &#125;
&#125;
int main()
&#123;
        char c[27]=&#123;0x4d,0xffffffe6,0x49,0xffffff95,0x3,0x2d,0x2b,0xffffffba,0xffffffea,0x6d,0xffffffff,0x59,0x70,0x0,0x1b,0xffffffa9,0x2c,0xffffffb0,0x32,0xffffff98,0x6f,0xffffff8c,0x56,0xffffffa2,0x4c,0x79,0x7f &#125;;
        int i;
        for(i=26;i&gt;=0;i--)
        &#123;
                c[i] = c[(i+1)%27]^c[i];
        &#125;
        for(i=0;i&lt;27;i++)
        &#123;
                printf(&quot;0x%x,&quot;,c[i]) ;
        &#125;
        O0oo00OOo00o0((unsigned char *)c,27,16);
        printf(&quot;\n&quot;);
                for(i=0;i&lt;27;i++)
        &#123;
                printf(&quot;%c&quot;,c[i]&amp;0xff) ;
        &#125;
&#125;
</code></pre>
<p>It base on static crack here, but a bro told me that since there is only <c style="color: #FF0000;">ONE</c>  <code>XOR</code>  that really do something to your flag, you can dynamic debug to get the array  <code>v4</code> . (in the upper encryption photograth) Which is really genius because whether you know how to decrypt rc4 or not you can solve this problem and it do save you tons of work!</p>
<h6 id="just-input-a-series-of-1-and-look-into-the-ecx-register"><a class="markdownIt-Anchor" href="#just-input-a-series-of-1-and-look-into-the-ecx-register">#</a> Just input a series of ‘1’ and look into the  <code>ECX</code>  register!</h6>
<p><img loading="lazy" data-src="hnctfRe/dynamic_1.png" alt="dynamic_1"><br>
<img loading="lazy" data-src="hnctfRe/dynamic_2.png" alt="dynamic_2"><br>
<img loading="lazy" data-src="hnctfRe/dynamic_3.png" alt="dynamic_3"><br>
<img loading="lazy" data-src="hnctfRe/dynamic_4.png" alt="dynamic_4"><br>
<img loading="lazy" data-src="hnctfRe/dynamic_5.png" alt="dynamic_5"></p>
<h5 id="and-so-on"><a class="markdownIt-Anchor" href="#and-so-on">#</a> And so on…</h5>
<pre><code>###### Two thinkings(should be tried out later):
###### Can `angr` solve `rc4` immediately?
###### Can I add a `hook` so it prints the `ECX` rightaway and I don't need to check it once and once again?
######                                                                                          --2022.11.4
</code></pre>
<p>From here, the last few problems are quite hard…</p>
<h3 id="maze"><a class="markdownIt-Anchor" href="#maze">#</a> MAZE</h3>
<p>We found thounds of junkcodes here, and we nop them:</p>
<pre><code>import idc
import idautils
start =0x00140001000
end = 0x00140CEF1F0
bad=[0x50,0x48,0x0f,0xc7,0xf0,0x58]

for i in range(start,end):
    if idc.get_wide_byte(i) == 0x50:
        flag=1
        for j in range(len(bad)):
            if(idc.get_wide_byte(i+j)!= bad[j]):
                flag=0
                break
        if flag==1:
            for j in range(len(bad)):
                patch_byte(i+j,0x90)
                print(&quot;success&quot;)
</code></pre>
<div class="tags"><a href="/tags/ctf/" rel="tag"><i class="ic i-tag"></i>ctf</a><a href="/tags/reverse/" rel="tag"><i class="ic i-tag"></i>reverse</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">Edited on</span><time title="Modified: 2023-09-18 13:53:23" itemprop="dateModified" datetime="2023-09-18T13:53:23+08:00">2023-09-18</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="Moyao WeChat Pay"/><p>WeChat Pay</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="Moyao Alipay"/><p>Alipay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Moyao<i class="ic i-at"><em>@</em></i>Moyao の小屋</li><li class="link"><strong>Post link: </strong><a href="https://demoyao100.github.io/2022/11/02/hnctfRe/" title="hnctfRe">https://demoyao100.github.io/2022/11/02/hnctfRe/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/11/01/pythonJail/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicis081o9j20zk0m8dmr.jpg" title="pythonJail"><span class="type">Previous Post</span><h3>pythonJail</h3></a></div><div class="item right"><a href="/2022/11/06/capstone/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicit4jrvuj20zk0m8785.jpg" title="capstone"><span class="type">Next Post</span><h3>capstone</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-6"><a class="toc-link" href="#some-reverse-questions-i-didnt-have-time-to-solve-or-didnt-solve-out"><span class="toc-number">1.</span> <span class="toc-text"> Some reverse questions I didn’t have time to solve. (Or didn’t solve out…)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#help_me"><span class="toc-number"></span> <span class="toc-text"> Help_Me!</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#my-exp"><span class="toc-number"></span> <span class="toc-text"> My exp:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#official-exp"><span class="toc-number"></span> <span class="toc-text"> Official exp:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cm2"><span class="toc-number"></span> <span class="toc-text"> CM2</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#dont-understand-how-to-debug-to-find-the-place-though-by-guessing-i-work-it-out-anyway"><span class="toc-number">1.</span> <span class="toc-text"> Don’t understand how to debug to find the place… Though by guessing I work it out anyway.</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#officail-wp"><span class="toc-number"></span> <span class="toc-text"> Officail wp:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#try2debugplusplus"><span class="toc-number"></span> <span class="toc-text"> Try2debugPlusPlus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#what_1in_d11"><span class="toc-number"></span> <span class="toc-text"> What_1in_D11</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#official-writeup"><span class="toc-number"></span> <span class="toc-text"> Official writeup:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-btea-encrypt-which-i-am-not-fimilar-with-yet-shall-get-more-study-about-encryption-and-decryption-later"><span class="toc-number">1.</span> <span class="toc-text"> (A btea encrypt, which I am not fimilar with yet. Shall get more study about encryption and decryption later.)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mazes"><span class="toc-number"></span> <span class="toc-text"> Mazes</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#a-bit-complex-wait-until-later"><span class="toc-number">1.</span> <span class="toc-text"> A bit complex, wait until later…</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stub"><span class="toc-number"></span> <span class="toc-text"> stub</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#never-seen-before-later"><span class="toc-number">1.</span> <span class="toc-text"> Never seen before, later…</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez_maze"><span class="toc-number"></span> <span class="toc-text"> ez_maze</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#complex-it-is"><span class="toc-number">1.</span> <span class="toc-text"> complex it is…</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#some-magic-number"><span class="toc-number"></span> <span class="toc-text"> some magic number:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#findit"><span class="toc-number"></span> <span class="toc-text"> findit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#open-it-with-ida"><span class="toc-number"></span> <span class="toc-text"> Open it with ida.</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#official-wp"><span class="toc-number"></span> <span class="toc-text"> Official wp:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flower"><span class="toc-number"></span> <span class="toc-text"> flower</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#some-script-to-nop-the-junkcodes"><span class="toc-number"></span> <span class="toc-text"> Some script to nop the junkcodes:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#scripts1"><span class="toc-number"></span> <span class="toc-text"> scripts1:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#scripts2"><span class="toc-number"></span> <span class="toc-text"> scripts2:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#some-interlude"><span class="toc-number">1.</span> <span class="toc-text"> Some interlude:</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#anyway-the-uncompilation-shall-look-like-this"><span class="toc-number"></span> <span class="toc-text"> Anyway, the uncompilation shall look like this:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#the-encrypt-function"><span class="toc-number"></span> <span class="toc-text"> The encrypt function:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#now-we-get-the-encryption-we-can-know-that-it-is-a-rc4-encryption-and-here-comes-the-official-exp"><span class="toc-number"></span> <span class="toc-text"> Now we get the encryption, we can know that it is a RC4- encryption, and here comes the official exp:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#just-input-a-series-of-1-and-look-into-the-ecx-register"><span class="toc-number">1.</span> <span class="toc-text"> Just input a series of ‘1’ and look into the  ECX  register!</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#and-so-on"><span class="toc-number"></span> <span class="toc-text"> And so on…</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maze"><span class="toc-number"></span> <span class="toc-text"> MAZE</span></a></div><div class="related panel pjax" data-title="Related"></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Moyao" src="/assets/avatar.jpg"/><p class="name" itemprop="name">Moyao</p><div class="description" itemprop="description">Write down something interesting I met
feel free to mail me if you have something wanted to talk about
mail: &lt;moyaoxue@outlook.com&gt;
</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">71</span><span class="name">posts</span></a></div><div class="item tags"><a href="/tags/"><span class="count">13</span><span class="name">tags</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/name" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;name"><i class="ic i-github"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/11/06/capstone/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/11/01/pythonJail/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2023/09/13/%E9%95%BF%E5%9F%8E%E6%9D%AF2023/">长城杯2023</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/01/24/CVE-2017-6736/">CVE-2017-6736</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/12/08/tctf/">tctf</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/07/18/junk-code-demo/">junk code demo</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/09/06/electron-%E6%89%93%E5%8C%85/">electron 打包</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/03/28/flutter%E5%BC%80%E5%8F%91%E5%88%9D%E6%8E%A2/">flutter开发初探</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/09/24/ASIS-CTF2023/">ASIS_CTF2023</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/08/28/%E5%AE%89%E5%8D%93hook%E5%88%9D%E6%8E%A2/">安卓hook初探</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/09/18/seccon-2023/">seccon 2023</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/07/17/cv%E4%B8%8E%E4%B8%80%E4%BA%9Bclassify%E4%BA%8B%E9%A1%B9%E8%AE%B0%E5%BD%95/">cv与一些classify事项记录</a></span></li></ul></div><div class="rpost pjax"><h2>Recent Comments</h2></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Moyao @ testName</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="Symbols count total">625k words</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="Reading time total">9:28</span></div><div class="powered-by">Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2022/11/02/hnctfRe/`,
        favicon: {
        show: `(●´3｀●) Here we go again.`,
        hide: `(´Д｀) It's a disaster!`
    },
    search: {
        placeholder: "Search for Posts",
        empty: "We didn't find any results for the search: ${query}",
        stats: "${hits} results found in ${time} ms"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">Article Timeliness Alert</span><br>This is an article published {{publish}} days ago and last updated {{updated}} days ago. Some information may have changed, so please be careful to screen it.</p></div>`,
    quiz: {
        choice: `Multiple Choice`,
        multiple: `Multiple Answer`,
        true_false: `True/False`,
        essay: `Questions`,
        gap_fill: `Gap Filling`,
        mistake: `Wrong Answer`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.2.4/pace.min.js" async></script><script src="/js/siteInit.js?v=0.4.2" type="module" fetchpriority="high" defer></script></body></html>