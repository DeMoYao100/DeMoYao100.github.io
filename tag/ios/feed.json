{
    "version": "https://jsonfeed.org/version/1",
    "title": "Moyao の小屋 • All posts by \"ios\" tag",
    "description": "Write down something interesting I met<br />\nFeel free to mail me if you have something wanted to talk about, plz\nmail: &lt;moyaoxue@outlook.com&gt;\n",
    "home_page_url": "https://demoyao100.github.io",
    "items": [
        {
            "id": "https://demoyao100.github.io/tweak%E7%BB%95%E8%BF%87%E5%8F%8Dproxy%E6%8A%93%E5%8C%85/",
            "url": "https://demoyao100.github.io/tweak%E7%BB%95%E8%BF%87%E5%8F%8Dproxy%E6%8A%93%E5%8C%85/",
            "title": "tweak绕过反proxy抓包",
            "date_published": "2024-05-29T13:45:21.000Z",
            "content_html": "<p>PREFACE：入门 ing</p>\n<p>有的程序做了反代理，顺便入门，写插件绕一下～</p>\n<p>555 有跌库库带着学 555</p>\n<span id=\"more\"></span>\n<h3 id=\"theos环境搭建\"><a class=\"markdownIt-Anchor\" href=\"#theos环境搭建\">#</a> theos 环境搭建</h3>\n<p>后续环境搭建在这个目录下</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token constant\">THEOS</span><span class=\"token operator\">=</span><span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>theos</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>git clone <span class=\"token operator\">--</span>recursive <span class=\"token operator\">&lt;</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>theos<span class=\"token operator\">/</span>theos<span class=\"token punctuation\">.</span>git<span class=\"token operator\">></span> $<span class=\"token constant\">THEOS</span></pre></td></tr></table></figure><p>安装 ldid，用于签名：</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>brew install ldid</pre></td></tr></table></figure><p>安装 dpkg，用于打包</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>brew install dpkg</pre></td></tr></table></figure><h3 id=\"启动nic程序\"><a class=\"markdownIt-Anchor\" href=\"#启动nic程序\">#</a> 启动 nic 程序</h3>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$<span class=\"token constant\">THEOS</span><span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>nic<span class=\"token punctuation\">.</span>pl</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>nic<span class=\"token punctuation\">.</span>pl</pre></td></tr></table></figure><p><img src=\"/tweak%E7%BB%95%E8%BF%87%E5%8F%8Dproxy%E6%8A%93%E5%8C%85/../../Users/18238/Downloads/1111111.png\" alt=\"1111111\"></p>\n<p>分别选择：</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>项目名</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>包名</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>author名</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>app的bundle id；<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">com.apple.UIKit</span><span class=\"token template-punctuation string\">`</span></span> 表示这里会hook所有app</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>安装插件时需要杀死的程序bundle id</pre></td></tr></table></figure><h3 id=\"防抓包原理\"><a class=\"markdownIt-Anchor\" href=\"#防抓包原理\">#</a> 防抓包原理</h3>\n<p><a href=\"https://juejin.cn/post/7055222090030383112\">https://juejin.cn/post/7055222090030383112</a></p>\n<p>![Untitled (1)](…/…/…/Users/18238/Downloads/Untitled (1).png)</p>\n<p>那么反反抓包原理就可以 hook 修改该值的方法，阻止其清空 proxyDictionary 列表的行为</p>\n<p>可以通过这里查询需要的方法名</p>\n<p><a href=\"https://developer.limneos.net/index.php?ios=11.1.2&amp;framework=CFNetwork.framework&amp;header=__NSCFURLSessionConfiguration.h\">https://developer.limneos.net/index.php?ios=11.1.2&amp;framework=CFNetwork.framework&amp;header=__NSCFURLSessionConfiguration.h</a></p>\n<p><a href=\"https://github.com/nst/iOS-Runtime-Headers\">https://github.com/nst/iOS-Runtime-Headers</a></p>\n<h3 id=\"代码编写\"><a class=\"markdownIt-Anchor\" href=\"#代码编写\">#</a> 代码编写</h3>\n<p>logos 语法：<a href=\"https://juejin.cn/post/7027356861909172231\">https://juejin.cn/post/7027356861909172231</a></p>\n<p>Tweak.x</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>#<span class=\"token keyword\">import</span> <span class=\"token operator\">&lt;</span>Foundation<span class=\"token operator\">/</span>Foundation<span class=\"token punctuation\">.</span>h<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">%</span>hook __NSCFURLSessionConfiguration</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>setConnectionProxyDictionary<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>value</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"hook setConnectionProxyDictionary\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  NSDictionary <span class=\"token operator\">*</span>proxyDictionary <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>NSDictionary <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>proxyDictionary<span class=\"token punctuation\">.</span>count <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token operator\">%</span><span class=\"token function\">orig</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">%</span>end</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">%</span>hook NSURLSessionConfiguration</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> defaultSessionConfiguration</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"hook defaultSessionConfiguration\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token operator\">%</span>orig<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token operator\">%</span>end</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token function\">__attribute__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>constructor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">Xssssss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"hook lalala\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Makefile</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token constant\">TARGET</span> <span class=\"token operator\">:</span><span class=\"token operator\">=</span> iphone<span class=\"token operator\">:</span>clang<span class=\"token operator\">:</span>latest<span class=\"token operator\">:</span><span class=\"token number\">7.0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token constant\">INSTALL_TARGET_PROCESSES</span> <span class=\"token operator\">=</span> SpringBoard</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>include <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token constant\">THEOS</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>makefiles<span class=\"token operator\">/</span>common<span class=\"token punctuation\">.</span>mk</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token constant\">TWEAK_NAME</span> <span class=\"token operator\">=</span> test</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>test_FILES <span class=\"token operator\">=</span> Tweak<span class=\"token punctuation\">.</span>x</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>test_CFLAGS <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>fobjc<span class=\"token operator\">-</span>arc</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>include <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token constant\">THEOS_MAKE_PATH</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>tweak<span class=\"token punctuation\">.</span>mk</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token constant\">THEOS_DEVICE_IP</span> <span class=\"token operator\">=</span> localhost</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token constant\">THEOS_DEVICE_PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">2222</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token constant\">ARCHS</span> <span class=\"token operator\">=</span> armv7 arm64</pre></td></tr></table></figure><p>参考：<a href=\"https://www.jianshu.com/p/a5435650e828\">https://www.jianshu.com/p/a5435650e828</a></p>\n<p>防抓包：<a href=\"https://juejin.cn/post/7055222090030383112\">https://juejin.cn/post/7055222090030383112</a></p>\n<p><a href=\"https://juejin.cn/post/6964011870554439693\">https://juejin.cn/post/6964011870554439693</a></p>\n",
            "tags": [
                "re",
                "ios"
            ]
        },
        {
            "id": "https://demoyao100.github.io/%E8%B6%8A%E7%8B%B1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/",
            "url": "https://demoyao100.github.io/%E8%B6%8A%E7%8B%B1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/",
            "title": "越狱环境搭建",
            "date_published": "2024-05-29T13:44:59.000Z",
            "content_html": "<p>PREFACE：入门 ing</p>\n<span id=\"more\"></span>\n<h3 id=\"越狱\"><a class=\"markdownIt-Anchor\" href=\"#越狱\">#</a> 越狱</h3>\n<p>**iOS 越狱使用 checkra1n：**<a href=\"https://checkra.in/\">https://checkra.in/</a></p>\n<p>** 越狱插件：** 越狱后后需要安装 cydia，openssh 和 Frida 的 cydia 插件，环境如下图：（cydia 的源是<a href=\"http://apt.cydiami.com/\"> apt.cydia.</a>ren , Frida 的源是<a href=\"https://build.frida.re\"> https://build.frida.re</a>）</p>\n<h3 id=\"pc工具安装\"><a class=\"markdownIt-Anchor\" href=\"#pc工具安装\">#</a> pc 工具安装：</h3>\n<p>** 控制 server 端（一般是 mac 电脑）** 需要安装 Frida 环境</p>\n<p>pip3 install frida-tools</p>\n<p>pip3 install frida</p>\n<p>** 需要 usbmuxd，** 用于 usb 登录 ssh 连接和控制 iOS 手机</p>\n<p>通过 brew 来安装 usbmuxd，终端输入以下命令安装 usbmuxd：brew install usbmuxd</p>\n<p>sbmuxd 自带工具 iproxy，iproxy 可以快捷连接 iPhone 操作。由于 Mac 上只支持 4 位的端口号，所以需要把 iPhone 的默认端口 22 映射到 Mac 上，相当于建立一个 Mac 和 iPhone 的通道。终端输入：</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>iproxy <span class=\"token number\">2222</span> <span class=\"token number\">22</span></pre></td></tr></table></figure><p>以上命令就是把当前连接设备的 22 端口 (SSH 端口) 映射到电脑的 2222 端口，那么想和设备 22 端口通信，直接和本地的 2222 端口通信就可以了。使用 Cmd+T 或 Cmd+N 新建终端，输入:</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ssh <span class=\"token operator\">-</span>p <span class=\"token number\">2222</span> <span class=\"token punctuation\">[</span>root@<span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>mailto<span class=\"token operator\">:</span>root@<span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre># 出现安全问题直接sudo即可</pre></td></tr></table></figure><p>**ideviceinstaller，** 用于 usb 控制 iOS 安装 ipa 文件</p>\n<figure class=\"highlight jsx\"><figcaption data-lang=\"React JSX\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>brew install ideviceinstaller</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ideviceinstaller <span class=\"token operator\">-</span>i apppath 安装apppath下的app</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ideviceinstaller <span class=\"token operator\">-</span>u <span class=\"token punctuation\">[</span>udid<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span>i <span class=\"token punctuation\">[</span>xxx<span class=\"token punctuation\">.</span>ipa<span class=\"token punctuation\">]</span> # xxx<span class=\"token punctuation\">.</span>ipa 为应用在本地的路径</pre></td></tr></table></figure><p>**ideviceinstaller，** 用于 usb 控制 iOS 安装 ipa 文件</p>\n<h3 id=\"软件安装\"><a class=\"markdownIt-Anchor\" href=\"#软件安装\">#</a> 软件安装</h3>\n<p>Cydia 包管理，可以用 tweak 安装插件</p>\n<p>dpkg 包管理工具进行：</p>\n<pre><code>dpkg -i package.deb\n</code></pre>\n<p>来安装插件</p>\n",
            "tags": [
                "ios"
            ]
        },
        {
            "id": "https://demoyao100.github.io/ios%E7%A0%B8%E5%A3%B3/",
            "url": "https://demoyao100.github.io/ios%E7%A0%B8%E5%A3%B3/",
            "title": "ios砸壳",
            "date_published": "2024-05-12T07:04:01.000Z",
            "content_html": "<p>PREFACE：初探</p>\n<span id=\"more\"></span>\n<h3 id=\"一-frida-ios-dump-master\"><a class=\"markdownIt-Anchor\" href=\"#一-frida-ios-dump-master\">#</a> 一、frida-ios-dump-master</h3>\n<p>越狱后 Cydia 查询 frida-server 版本（github 上没有必须这里下载），对照<a href=\"https://github.com/frida/frida/releases?page=5%E5%AE%89%E8%A3%85frida\"> https://github.com/frida/frida/releases?page=5 安装 frida</a> frida-tools 版本</p>\n<p>frida-ios-dump-master 砸壳：<a href=\"https://juejin.cn/post/6844903893504098317\">https://juejin.cn/post/6844903893504098317</a></p>\n<p><img src=\"https://xhs-doc.xhscdn.com/10400250312lb8ufn3004ovqb9o?imageView2/2/w/1600\" alt=\"img\"></p>\n<p>砸壳成功：</p>\n<p><img src=\"https://xhs-doc.xhscdn.com/10400250312lbbofl30032uglng?imageView2/2/w/1600\" alt=\"img\"></p>\n<p>核心二进制文件：</p>\n<p>入口（右）：Aweme ； 核心（左）：AwemeCore</p>\n<p><img src=\"https://xhs-doc.xhscdn.com/10400250312lch9l6300e68f808?imageView2/2/w/1600\" alt=\"img\"></p>\n",
            "tags": [
                "re",
                "ios"
            ]
        }
    ]
}