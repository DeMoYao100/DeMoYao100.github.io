
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>香山杯 | Moyao の小屋</title>
        <meta name="author" content="Moyao">
        <meta name="description" content="Write down something interesting I met
feel free to mail me if you have something wanted to talk about
mail: <moyaoxue@outlook.com>
">
        <meta name="keywords" content="">
        <link rel="icon" href="/images/head.jpg">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.1.1/js/all.min.js"></script>
        
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 6.2.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:200;justify-content:space-between;background:#fff;transition:opacity 0.3s ease-out"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">加载过慢请开启缓存(浏览器默认开启)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="show_page" style="display: -not-none">
                    <div id="menu_show">
                         
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">Moyao の小屋</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;about</span>
        </a>
        
        <a target="_blank" rel="noopener" href="//tags/re/">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div class="curtain" @click="menu_show = !menu_show" v-show="menu_show"></div>
        <div :class="'title'" @click="menu_show = !menu_show">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;Moyao の小屋</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menu_show">
            
            <a href="">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">about</div>
                </div>
            </a>
            
            <a href="/tags/re/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        
<div class="article">
    <div>
        <h1>香山杯 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2023/10/15
        </span>
        
        
    </div>
    <div class="content" v-pre>
        <h6 id="PREFACE：比较简单的比赛，ak了re，ai题没看明白后续研究一下"><a href="#PREFACE：比较简单的比赛，ak了re，ai题没看明白后续研究一下" class="headerlink" title="PREFACE：比较简单的比赛，ak了re，ai题没看明白后续研究一下"></a>PREFACE：比较简单的比赛，ak了re，ai题没看明白后续研究一下</h6><span id="more"></span>

<h3 id="RE-URL从哪儿来"><a href="#RE-URL从哪儿来" class="headerlink" title="RE-URL从哪儿来"></a>RE-URL从哪儿来</h3><p>提取资源区并解密：</p>
<pre><code class="python">with open(&#39;./decE_OU101&#39;, &#39;wb&#39;) as file1:
    with open(&#39;./E_OU101&#39;, &#39;rb&#39;) as file:
        a = file.read()
        for i in a:
            if (i != 120 and i != 0):
                file1.write(bytes([i ^ 0x78]))
            else:
                file1.write(bytes([i]))
</code></pre>
<p>动调拿flag即可</p>
<p><img src="/2023/10/15/%E9%A6%99%E5%B1%B1%E6%9D%AF/image-20231015192950112.png" alt="image-20231015192950112"></p>
<h3 id="hello-py"><a href="#hello-py" class="headerlink" title="hello_py"></a>hello_py</h3><p>python安卓，提取后<code>hello_py\assets\chaquopy</code>这个路径下解压app.imy得到加密文件，xxtea，解密即可</p>
<pre><code class="python">from ctypes import *
class XXTEACipher:
    k = [c_uint32(0)]*4
    def __init__(self, key):
        if len(key)!=16:
            raise ValueError(&quot;Length of key must be 16 bytes long.&quot;)
        if type(key) != bytes:
            raise TypeError(&quot;Key must be a bytes object.&quot;)
        for i in range(4):
            tmp = c_uint32(0)
            for j in range(4):
                tmp.value = tmp.value &lt;&lt; 8
                tmp.value = tmp.value + key[4 * i + (3 - j)]
            self.k[i] = tmp

    def encrypt(self, plain):
        &quot;&quot;&quot;
        :param
            plain: byte string
                The plaintext that will be encrypted.
                It must to be a multiple of 4 bytes long.
        :return: bytes string
            The encrypted bytes.
        &quot;&quot;&quot;
        length = len(plain)
        if length % 4 != 0:
            raise ValueError(&quot;Length of plain must be a multiple of 4.&quot;)
        if type(plain) != bytes:
            raise TypeError(&quot;Plain must be a bytes object.&quot;)
        n = length // 4
        v = [c_uint32()]*n
        for i in range(n):
            tmp = c_uint32(0)
            for j in range(4):
                tmp.value = tmp.value &lt;&lt; 8
                tmp.value = tmp.value + plain[4 * i + (3 - j)]
            v[i] = tmp
        q = 6 + 52 // n
        z = c_uint32(v[n-1].value)
        y = c_uint32(v[0].value)
        sum_delta = c_uint32(0)
        delta = c_uint32(0x9e3779b9)
        for i in range(q)[::-1]:
            sum_delta.value += delta.value
            for p in range(n-1):
                e = (sum_delta.value &gt;&gt; 2) &amp; 3
                y.value = v[p+1].value
                v[p].value +=  ((z.value &gt;&gt; 5 ^ y.value &lt;&lt; 2) + (y.value &gt;&gt; 3 ^ z.value&lt;&lt;4)) ^ ((sum_delta.value ^ y.value) + (self.k[(p&amp;3)^e].value ^ z.value))
                z.value = v[p].value
            y.value = v[0].value
            v[n-1].value += ((z.value &gt;&gt; 5 ^ y.value &lt;&lt; 2) + (y.value &gt;&gt; 3 ^ z.value&lt;&lt;4)) ^ ((sum_delta.value ^ y.value) + (self.k[((n-1)&amp;3)^e].value ^ z.value))
            z.value = v[n-1].value
            print(&quot;0x%08x, 0x%8x&quot;%(v[0].value, v[1].value))
        cipher = b&quot;&quot;
        for i in range(n):
            for j in range(4):
                cipher+=bytes([v[i].value&amp;0xff])
                v[i].value = v[i].value &gt;&gt; 8
        return cipher

    def decrypt(self, cipher):
        &quot;&quot;&quot;
        :param
            plain: byte string
                The plaintext that will be encrypted.
                It must to be a multiple of 4 bytes long.
        :return: bytes string
            The encrypted bytes.
        &quot;&quot;&quot;
        length = len(cipher)
        if length % 4 != 0:
            raise ValueError(&quot;Length of cipher must be a multiple of 4.&quot;)
        if type(cipher) != bytes:
            raise TypeError(&quot;Cipher must be a bytes object.&quot;)
        n = length // 4
        v = [c_uint32()]*n
        for i in range(n):
            tmp = c_uint32(0)
            for j in range(4):
                tmp.value = tmp.value &lt;&lt; 8
                tmp.value = tmp.value + cipher[4 * i + (3 - j)]
            v[i] = tmp
        q = 6 + 52 // n
        z = c_uint32(0)
        y = c_uint32(v[0].value)
        delta = c_uint32(0x9e3779b9)
        sum_delta = c_uint32(q * delta.value)
        print(&quot;0x%08x, 0x%8x&quot;%(v[0].value, v[1].value))
        for i in range(q)[::-1]:
            e = (sum_delta.value &gt;&gt; 2) &amp; 3
            for p in range(1, n)[::-1]:
                z.value = v[p-1].value
                v[p].value -=  ((z.value &gt;&gt; 5 ^ y.value &lt;&lt; 2) + (y.value &gt;&gt; 3 ^ z.value&lt;&lt;4)) ^ ((sum_delta.value ^ y.value) + (self.k[(p&amp;3)^e].value ^ z.value))
                y.value = v[p].value
            z.value = v[n-1].value
            v[0].value -= ((z.value &gt;&gt; 5 ^ y.value &lt;&lt; 2) + (y.value &gt;&gt; 3 ^ z.value&lt;&lt;4)) ^ ((sum_delta.value ^ y.value) + (self.k[(0&amp;3)^e].value ^ z.value))
            y.value = v[0].value
            sum_delta.value -= delta.value
            print(&quot;0x%08x, 0x%8x&quot;%(v[0].value, v[1].value))
        plain = b&quot;&quot;
        for i in range(n):
            for j in range(4):
                plain+=bytes([v[i].value&amp;0xff])
                v[i].value = v[i].value &gt;&gt; 8
        return plain

def new(key):
    &quot;&quot;&quot;
    :param
        key: byte string
               key: byte string
            The secret key to use in the symmetric cipher.
            It must to be 16 bytes long.
    :return: A XXTEACipher object.
    &quot;&quot;&quot;
    return XXTEACipher(key)


if __name__ == &quot;__main__&quot;:
    import struct
    key = [12345678 ,12398712 ,91283904 ,12378192 ]
    key = struct.pack(&quot;&lt;IIII&quot;, *key)
    xxtea = XXTEACipher(key)
    cipher =[689085350 ,626885696 ,1894439255 ,1204672445 ,1869189675 ,475967424 ,1932042439 ,1280104741 ,2808893494 ] 
    cipher = struct.pack(&quot;&lt;IIIIIIIII&quot;, *cipher)
    plain = xxtea.decrypt(cipher)
    print(plain)
</code></pre>
<h3 id="nesting"><a href="#nesting" class="headerlink" title="nesting"></a>nesting</h3><p>虚拟机，模拟了很多opcode</p>
<p>先批量hook一下，然后发现是类似流密钥的操作，，总归对于flag仅有xor</p>
<p>单独hook得到xor的key，一位一位check的，动调一位一位xor解密输入即可</p>
<pre><code class="python"># print(hex(get_reg_value(&#39;eax&#39;)) + &#39; | &#39; + hex(get_reg_value(&#39;ecx&#39;)))

# print(hex(idc.get_wide_dword(get_reg_value(&quot;rbp&quot;) - 2)) + &#39; ==? &#39; + hex(get_reg_value(&#39;ax&#39;)))

# print(&#39;ax = &#39; + hex(get_reg_value(&#39;ax&#39;)))
# if (hex(get_reg_value(&#39;ax&#39;)) != &#39;0x0&#39;):
#     print(&#39;ax = &#39; + hex(get_reg_value(&#39;ax&#39;)))

# print(hex(get_reg_value(&#39;ax&#39;)) + &#39; ^ &#39; + hex(idc.get_wide_word(get_reg_value(&quot;rbp&quot;) - 2)))
# if (hex(idc.get_wide_word(get_reg_value(&quot;rbp&quot;) - 2)) != &#39;0x2a&#39;):
#     print(hex(get_reg_value(&#39;ax&#39;)) + &#39; ^ &#39; + hex(idc.get_wide_word(get_reg_value(&quot;rbp&quot;) - 2)))

# flag&#123;2c7c093b-f648-11ed-1111-11111111111&#125;

print(&#39;flag&#123;&#39;,end=&#39;&#39;)
print(chr(0x4 ^ 0x36),end=&#39;&#39;)
print(chr(0x5 ^ 0x66),end=&#39;&#39;)
print(chr(0x39 ^ 0xe),end=&#39;&#39;)
list = [0xe, 0x5d, 0x53, 0xc9, 0x4e, 0x46, 0xa, 0x13, 0x1, 0x3, 0x38, 0xa0,
        0xbb, 0xc7, 0x44, 0xfa, 0xbc, 0x3, 0x44, 0x2c, 0x9a, 0x6d, 0x98, 0x35,
        0x4f, 0x4a, 0x10,0xc4, 0x17, 0x9, 0x61, 0x06, 0xe1, 0x8d]
print(chr(0x5d ^ 0x3e),end=&#39;&#39;)
print(chr(0x53 ^ 0x63),end=&#39;&#39;)
print(chr(0xc9 ^ 0xf0),end=&#39;&#39;)
print(chr(0x4e ^ 0x7d),end=&#39;&#39;)
print(chr(0x46 ^ 0x24),end=&#39;&#39;)
print(chr(0xa ^ 0x27),end=&#39;&#39;)
print(chr(0x13 ^ 0x75),end=&#39;&#39;)
print(chr(1 ^ 0x37),end=&#39;&#39;)
print(chr(0x3 ^ 0x37),end=&#39;&#39;)
print(chr(0x38 ^ 0),end=&#39;&#39;)
# print(chr(0x21 ^ 0xa0),end=&#39;&#39;)
print(&#39;-11&#39;,end=&#39;&#39;)
print(chr(0x44 ^ 0x21),end=&#39;&#39;)
print(chr(0xfa ^ 0x9e),end=&#39;&#39;)
print(&#39;-&#39;,end=&#39;&#39;)
print(chr(3 ^ 0x62),end=&#39;&#39;)
print(chr(0x44 ^ 0x73),end=&#39;&#39;)
print(chr(0x1d ^ 0x2c),end=&#39;&#39;)
print(chr(0x9a ^ 0xac),end=&#39;&#39;)
print(&#39;-&#39;,end=&#39;&#39;)
print(chr(0x98 ^ 0xaf),end=&#39;&#39;)
print(chr(0x35 ^ 5),end=&#39;&#39;)
print(chr(0x7e ^ 0x4f),end=&#39;&#39;)
print(chr(0x2b ^ 0x4a),end=&#39;&#39;)
# print(&#39;-&#39;,end=&#39;&#39;)


print(chr( 0x10 ^ 0x72),end=&#39;&#39;)
print(chr(0xc4^ 0xfc),end=&#39;&#39;)
print(chr( 0x17^ 0x74),end=&#39;&#39;)
print(chr( 0x9^ 0x68),end=&#39;&#39;)
print(chr( 0x61^ 0x0),end=&#39;&#39;)
print(chr(0x06^ 0x67),end=&#39;&#39;)
print(chr( 0xe1^ 0x87 ),end=&#39;&#39;)
print(chr(0x8d^ 0xe8),end=&#39;&#39;)
print(&#39;&#125;&#39;)
</code></pre>

    </div>
    
</div>
                         
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 20xx - 2023 Moyao の小屋
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @Moyao
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        

    </body>
</html>