
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>Web入门操作 | Moyao の小屋</title>
        <meta name="author" content="Moyao">
        <meta name="description" content="Write down something interesting I met
feel free to mail me if you have something wanted to talk about
mail: &lt;moyaoxue@outlook.com&gt;
">
        <meta name="keywords" content="">
        <link rel="icon" href="/images/head.jpg">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.1.1/js/all.min.js"></script>
        
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 6.2.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:200;justify-content:space-between;background:#fff;transition:opacity 0.3s ease-out"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">加载过慢请开启缓存(浏览器默认开启)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="show_page" style="display: -not-none">
                    <div id="menu_show">
                         
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">Moyao の小屋</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;about</span>
        </a>
        
        <a target="_blank" rel="noopener" href="//tags/re/">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div class="curtain" @click="menu_show = !menu_show" v-show="menu_show"></div>
        <div :class="'title'" @click="menu_show = !menu_show">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;Moyao の小屋</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menu_show">
            
            <a href="">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">about</div>
                </div>
            </a>
            
            <a href="/tags/re/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        
<div class="article">
    <div>
        <h1>Web入门操作 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2024/4/14
        </span>
        
        
    </div>
    <div class="content" v-pre>
        <span id="more"></span>

<h3 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h3><ul>
<li>curl 发送 get指令</li>
</ul>
<blockquote>
<p>curl 127.0.0.1 -p 80</p>
</blockquote>
<p>注意url编码</p>
<p>添加header</p>
<blockquote>
<p>curl 127.0.0.1 -p 80 –header “Host:40bb89ca76728698378750073647169d”</p>
</blockquote>
<p>注意转义</p>
<blockquote>
<p>curl 127.0.0.1?a&#x3D;963fe9d3ff95f80bff64f57c210a739f<br>\&amp;b&#x3D;f8e12324%202bbd1304%2634341212%231eebbb9b</p>
</blockquote>
<p>POST data：</p>
<blockquote>
<p>curl 127.0.0.1 -d a&#x3D;5129ddc180c847f3788d5493e2fdea93</p>
</blockquote>
<p>发送json（json内不需要转义）</p>
<blockquote>
<p>curl 127.0.0.1:80 -H “Content-Type:application&#x2F;json” -d ‘{“a”:”17aa707fc88e62cab3cf40403d43e025”,”b”:{“c”:”6869f0a6”,”d”:[“193c021a”,”1de1e1a0 9384ce04&amp;8ae5cbbb#6<br>eabcff1”]}}’</p>
</blockquote>
<p>重定向</p>
<blockquote>
<p>curl 127.0.0.1 –location-trusted</p>
</blockquote>
<p>获取cookie</p>
<blockquote>
<p>curl -c - 127.0.0.1:80</p>
</blockquote>
<p>发送cookie</p>
<blockquote>
<p>curl –cookie 71ed1a72ed58d7146e2798f2945a11dc 127.0.0.1</p>
</blockquote>
<h3 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h3><ul>
<li>nc 发送get指令</li>
</ul>
<blockquote>
<p>printf “GET &#x2F;index.html HTTP&#x2F;1.1\r\nUser-Agent: nc&#x2F;0.0.1\r\nHost: 127.0.0.1\r\nAccept: *&#x2F;*\r\n\r\n” | nc 127.0.0.1 80</p>
</blockquote>
<p>注意：更改为其他input方式，否则url编码会过不了</p>
<blockquote>
<p> hacker@talking-web~level14:&#x2F;$ nc 127.0.0.1 80<br>GET &#x2F;index.html?a&#x3D;a1834ce5ff3a8434e97e721b647e84a0 HTTP&#x2F;1.1</p>
</blockquote>
<p>可以：nc 127.0.0.1 80 &lt; exp.txt</p>
<p>tips: 这里nc会自动把\n处理成\r\n</p>
<pre><code>POST / HTTP/1.1
Host: 127.0.0.1:80
Content-Type: application/x-www-form-urlencoded; charset=utf-8
Content-Length: 34

a=b7f875a1d22f3884e72c830ccd2dae79
</code></pre>
<pre><code>POST / HTTP/1.1
Host: 127.0.0.1:80
Content-Type: application/json
Content-Length: 40

&#123;&quot;a&quot;:&quot;fb1fcbc678ea9ab1c60e7d89291a6ad0&quot;&#125;
</code></pre>
<p>nc信任重定向</p>
<p>cookie：</p>
<pre><code>POST /08ef55da8a1e676feea750320e3b0942 HTTP/1.1
Host: 127.0.0.1
Content-Type: application/json
Content-Length: 116
Cookie: cookie=c106c3a4d0d7620eee3b2cd121ff77ec
Referer: 127.0.0.1

</code></pre>
<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><ul>
<li>python 发送get（不需要url编码）</li>
</ul>
<pre><code class="python">import requests
headers = &#123;
    &#39;Host&#39;:&quot;71da60ef1b789332773275354004e689&quot;,
&#125;
response = requests.post(&quot;http://127.0.0.1:80&quot;,params=&#123;&quot;a&quot;:&quot;62e9fb4ed3b5fafd87b163b3a20fef5b&quot;,&quot;b&quot;:&quot;93db500a 663544b4&amp;c0fa24b2#5b3824c1&quot;&#125;,headers=headers)
print(response.text)
</code></pre>
<ul>
<li>post</li>
</ul>
<pre><code class="python">import requests
import json
data = &#123;&quot;a&quot;:&quot;fb7a58692e22a3fc71c5017aa0541b00&quot;&#125;
headers = &#123;
    &#39;Host&#39;:&quot;71da60ef1b789332773275354004e689&quot;,
    &quot;Content-Type&quot;:&quot;application/x-www-form-urlencoded; charset=utf-8&quot;,
&#125;
response = requests.post(&quot;http://127.0.0.1:80&quot;,data=data,headers=headers)
print(response.text)
</code></pre>
<p>json</p>
<pre><code class="python">import requests
import json
data = &#123;&quot;a&quot;:&quot;cb449746a07887172af1ad3bc700d7cc&quot;,&quot;b&quot;:&quot;6b0e7b4b 208ac3c8&amp;2a6652a6#b948b54f&quot;&#125;
data = json.dumps(data)
headers = &#123;
    &#39;Host&#39;:&quot;71da60ef1b789332773275354004e689&quot;,
    &quot;Content-Type&quot;:&quot;application/json&quot;,
&#125;
response = requests.post(&quot;http://127.0.0.1:80&quot;,data=data,headers=headers)
print(response.text)
</code></pre>
<p>Python自动重定向</p>
<p>Python不需要手动维护cookie</p>
<h3 id="web-syscall"><a href="#web-syscall" class="headerlink" title="web syscall"></a>web syscall</h3><p>network system calls are mostly big endian</p>
<p>ip protocol socket:</p>
<blockquote>
<p>socket(AF_INET, SOCK_STREAM, IPPROTO_IP)</p>
</blockquote>
<pre><code class="asm">    mov rdi, 2
    mov rsi, 1
    mov rdx, 0
    mov rax, 41
    syscall
</code></pre>
<p>bind:</p>
<blockquote>
<p>bind(3, {sa_family&#x3D;AF_INET, sin_port&#x3D;htons(80), sin_addr&#x3D;inet_addr(“0.0.0.0”)}, 16)</p>
</blockquote>
<pre><code class="asm">    sub rsp, 4
    mov word ptr [rsp], 2
    mov word ptr [rsp + 3], 80
    mov dword ptr [rsp + 4], 0x00000000
    push rsp
    pop rsi
    mov rdi, rax
    mov rdx, 16
    mov rax, 49
    syscall
</code></pre>
<p>accept </p>
<blockquote>
<p>accept(3, NULL, NULL)</p>
</blockquote>
<pre><code class="asm">    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall
</code></pre>
<p>进行接收&amp;回包</p>
<blockquote>
<p>[✓] execve(“&#x2F;proc&#x2F;self&#x2F;fd&#x2F;3”, [“&#x2F;proc&#x2F;self&#x2F;fd&#x2F;3”], 0x7f0eeb6ad980 &#x2F;* 0 vars *&#x2F;) &#x3D; 0<br>[✓] socket(AF_INET, SOCK_STREAM, IPPROTO_IP) &#x3D; 3<br>[✓] bind(3, {sa_family&#x3D;AF_INET, sin_port&#x3D;htons(80), sin_addr&#x3D;inet_addr(“0.0.0.0”)}, 16) &#x3D; 0<br>[✓] listen(3, 0)                            &#x3D; 0<br>[✓] accept(3, NULL, NULL)                   &#x3D; 4<br>[✓] read(4, “GET &#x2F; HTTP&#x2F;1.1\r\nHost: localhost\r\nUser-Agent: python-requests&#x2F;2.31.0\r\nAccept-Encoding: gzip, deflate, zstd\r\nAccept: *&#x2F;*\r\nConnection: keep-alive\r\n\r\n”, 10000) &#x3D; 146<br>[✓] write(4, “HTTP&#x2F;1.0 200 OK\r\n\r\n”, 19) &#x3D; 19<br>[✓] close(4)                                &#x3D; 0<br>[✓] exit(0)                                 &#x3D; ?</p>
</blockquote>
<pre><code class="asm">.intel_syntax noprefix
.globl _start
.section .text
_start:
    mov rdi, 2
    mov rsi, 1
    mov rdx, 0
    mov rax, 41
    syscall
    sub rsp, 4
    mov word ptr [rsp], 2
    mov word ptr [rsp + 3], 80
    mov dword ptr [rsp + 4], 0x00000000
    push rsp
    pop rsi
    mov rdi, rax
    mov rdx, 16
    mov rax, 49
    syscall
    mov rdi, 3
    mov rsi, 0
    mov rax, 50
    syscall

    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall
    mov rdi, 4
    push rsp
    pop rsi
    mov rdx, 10000
    xor rax, rax
    syscall
    sub rsp, 19
    mov dword ptr [rsp], 0x50545448
    mov dword ptr [rsp + 4], 0x302e312f
    mov dword ptr [rsp + 8], 0x30303220
    mov dword ptr [rsp + 12], 0x0d4b4f20
    mov qword ptr [rsp + 16], 0xa0d0a
    push rsp
    pop rsi
    mov rdx, 19
    mov rax, 1
    syscall
    mov rdi, 4
    mov rax, 3
    syscall
    mov rdi, 0
    mov rax, 60
    syscall
</code></pre>
<p>根据接包进行get请求：</p>
<pre><code class="asm">.intel_syntax noprefix
.globl _start
.section .text
_start:
    mov rdi, 3
    mov rax, 3
    syscall

    mov rdi, 2
    mov rsi, 1
    mov rdx, 0
    mov rax, 41
    syscall
    sub rsp, 4
    mov word ptr [rsp], 2
    mov word ptr [rsp + 3], 80
    mov dword ptr [rsp + 4], 0x00000000
    push rsp
    pop rsi
    mov rdi, rax
    mov rdx, 16
    mov rax, 49
    syscall
    mov rdi, 3
    mov rsi, 0
    mov rax, 50
    syscall

    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall

    //fork
    mov rax, 57
    syscall

    // read
    mov rdi, 4
    push rsp
    pop rsi
    mov rdx, 10000
    xor rax, rax
    syscall
    mov rcx, rsp
    add rcx, 4


    // open
    sub rsp, 9
    mov byte ptr [rsp], 0x2e
    mov byte ptr [rsp + 1], 0x2f
    mov byte ptr [rsp + 2], 0x65
    mov byte ptr [rsp + 3], 0x78
    mov byte ptr [rsp + 4], 0x70
    mov byte ptr [rsp + 5], 0x2e
    mov byte ptr [rsp + 6], 0x74
    mov byte ptr [rsp + 7], 0x78
    mov byte ptr [rsp + 8], 0x74
    mov byte ptr [rsp + 9], 0x00
    push rcx
    mov byte ptr [rcx + 16], 0x00
    pop rdi
    mov rsi, 0
    mov rax, 2
    syscall

    // read
    mov rdi, rax
    mov rsi, rsp
    mov rdx, 202
    mov rax, 0
    syscall
    mov r8, rax

    // close
    mov rsi, 5
    mov rax, 3
    syscall

    // write
    mov rdi, 4
    sub rsp, 24
    mov dword ptr [rsp],     0x50545448
    mov dword ptr [rsp + 4], 0x302e312f
    mov dword ptr [rsp + 8], 0x30303220
    mov dword ptr [rsp + 12], 0x0d4b4f20
    mov qword ptr [rsp + 16], 0x000a0d0a
    push rsp
    pop rsi
    mov rdx, 19
    mov rax, 1
    syscall
    add rsp, 24

    // write
    mov rdi, 4
    mov rsi, rsp
    mov rdx, r8
    mov rax, 1
    syscall

    // close
    mov rdi, 4
    mov rax, 3
    syscall
    // accept
    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall
</code></pre>
<pre><code class="asm">.intel_syntax noprefix
.globl _start
.section .text
_start:
    mov rdi, 2
    mov rsi, 1
    mov rdx, 0
    mov rax, 41
    syscall
    sub rsp, 4
    mov word ptr [rsp], 2
    mov word ptr [rsp + 3], 80
    mov dword ptr [rsp + 4], 0x00000000
    push rsp
    pop rsi
    mov rdi, rax
    mov rdx, 16
    mov rax, 49
    syscall
    mov rdi, 3
    mov rsi, 0
    mov rax, 50
    syscall

    // accept
    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall
    mov r8, rax

    //fork
    mov rax, 57
    syscall

    // close
    mov rdi, r8
    mov rax, 3
    syscall

    // accept
    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall
</code></pre>
<p>循环开线程接包发包 get</p>
<pre><code>========= Parent Process ==========
[ ] execve(&lt;execve_args&gt;) = 0
[ ] socket(AF_INET, SOCK_STREAM, IPPROTO_IP) = 3
[ ] bind(3, &#123;sa_family=AF_INET, sin_port=htons(&lt;bind_port&gt;), sin_addr=inet_addr(&quot;&lt;bind_address&gt;&quot;)&#125;, 16) = 0
    - Bind to port 80
    - Bind to address 0.0.0.0
[ ] listen(3, 0) = 0
[ ] accept(3, NULL, NULL) = 4
[ ] fork() = &lt;fork_result&gt;
[ ] close(4) = 0
[ ] accept(3, NULL, NULL) = ?


========= Child Process ==========
[ ] close(3) = 0
[ ] read(4, &lt;read_request&gt;, &lt;read_request_count&gt;) = &lt;read_request_result&gt;
[ ] open(&quot;&lt;open_path&gt;&quot;, O_RDONLY) = 3
[ ] read(3, &lt;read_file&gt;, &lt;read_file_count&gt;) = &lt;read_file_result&gt;
[ ] close(3) = 0
[ ] write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19
[ ] write(4, &lt;write_file&gt;, &lt;write_file_count&gt;) = &lt;write_file_result&gt;
[ ] exit(0) = ?
</code></pre>
<pre><code class="asm">.intel_syntax noprefix
.globl _start
.section .text
_start:
parent:
    // socket
    mov rdi, 2
    mov rsi, 1
    mov rdx, 0
    mov rax, 41
    syscall
    // bind
    sub rsp, 4
    mov word ptr [rsp], 2
    mov word ptr [rsp + 3], 80
    mov dword ptr [rsp + 4], 0x00000000
    push rsp
    pop rsi
    mov rdi, rax
    mov rdx, 16
    mov rax, 49
    syscall
    // listen
    mov rdi, 3
    mov rsi, 0
    mov rax, 50
    syscall

    // accept
    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall
    mov r8, rax

    //fork
    mov rax, 57
    syscall

    cmp rax, 0
    jz child

    // close
    mov rdi, 4
    mov rax, 3
    syscall
    jmp parent

    // accept
    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall

child:

    // close
    mov rdi, 3
    mov rax, 3
    syscall



    // read
    mov rdi, 4
    push rsp
    pop rsi
    mov rdx, 10000
    xor rax, rax
    syscall
    mov rcx, rsp
    add rcx, 4


    // open
    sub rsp, 9
    mov byte ptr [rsp], 0x2e
    mov byte ptr [rsp + 1], 0x2f
    mov byte ptr [rsp + 2], 0x65
    mov byte ptr [rsp + 3], 0x78
    mov byte ptr [rsp + 4], 0x70
    mov byte ptr [rsp + 5], 0x2e
    mov byte ptr [rsp + 6], 0x74
    mov byte ptr [rsp + 7], 0x78
    mov byte ptr [rsp + 8], 0x74
    mov byte ptr [rsp + 9], 0x00
    push rcx
    mov byte ptr [rcx + 16], 0x00
    pop rdi
    mov rsi, 0
    mov rax, 2
    syscall

    // read
    mov rdi, rax
    mov rsi, rsp
    mov rdx, 202
    mov rax, 0
    syscall
    mov r8, rax

    // close
    mov rsi, 5
    mov rax, 3
    syscall

    // write
    mov rdi, 4
    sub rsp, 24
    mov dword ptr [rsp],     0x50545448
    mov dword ptr [rsp + 4], 0x302e312f
    mov dword ptr [rsp + 8], 0x30303220
    mov dword ptr [rsp + 12], 0x0d4b4f20
    mov qword ptr [rsp + 16], 0x000a0d0a
    push rsp
    pop rsi
    mov rdx, 19
    mov rax, 1
    syscall
    add rsp, 24

    // write
    mov rdi, 4
    mov rsi, rsp
    mov rdx, r8
    mov rax, 1
    syscall

    // accept
    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall

    mov rdi, 0
    mov rax, 60
    syscall
</code></pre>
<p>post 接收参数并写入文件</p>
<p><img src="/2024/04/14/web%E5%85%A5%E9%97%A8%E6%93%8D%E4%BD%9C/image-20240415202715805.png" alt="image-20240415202715805"></p>
<pre><code class="asm">.intel_syntax noprefix
.globl _start
.section .text
_start:
parent:
    // socket
    mov rdi, 2
    mov rsi, 1
    mov rdx, 0
    mov rax, 41
    syscall
    // bind
    sub rsp, 4
    mov word ptr [rsp], 2
    mov word ptr [rsp + 3], 80
    mov dword ptr [rsp + 4], 0x00000000
    push rsp
    pop rsi
    mov rdi, rax
    mov rdx, 16
    mov rax, 49
    syscall
    // listen
    mov rdi, 3
    mov rsi, 0
    mov rax, 50
    syscall

    // accept
    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall
    mov r8, rax

    //fork
    mov rax, 57
    syscall

    cmp rax, 0
    jz child

    // close
    mov rdi, 4
    mov rax, 3
    syscall
    
    // accept
    mov rdi, 3
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall

    jmp parent

child:
    // close
    mov rdi, 3
    mov rax, 3
    syscall

    // read
    mov rdi, 4
    push rsp
    pop rsi
    mov rdx, 10000
    xor rax, rax
    syscall
    mov r9, rsp
    add r9, 5
    mov r8, rax

    // open
    sub rsp, 9
    push r9
    mov byte ptr [r9 + 16], 0x00
    pop rdi
    mov rsi, 65
    // 这里是八进制......
    mov rdx, 511
    mov rax, 2
    syscall

    // write
    mov rdi, rax
    add r9, 178
    mov rsi, r9    
    mov rdx, r8
    sub rdx, 183
    mov rax, 1
    syscall

    // close
    mov rsi, 3
    mov rax, 3
    syscall

    // write
    mov rdi, 4
    sub rsp, 24
    mov dword ptr [rsp],     0x50545448
    mov dword ptr [rsp + 4], 0x302e312f
    mov dword ptr [rsp + 8], 0x30303220
    mov dword ptr [rsp + 12], 0x0d4b4f20
    mov qword ptr [rsp + 16], 0x000a0d0a
    push rsp
    pop rsi
    mov rdx, 19
    mov rax, 1
    syscall
    add rsp, 24


    // exit
    mov rdi, 0
    mov rax, 60
    syscall
</code></pre>
<p>最终版orz，整合了前面几个操作支持get、post</p>
<pre><code class="asm">.intel_syntax noprefix
.globl _start
.section .text
_start:
    // socket
    mov rdi, 2
    mov rsi, 1
    mov rdx, 0
    mov rax, 41
    syscall
    mov rbx, rax

    // bind
    sub rsp, 4
    mov word ptr [rsp], 2
    mov word ptr [rsp + 3], 80
    mov dword ptr [rsp + 4], 0x00000000
    push rsp
    pop rsi
    mov rdi, rax
    mov rdx, 16
    mov rax, 49
    syscall

    // listen
    mov rdi, rbx
    mov rsi, 0
    mov rax, 50
    syscall
parent:
    // accept
    mov rdi, rbx
    xor rsi, rsi
    xor rdx, rdx
    mov rax, 43
    syscall
    mov r13, rax

    //fork
    mov rax, 57
    syscall

    cmp rax, 0
    jz child

    // close
    mov rdi, r13
    mov rax, 3
    syscall
    
    // accept
//    mov rdi, rbx
//    xor rsi, rsi
//    xor rdx, rdx
//    mov rax, 43
//    syscall

    jmp parent

child:
    // close
    mov rdi, rbx
    mov rax, 3
    syscall

    // read
    mov rdi, r13
    push rsp
    pop rsi
    mov rdx, 10000
    xor rax, rax
    syscall
    mov r15, rax
    mov r14, rsp

    // &#39;P&#39;
    cmp byte ptr [r14], 80
    jz post

get:
    // open
    sub rsp, 9
    add r14, 4
    push r14
    mov byte ptr [r14 + 16], 0x00
    pop rdi
    mov rsi, 0
    mov rdx, 0
    mov rax, 2
    syscall

    // read
    mov rdi, rax
    mov rsi, rsp
    mov rdx, 10000
    mov rax, 0
    syscall
    mov r12, rax

    // close
    mov rax, 3
    syscall

    // write
    mov rdi, r13
    sub rsp, 24
    mov dword ptr [rsp],     0x50545448
    mov dword ptr [rsp + 4], 0x302e312f
    mov dword ptr [rsp + 8], 0x30303220
    mov dword ptr [rsp + 12], 0x0d4b4f20
    mov qword ptr [rsp + 16], 0x000a0d0a
    push rsp
    pop rsi
    mov rdx, 19
    mov rax, 1
    syscall
    add rsp, 24

    // write
    mov rdi, r13
    mov rsi, rsp
    mov rdx, r12
    mov rax, 1
    syscall

    mov rdi, 0
    mov rax, 60
    syscall


post:
    add r14, 5

    // open
    sub rsp, 9
    push r14
    mov byte ptr [r14 + 16], 0x00
    pop rdi
    mov rsi, 65
    // 这里是八进制......
    mov rdx, 511
    mov rax, 2
    syscall

    // write
    mov rdi, rax
    
    mov rdx, r15
    sub rdx, 183
    cmp rdx, 99
    jg addOne

    add rdx, 1
    sub r14, 1
    
addOne:
    add r14, 178
    mov rsi, r14
    mov rax, 1
    syscall

    // close
    mov rsi, rbx
    mov rax, 3
    syscall

    // write
    mov rdi, r13
    sub rsp, 24
    mov dword ptr [rsp],     0x50545448
    mov dword ptr [rsp + 4], 0x302e312f
    mov dword ptr [rsp + 8], 0x30303220
    mov dword ptr [rsp + 12], 0x0d4b4f20
    mov qword ptr [rsp + 16], 0x000a0d0a
    push rsp
    pop rsi
    mov rdx, 19
    mov rax, 1
    syscall
    add rsp, 24


    // exit
    mov rdi, 0
    mov rax, 60
    syscall
</code></pre>
<h3 id="nc-1"><a href="#nc-1" class="headerlink" title="nc"></a>nc</h3><p>连接</p>
<blockquote>
<p>nc 127.0.0.1 80</p>
</blockquote>
<p>接听</p>
<blockquote>
<p>nc -lp 80</p>
</blockquote>
<p>多线程扫描</p>
<pre><code class="python">import socket
import threading
def check_port(hostname, port):
    try:
        print(f&#39;testing:&#123;hostname&#125;&#39;)
        sock=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        sock.settimeout(2)
        result=sock.connect_ex((hostname,port))
        if (result == 0):
            print(f&#39;&#123;hostname&#125;----------&#39;)
        sock.close()
    except:
        pass

for i in range(256):
    try:
        t = threading.Thread(target=check_port,args=(f&#39;10.0.0.&#123;i&#125;&#39;,31337))
        t.start()
    except:
        print(&quot;Error: unable to start thread&quot;)

while 1:
    pass
</code></pre>
<p>更好的多线程扫描</p>
<pre><code class="python">import socket
import logging
from concurrent.futures import ProcessPoolExecutor, as_completed

# 配置日志
logging.basicConfig(filename=&#39;port_check.log&#39;, level=logging.INFO, format=&#39;%(asctime)s - %(message)s&#39;)

def check_port(hostname, port):
    # print(hostname)
    # print(port)

    try:
        # logging.info(f&#39;testing: &#123;hostname&#125;&#39;)
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(2)
        result = sock.connect_ex((hostname, port))
        if result == 0:
            logging.info(f&#39;&#123;hostname&#125;----------&#39;)
            return True
        sock.close()
    except:
        pass
    return False

def parallel_process(array, function):
    &quot;&quot;&quot;
    A parallel version of the map function with a progress bar. 

    Args:
        array (array-like): An array to iterate over.
        function (function): A python function to apply to the elements of array
    Returns:
        [function(array[0]), function(array[1]), ...]
    &quot;&quot;&quot;
    n_jobs = 512  # 线程数
    with ProcessPoolExecutor(max_workers=n_jobs) as pool:
        futures = [pool.submit(function, *a) for a in array]  # 使用 *a 解包参数元组
        kwargs = &#123;
            &#39;total&#39;: len(futures),
            &#39;unit&#39;: &#39;it&#39;,
            &#39;unit_scale&#39;: True,
            &#39;leave&#39;: True
        &#125;
        # Print out the progress as tasks complete


if __name__ == &#39;__main__&#39;:
    array = [(f&#39;10.0.&#123;j&#125;.&#123;i&#125;&#39;, 31337) for i in range(256) for j in range(256)]  # 构造参数数组
    # array = [(f&#39;192.168.0.&#123;i&#125;&#39;, 31337) for i in range(256)]
    # print(array)
    res = parallel_process(array, check_port)
</code></pre>
<h3 id="tcpdump劫持"><a href="#tcpdump劫持" class="headerlink" title="tcpdump劫持"></a>tcpdump劫持</h3><blockquote>
<p>tcpdump -i any port 31337 -w capture.pcap</p>
</blockquote>
<h3 id="hijack"><a href="#hijack" class="headerlink" title="hijack"></a>hijack</h3><p>增加ip监听以获取包</p>
<p><a target="_blank" rel="noopener" href="https://ubuntu.com/server/docs/configuring-networks">Configuring networks | Ubuntu</a></p>
<blockquote>
<p>ip addr add 10.0.0.2 dev eth0</p>
</blockquote>
<p>scapy用法</p>
<p><a target="_blank" rel="noopener" href="https://scapy.readthedocs.io/en/latest/usage.html">Usage — Scapy 2.5.0 documentation</a></p>
<p>一些可用的指令：</p>
<blockquote>
<p>ip route show</p>
<p>ip route add default via 10.0.0.1</p>
</blockquote>
<p>广播Ethernet包（srp1注意增加filter，这样不会收到自己发的包，或者用srp批量都接收）</p>
<pre><code class="python">from scapy.all import *

# Get your MAC address (assuming you&#39;re on a Linux system)

# Create the Ethernet frame with your MAC address as the source
eth_frame = Ether(src=&quot;e6:d2:90:8f:34:8f&quot;, dst=&quot;ff:ff:ff:ff:ff:ff&quot;, type=0xFFFF)

# Send the Ethernet frame and receive packets
reply_packets = srp1(eth_frame, timeout=2, iface=&quot;eth0&quot;, filter=&quot;ether src not e6:d2:90:8f:34:8f&quot;)

# Display received packets
if reply_packets:
    print(reply_packets.show())
else:
    print(&quot;No reply received.&quot;)
</code></pre>
<p>发送ip包（注意，这里是一层一层搭建的，每层的包正常运转下一层的包才能成功发送，！注意！前面的type不能指定，这里是自动对field适应的，指定后会导致后续上层信息丢包）</p>
<pre><code class="python">from scapy.all import *

eth_frame = Ether(src=&quot;3e:72:ce:70:a9:74&quot;, dst=&quot;ff:ff:ff:ff:ff:ff&quot;)

ip_packet = IP(proto=0xFF, dst=&quot;10.0.0.3&quot;,src=&quot;10.0.0.2&quot;)
packet = eth_frame/ip_packet

reply_packets = srp1(packet, timeout=2, iface=&quot;eth0&quot;)

if reply_packets:
    print(reply_packets.show())
else:
    print(&quot;No reply received.&quot;)
</code></pre>
<p>发送tcp包，和上面一样的注意事项就一遍过</p>
<pre><code class="python">from scapy.all import *

eth_frame = Ether(src=&quot;02:42:0a:00:b5:ef&quot;, dst=&quot;ff:ff:ff:ff:ff:ff&quot;)

ip_packet = IP(dst=&quot;10.0.0.3&quot;,src=&quot;10.0.181.239&quot;)

tcp_packet = TCP(sport=31337, dport=31337, seq=31337, ack=31337, flags=&quot;APRSF&quot;)

packet = eth_frame/ip_packet/tcp_packet

reply_packets = srp1(packet, timeout=2, iface=&quot;eth0&quot;)

if reply_packets:
    print(reply_packets.show())
else:
    print(&quot;No reply received.&quot;)
</code></pre>
<p>官网的demo：<code>a=Ether()/IP(dst=&quot;www.slashdot.org&quot;)/TCP()/&quot;GET /index.html HTTP/1.0 \n\n&quot;</code></p>
<p>TCP handshake：</p>
<pre><code class="python">from scapy.all import *

eth_frame = Ether(src=&quot;8a:c9:61:2b:94:3c&quot;, dst=&quot;ff:ff:ff:ff:ff:ff&quot;)

ip_packet = IP(dst=&quot;10.0.0.3&quot;,src=&quot;10.0.0.2&quot;)

tcp_packet = TCP(sport=31337, dport=31337, seq=31337, flags=&quot;S&quot;)

packet = eth_frame/ip_packet/tcp_packet

reply_packets = srp1(packet, timeout=2, iface=&quot;eth0&quot;)

if reply_packets:
    print(reply_packets.show())
else:
    print(&quot;No reply received.&quot;)

eth_frame = Ether(src=&quot;8a:c9:61:2b:94:3c&quot;, dst=&quot;ff:ff:ff:ff:ff:ff&quot;)

ip_packet = IP(dst=&quot;10.0.0.3&quot;,src=&quot;10.0.0.2&quot;)

tcp_packet = TCP(sport=31337, dport=31337, seq=31338, ack = reply_packets.seq + 1, flags=&quot;A&quot;)

packet = eth_frame/ip_packet/tcp_packet

reply_packets = srp1(packet, timeout=3, iface=&quot;eth0&quot;)

if reply_packets:
    print(reply_packets[0].show())
else:
    print(&quot;No reply received.&quot;)
</code></pre>
<p>ARP（注意ARP中的hwsrc需要再设置一次mac，否则接收不到回包）</p>
<pre><code class="python">from scapy.all import *

eth_frame = Ether(src=&quot;3a:a0:e5:64:0f:e3&quot;, dst=&quot;ff:ff:ff:ff:ff:ff&quot;)

arp_packet = ARP(hwsrc=&quot;3a:a0:e5:64:0f:e3&quot;,op=&#39;is-at&#39;,psrc=&quot;10.0.0.2&quot;,pdst=&quot;10.0.0.3&quot;,hwdst=&quot;ff:ff:ff:ff:ff:ff&quot;)

packet = eth_frame/arp_packet

reply_packets = srp1(packet, timeout=3, iface=&quot;eth0&quot;)

if reply_packets:
    print(reply_packets.show())
else:
    print(&quot;No reply received.&quot;)

# print(arp_mitm(&quot;10.0.0.3&quot;,&quot;10.0.0.2&quot;))
</code></pre>
<p>ARP欺骗（直接伪造ip即可）</p>
<pre><code class="python">sendp(Ether(src=get_if_hwaddr(&quot;eth0&quot;), dst=&quot;ff:ff:ff:ff:ff:ff&quot;) / ARP(op=&quot;is-at&quot;, psrc=&quot;10.0.0.2&quot;, hwsrc=get_if_hwaddr(&quot;eth0&quot;)), iface=&quot;eth0&quot;)
</code></pre>
<p>差一个题，稍微复杂，大概知道怎么做但是晚点做吧…</p>

    </div>
    
</div>
                         
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 20xx - 2024 Moyao の小屋
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @Moyao
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        

    </body>
</html>