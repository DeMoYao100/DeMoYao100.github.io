<!doctypehtml><html lang=en><meta charset=UTF-8><meta content=width=device-width,initial-scale=1,maximum-scale=2 name=viewport><meta content=#222 name=theme-color><meta content=IE=edge,chrome=1 http-equiv=X-UA-COMPATIBLE><meta content=webkit name=renderer><link href=/assets/favicon.ico rel=icon sizes=32x32 type=image/ico><link href=/assets/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/rss.xml rel=alternate title=rev@天枢 type=application/rss+xml><link href=/atom.xml rel=alternate title=rev@天枢 type=application/atom+xml><link href=https://demoyao100.github.io/feed.json rel=alternate title=rev@天枢 type=application/json><link href=https://lf9-cdn-tos.bytecdntp.com rel=preconnect><link href=https://cdn.jsdelivr.net rel=dns-prefetch><link href=https://unpkg.com rel=dns-prefetch><link href=https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext rel=stylesheet><link href=/css/app.css?v=0.3.15 rel=stylesheet><link href=https://demoyao100.github.io/2024/04/08/vm%E5%88%9D%E6%8E%A2/ rel=canonical><title>vm初探</title><meta content="Hexo 7.0.0" name=generator><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=cat><div class=body></div><div class=head><div class=face></div></div><div class=foot><div class=tummy-end></div><div class=bottom></div><div class="legs left"></div><div class="legs right"></div></div><div class=paw><div class="hands left"></div><div class="hands right"></div></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">vm初探</h1><div class=meta><span title="Created: 2024-04-08 14:41:37" class=item><span class=icon><i class="ic i-calendar"></i></span><span class=text>Posted on</span><time itemprop="dateCreated datePublished" datetime=2024-04-08T14:41:37+08:00>2024-04-08</time></span><span title="Symbols count in article" class=item><span class=icon><i class="ic i-pen"></i></span><span class=text>Symbols count in article</span><span>17k</span><span class=text>words</span></span><span title="Reading time" class=item><span class=icon><i class="ic i-clock"></i></span><span class=text>Reading time</span><span>15 mins.</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div aria-label="Toggle navigation bar" class=lines><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>Moyao の小屋</a></ul><ul class=right id=rightNav><li class="item theme" @click=changeThemeByBtn><i :class="{'i-sun': !themeStatus,'i-moon': themeStatus}" class=ic></i><li class="item search"><i class="ic i-search"></i></ul></div></nav></div><div class=pjax id=imgs><img src=https://tva4.sinaimg.cn/mw690/6833939bly1gicis3attqj20zk0m8k7l.jpg></div></header><div id=waves><svg viewbox="0 24 150 28" class=waves preserveaspectratio=none shape-rendering=auto xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" id=gentle-wave></path></defs><g class=parallax><use x=48 xlink:href=#gentle-wave y=0></use><use x=48 xlink:href=#gentle-wave y=3></use><use x=48 xlink:href=#gentle-wave y=5></use><use x=48 xlink:href=#gentle-wave y=7></use></g></svg></div><main><div class=inner><div class=pjax id=main><div class="article wrap"><div class=breadcrumb itemlistelement itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i><span><a href=/>Home</a></span></div><article class="post block" itemscope itemtype=http://schema.org/Article lang=en><link href=https://demoyao100.github.io/2024/04/08/vm%E5%88%9D%E6%8E%A2/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta content=/assets/avatar.jpg itemprop=image><meta content=Moyao itemprop=name><meta content="Hi,I'm Moyaoxue, Write down something interesting I met<br />
Feel free to mail me if you have something wanted to talk about, plz
mail: &amplt;moyaoxue@outlook.com&ampgt;
" itemprop=description></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta content=rev@天枢 itemprop=name></span><div class="body md" itemprop=articleBody><h6 id=preface最后两个逆向题其实更像pwn的入门vm写个orw最后一题需要用各种方法bruteforce-leak-opcode由于附件不同这里exp相当于一个思路><a class=anchor href=#preface最后两个逆向题其实更像pwn的入门vm写个orw最后一题需要用各种方法bruteforce-leak-opcode由于附件不同这里exp相当于一个思路>#</a> PREFACE：最后两个逆向题，其实更像 pwn 的入门 vm，写个 orw，最后一题需要用各种方法 bruteforce & leak opcode（由于附件不同这里 exp 相当于一个思路）</h6><p><span id=more></span><h5 id=直白的orw><a class=anchor href=#直白的orw>#</a> 直白的 orw</h5><p>21.1<p>（ps. 后面看这里有点问题的，偏移其实不对，但是可以通，很奇妙，可能是有什么奇妙巧合？）<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tr><td data-num=1><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre><tr><td data-num=2><td><pre>context<span class="token punctuation">(</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre><span class="token comment"># context(log_level='debug')</span></pre><tr><td data-num=4><td><pre><span class="token comment"># context(terminal=['tmux','splitw','-h'])</span></pre><tr><td data-num=5><td><pre><span class="token comment"># p = gdb.debug('./babyrev_level21.0','b *interpret_sys + 156\nb *interpret_sys + 491\nb *interpret_sys + 659')</span></pre><tr><td data-num=6><td><pre>p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'strace'</span><span class="token punctuation">,</span><span class="token string">'./babyrev_level21.1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre><tr><td data-num=7><td><pre><span class="token comment"># p = process('./babyrev_level21.1')</span></pre><tr><td data-num=8><td><pre><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=9><td><pre>    <span class="token keyword">match</span> name<span class="token punctuation">:</span></pre><tr><td data-num=10><td><pre>        <span class="token keyword">case</span> <span class="token string">'opcode[1024]'</span><span class="token punctuation">:</span></pre><tr><td data-num=11><td><pre>            <span class="token keyword">return</span> <span class="token number">64</span></pre><tr><td data-num=12><td><pre>        <span class="token keyword">case</span> <span class="token string">'opcode[1025]'</span><span class="token punctuation">:</span></pre><tr><td data-num=13><td><pre>            <span class="token keyword">return</span> <span class="token number">1</span></pre><tr><td data-num=14><td><pre>        <span class="token keyword">case</span> <span class="token string">'opcode[1026]'</span><span class="token punctuation">:</span></pre><tr><td data-num=15><td><pre>            <span class="token keyword">return</span> <span class="token number">16</span></pre><tr><td data-num=16><td><pre>        <span class="token keyword">case</span> <span class="token string">'opcode[1027]'</span><span class="token punctuation">:</span></pre><tr><td data-num=17><td><pre>            <span class="token keyword">return</span> <span class="token number">4</span></pre><tr><td data-num=18><td><pre>        <span class="token keyword">case</span> <span class="token string">'opcode[1028]'</span><span class="token punctuation">:</span></pre><tr><td data-num=19><td><pre>            <span class="token keyword">return</span> <span class="token number">8</span></pre><tr><td data-num=20><td><pre>        <span class="token keyword">case</span> <span class="token string">'opcode[1029]'</span><span class="token punctuation">:</span></pre><tr><td data-num=21><td><pre>            <span class="token keyword">return</span> <span class="token number">32</span></pre><tr><td data-num=22><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'err register'</span><span class="token punctuation">)</span></pre><tr><td data-num=23><td><pre></pre><tr><td data-num=24><td><pre><span class="token keyword">def</span> <span class="token function">interpret_instruction</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=25><td><pre>    <span class="token keyword">match</span> name<span class="token punctuation">:</span></pre><tr><td data-num=26><td><pre>        <span class="token keyword">case</span> <span class="token string">'interpret_imm'</span><span class="token punctuation">:</span></pre><tr><td data-num=27><td><pre>            <span class="token keyword">return</span> <span class="token number">0x200</span></pre><tr><td data-num=28><td><pre>        <span class="token keyword">case</span> <span class="token string">'interpret_add'</span><span class="token punctuation">:</span></pre><tr><td data-num=29><td><pre>            <span class="token keyword">return</span> <span class="token number">0x400</span></pre><tr><td data-num=30><td><pre>        <span class="token keyword">case</span> <span class="token string">'interpret_stk'</span><span class="token punctuation">:</span></pre><tr><td data-num=31><td><pre>            <span class="token keyword">return</span> <span class="token number">0x800</span></pre><tr><td data-num=32><td><pre>        <span class="token keyword">case</span> <span class="token string">'interpret_stm'</span><span class="token punctuation">:</span></pre><tr><td data-num=33><td><pre>            <span class="token keyword">return</span> <span class="token number">0x100</span></pre><tr><td data-num=34><td><pre>        <span class="token keyword">case</span> <span class="token string">'interpret_ldm'</span><span class="token punctuation">:</span></pre><tr><td data-num=35><td><pre>            <span class="token keyword">return</span> <span class="token number">0x1000</span></pre><tr><td data-num=36><td><pre>        <span class="token keyword">case</span> <span class="token string">'interpret_cmp'</span><span class="token punctuation">:</span></pre><tr><td data-num=37><td><pre>            <span class="token keyword">return</span> <span class="token number">0x8000</span></pre><tr><td data-num=38><td><pre>        <span class="token keyword">case</span> <span class="token string">'interpret_jmp'</span><span class="token punctuation">:</span></pre><tr><td data-num=39><td><pre>            <span class="token keyword">return</span> <span class="token number">0x2000</span></pre><tr><td data-num=40><td><pre>        <span class="token keyword">case</span> <span class="token string">'interpret_sys'</span><span class="token punctuation">:</span></pre><tr><td data-num=41><td><pre>            <span class="token keyword">return</span> <span class="token number">0x4000</span></pre><tr><td data-num=42><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'err instruction'</span><span class="token punctuation">)</span></pre><tr><td data-num=43><td><pre></pre><tr><td data-num=44><td><pre><span class="token keyword">def</span> <span class="token function">interpret_imm</span><span class="token punctuation">(</span>regs<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=45><td><pre>    <span class="token keyword">return</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_imm'</span><span class="token punctuation">)</span> <span class="token operator">+</span> register<span class="token punctuation">(</span>regs<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>value <span class="token operator"><<</span> <span class="token number">16</span><span class="token punctuation">)</span></pre><tr><td data-num=46><td><pre></pre><tr><td data-num=47><td><pre><span class="token keyword">def</span> <span class="token function">interpret_stm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=48><td><pre>    <span class="token comment"># opcode[1025] = offset</span></pre><tr><td data-num=49><td><pre>    <span class="token comment"># opcode[1026] = value</span></pre><tr><td data-num=50><td><pre>    <span class="token keyword">return</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_stm'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1025]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1026]'</span><span class="token punctuation">)</span> <span class="token operator"><<</span> <span class="token number">16</span><span class="token punctuation">)</span></pre><tr><td data-num=51><td><pre></pre><tr><td data-num=52><td><pre><span class="token keyword">def</span> <span class="token function">interpret_sys</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=53><td><pre>    <span class="token keyword">match</span> name<span class="token punctuation">:</span></pre><tr><td data-num=54><td><pre>        <span class="token keyword">case</span> <span class="token string">'open'</span><span class="token punctuation">:</span></pre><tr><td data-num=55><td><pre>            <span class="token keyword">return</span> <span class="token number">0x20</span></pre><tr><td data-num=56><td><pre>        <span class="token keyword">case</span> <span class="token string">'read_code'</span><span class="token punctuation">:</span></pre><tr><td data-num=57><td><pre>            <span class="token keyword">return</span> <span class="token number">0x4</span></pre><tr><td data-num=58><td><pre>        <span class="token keyword">case</span> <span class="token string">'read'</span><span class="token punctuation">:</span></pre><tr><td data-num=59><td><pre>            <span class="token keyword">return</span> <span class="token number">0x8</span></pre><tr><td data-num=60><td><pre>        <span class="token keyword">case</span> <span class="token string">'write'</span><span class="token punctuation">:</span></pre><tr><td data-num=61><td><pre>            <span class="token keyword">return</span> <span class="token number">0x2</span></pre><tr><td data-num=62><td><pre>        <span class="token keyword">case</span> <span class="token string">'sleep'</span><span class="token punctuation">:</span></pre><tr><td data-num=63><td><pre>            <span class="token keyword">return</span> <span class="token number">0x10</span></pre><tr><td data-num=64><td><pre>        <span class="token keyword">case</span> <span class="token string">'exit'</span><span class="token punctuation">:</span></pre><tr><td data-num=65><td><pre>            <span class="token keyword">return</span> <span class="token number">0x1</span></pre><tr><td data-num=66><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'err sys'</span><span class="token punctuation">)</span></pre><tr><td data-num=67><td><pre></pre><tr><td data-num=68><td><pre><span class="token keyword">def</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=69><td><pre>    <span class="token comment"># opcode[opcode[1024] + 768] = addr</span></pre><tr><td data-num=70><td><pre>    <span class="token comment"># opcode[1024] = fd</span></pre><tr><td data-num=71><td><pre>    <span class="token comment"># opcode[1026] = len</span></pre><tr><td data-num=72><td><pre>    <span class="token keyword">return</span> interpret_sys<span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">)</span> <span class="token operator">+</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_sys'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1024]'</span><span class="token punctuation">)</span> <span class="token operator"><<</span> <span class="token number">16</span><span class="token punctuation">)</span></pre><tr><td data-num=73><td><pre></pre><tr><td data-num=74><td><pre><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=75><td><pre>    <span class="token comment"># opcode[1024] = fd</span></pre><tr><td data-num=76><td><pre>    <span class="token comment"># opcode[1025] = ret len</span></pre><tr><td data-num=77><td><pre>    <span class="token keyword">return</span> interpret_sys<span class="token punctuation">(</span><span class="token string">'read'</span><span class="token punctuation">)</span> <span class="token operator">+</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_sys'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1025]'</span><span class="token punctuation">)</span> <span class="token operator"><<</span> <span class="token number">16</span><span class="token punctuation">)</span></pre><tr><td data-num=78><td><pre></pre><tr><td data-num=79><td><pre><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=80><td><pre>    <span class="token comment"># opcode[1024] = fd</span></pre><tr><td data-num=81><td><pre>    <span class="token keyword">return</span> interpret_sys<span class="token punctuation">(</span><span class="token string">'write'</span><span class="token punctuation">)</span> <span class="token operator">+</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_sys'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1025]'</span><span class="token punctuation">)</span> <span class="token operator"><<</span> <span class="token number">16</span><span class="token punctuation">)</span></pre><tr><td data-num=82><td><pre></pre><tr><td data-num=83><td><pre><span class="token keyword">def</span> <span class="token function">exitPro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=84><td><pre>    <span class="token keyword">return</span> interpret_sys<span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">)</span> <span class="token operator">+</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_sys'</span><span class="token punctuation">)</span></pre><tr><td data-num=85><td><pre></pre><tr><td data-num=86><td><pre>opcode_func <span class="token operator">=</span> <span class="token triple-quoted-string string">'''</span></pre><tr><td data-num=87><td><pre>interpret_imm('opcode[1025]',768) # offset</pre><tr><td data-num=88><td><pre>interpret_imm('opcode[1026]',ord('/')) # value</pre><tr><td data-num=89><td><pre>interpret_stm()</pre><tr><td data-num=90><td><pre>interpret_imm('opcode[1025]',769) # offset</pre><tr><td data-num=91><td><pre>interpret_imm('opcode[1026]',ord('f')) # value</pre><tr><td data-num=92><td><pre>interpret_stm()</pre><tr><td data-num=93><td><pre>interpret_imm('opcode[1025]',770) # offset</pre><tr><td data-num=94><td><pre>interpret_imm('opcode[1026]',ord('l')) # value</pre><tr><td data-num=95><td><pre>interpret_stm()</pre><tr><td data-num=96><td><pre>interpret_imm('opcode[1025]',771) # offset</pre><tr><td data-num=97><td><pre>interpret_imm('opcode[1026]',ord('a')) # value</pre><tr><td data-num=98><td><pre>interpret_stm()</pre><tr><td data-num=99><td><pre>interpret_imm('opcode[1025]',772) # offset</pre><tr><td data-num=100><td><pre>interpret_imm('opcode[1026]',ord('g')) # value</pre><tr><td data-num=101><td><pre>interpret_stm()</pre><tr><td data-num=102><td><pre></pre><tr><td data-num=103><td><pre>interpret_imm('opcode[1024]',0) # addr = opcode[0 + 768]</pre><tr><td data-num=104><td><pre>interpret_imm('opcode[1025]',0)</pre><tr><td data-num=105><td><pre>interpret_imm('opcode[1026]',0)</pre><tr><td data-num=106><td><pre>open()</pre><tr><td data-num=107><td><pre></pre><tr><td data-num=108><td><pre>interpret_imm('opcode[1026]',0x50) # len</pre><tr><td data-num=109><td><pre>read()</pre><tr><td data-num=110><td><pre></pre><tr><td data-num=111><td><pre>interpret_imm('opcode[1024]',1)</pre><tr><td data-num=112><td><pre>interpret_imm('opcode[1025]',0)</pre><tr><td data-num=113><td><pre>interpret_imm('opcode[1026]',0x50) # len</pre><tr><td data-num=114><td><pre>write()</pre><tr><td data-num=115><td><pre>exitPro()</pre><tr><td data-num=116><td><pre>'''</pre><tr><td data-num=117><td><pre>opcode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre><tr><td data-num=118><td><pre>opcode_func <span class="token operator">=</span> opcode_func<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span></pre><tr><td data-num=119><td><pre><span class="token comment"># print(opcode_func)</span></pre><tr><td data-num=120><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> opcode_func<span class="token punctuation">:</span></pre><tr><td data-num=121><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=122><td><pre>        <span class="token keyword">continue</span></pre><tr><td data-num=123><td><pre>    p48 <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre><tr><td data-num=124><td><pre>    opcode<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p48 <span class="token operator">&</span> <span class="token number">0xff</span><span class="token punctuation">)</span></pre><tr><td data-num=125><td><pre>    opcode<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>p48 <span class="token operator">&</span> <span class="token number">0xff00</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span></pre><tr><td data-num=126><td><pre>    opcode<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>p48 <span class="token operator">&</span> <span class="token number">0xff0000</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span></pre><tr><td data-num=127><td><pre>opcode<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0x300</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>opcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=128><td><pre></pre><tr><td data-num=129><td><pre>a <span class="token operator">=</span> opcode</pre><tr><td data-num=130><td><pre>a <span class="token operator">=</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span></pre><tr><td data-num=131><td><pre><span class="token comment"># print(a)</span></pre><tr><td data-num=132><td><pre>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre><tr><td data-num=133><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></table></figure><h5 id=随机化opcode的orw><a class=anchor href=#随机化opcode的orw>#</a> 随机化 opcode 的 orw</h5><p>22.0<p>爆破的思路：<p>种子一共 0xff 个，没有尝试直接爆，徒手一步一步做的（注释掉的就是思路），从 exit 为入口点一步一步推一步一步还原（这里最后的 open 只有三个可能的值 <code>1|8|64</code> ，直接手试了）:<figure class="highlight python"><figcaption data-lang=python></figcaption><table><tr><td data-num=1><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre><tr><td data-num=2><td><pre>context<span class="token punctuation">(</span>os <span class="token operator">=</span> <span class="token string">'linux'</span><span class="token punctuation">,</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span><span class="token punctuation">)</span></pre><tr><td data-num=3><td><pre><span class="token comment"># context(log_level='debug')</span></pre><tr><td data-num=4><td><pre><span class="token comment"># context(terminal=['tmux','splitw','-h'])</span></pre><tr><td data-num=5><td><pre><span class="token comment"># p = gdb.debug('./babyrev_level21.0','b *interpret_sys + 156\nb *interpret_sys + 491\nb *interpret_sys + 659')</span></pre><tr><td data-num=6><td><pre><span class="token comment"># p = process(['strace','./babyrev_level22.0'])</span></pre><tr><td data-num=7><td><pre></pre><tr><td data-num=8><td><pre><span class="token comment"># ------------------------------------------------</span></pre><tr><td data-num=9><td><pre><span class="token comment">### sys:16  | exit:1</span></pre><tr><td data-num=10><td><pre><span class="token comment">### interpret_imm:4 | opcode[1024]:8</span></pre><tr><td data-num=11><td><pre><span class="token comment">### sleep:128</span></pre><tr><td data-num=12><td><pre><span class="token comment">### read_code|read_memory:2/32                 opcode[1029]:64   none:4</span></pre><tr><td data-num=13><td><pre><span class="token comment">### add:2</span></pre><tr><td data-num=14><td><pre><span class="token comment"># ------------------------------------------------</span></pre><tr><td data-num=15><td><pre></pre><tr><td data-num=16><td><pre><span class="token comment">## test exit</span></pre><tr><td data-num=17><td><pre><span class="token comment">### sys:16, exit:1</span></pre><tr><td data-num=18><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=19><td><pre><span class="token comment"># for i in table:</span></pre><tr><td data-num=20><td><pre><span class="token comment">#     for j in table:</span></pre><tr><td data-num=21><td><pre><span class="token comment">#         a = []</span></pre><tr><td data-num=22><td><pre><span class="token comment">#         a.append(5)</span></pre><tr><td data-num=23><td><pre><span class="token comment">#         a.append(j)</span></pre><tr><td data-num=24><td><pre><span class="token comment">#         a.append(i)</span></pre><tr><td data-num=25><td><pre><span class="token comment">#         a += [0] * 0x300</span></pre><tr><td data-num=26><td><pre><span class="token comment">#         a = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=27><td><pre><span class="token comment">#         p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=28><td><pre><span class="token comment">#         p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a)</span></pre><tr><td data-num=29><td><pre><span class="token comment">#         h = p.recv(4096)</span></pre><tr><td data-num=30><td><pre><span class="token comment">#         print(i)</span></pre><tr><td data-num=31><td><pre><span class="token comment">#         print(j)</span></pre><tr><td data-num=32><td><pre></pre><tr><td data-num=33><td><pre><span class="token comment">## test interpret_imm, opcode | search : "exit code 5"</span></pre><tr><td data-num=34><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=35><td><pre><span class="token comment"># for i in table:</span></pre><tr><td data-num=36><td><pre><span class="token comment">#     for j in table:</span></pre><tr><td data-num=37><td><pre><span class="token comment">#         a = []</span></pre><tr><td data-num=38><td><pre><span class="token comment">#         a.append(5)</span></pre><tr><td data-num=39><td><pre><span class="token comment">#         a.append(j)</span></pre><tr><td data-num=40><td><pre><span class="token comment">#         a.append(i)</span></pre><tr><td data-num=41><td><pre><span class="token comment">#         a.append(0)</span></pre><tr><td data-num=42><td><pre><span class="token comment">#         a.append(16)</span></pre><tr><td data-num=43><td><pre><span class="token comment">#         a.append(1)</span></pre><tr><td data-num=44><td><pre><span class="token comment">#         a += [0] * 0x250</span></pre><tr><td data-num=45><td><pre><span class="token comment">#         a = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=46><td><pre><span class="token comment">#         p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=47><td><pre><span class="token comment">#         p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a)</span></pre><tr><td data-num=48><td><pre><span class="token comment">#         h = p.recv(4096)</span></pre><tr><td data-num=49><td><pre><span class="token comment">#         print(i)</span></pre><tr><td data-num=50><td><pre><span class="token comment">#         print(j)</span></pre><tr><td data-num=51><td><pre></pre><tr><td data-num=52><td><pre><span class="token comment">## test sleep 128</span></pre><tr><td data-num=53><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=54><td><pre><span class="token comment"># for i in table:</span></pre><tr><td data-num=55><td><pre><span class="token comment">#     a = []</span></pre><tr><td data-num=56><td><pre><span class="token comment">#     a.append(0x10)</span></pre><tr><td data-num=57><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=58><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 0</span></pre><tr><td data-num=59><td><pre><span class="token comment">#     a.append(0x10)</span></pre><tr><td data-num=60><td><pre><span class="token comment">#     a.append(i)</span></pre><tr><td data-num=61><td><pre><span class="token comment">#     a.append(1) # sleep</span></pre><tr><td data-num=62><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=63><td><pre><span class="token comment">#     a.append(16)</span></pre><tr><td data-num=64><td><pre><span class="token comment">#     a.append(1) # exit</span></pre><tr><td data-num=65><td><pre><span class="token comment">#     a = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=66><td><pre><span class="token comment">#     p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=67><td><pre><span class="token comment">#     p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a)</span></pre><tr><td data-num=68><td><pre><span class="token comment">#     p.interactive()</span></pre><tr><td data-num=69><td><pre><span class="token comment">#     # print(h)</span></pre><tr><td data-num=70><td><pre><span class="token comment">#     print(i)</span></pre><tr><td data-num=71><td><pre></pre><tr><td data-num=72><td><pre><span class="token comment"># use exit and add can exploit all the regs</span></pre><tr><td data-num=73><td><pre><span class="token comment">## find add first:2</span></pre><tr><td data-num=74><td><pre><span class="token comment"># import time</span></pre><tr><td data-num=75><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=76><td><pre><span class="token comment"># for j in table:</span></pre><tr><td data-num=77><td><pre><span class="token comment">#     print(j)</span></pre><tr><td data-num=78><td><pre><span class="token comment">#     a = []</span></pre><tr><td data-num=79><td><pre><span class="token comment">#     a.append(3)</span></pre><tr><td data-num=80><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=81><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 3</span></pre><tr><td data-num=82><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=83><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=84><td><pre><span class="token comment">#     a.append(j) # test add</span></pre><tr><td data-num=85><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=86><td><pre><span class="token comment">#     a.append(16)</span></pre><tr><td data-num=87><td><pre><span class="token comment">#     a.append(1) # exit</span></pre><tr><td data-num=88><td><pre><span class="token comment">#     a_byte = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=89><td><pre><span class="token comment">#     p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=90><td><pre><span class="token comment">#     p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a_byte)</span></pre><tr><td data-num=91><td><pre><span class="token comment">#     time.sleep(0.1)</span></pre><tr><td data-num=92><td><pre><span class="token comment">#     p.kill()</span></pre><tr><td data-num=93><td><pre></pre><tr><td data-num=94><td><pre><span class="token comment">## test ldm</span></pre><tr><td data-num=95><td><pre><span class="token comment"># 32</span></pre><tr><td data-num=96><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=97><td><pre><span class="token comment"># for j in table:</span></pre><tr><td data-num=98><td><pre><span class="token comment">#     print(j)</span></pre><tr><td data-num=99><td><pre><span class="token comment">#     a = []</span></pre><tr><td data-num=100><td><pre><span class="token comment">#     a.append(3)</span></pre><tr><td data-num=101><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=102><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 10</span></pre><tr><td data-num=103><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=104><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=105><td><pre><span class="token comment">#     a.append(j) # test ldm</span></pre><tr><td data-num=106><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=107><td><pre><span class="token comment">#     a.append(16)</span></pre><tr><td data-num=108><td><pre><span class="token comment">#     a.append(1) # exit</span></pre><tr><td data-num=109><td><pre><span class="token comment">#     a_byte = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=110><td><pre><span class="token comment">#     p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=111><td><pre><span class="token comment">#     p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a_byte)</span></pre><tr><td data-num=112><td><pre><span class="token comment">#     time.sleep(0.1)</span></pre><tr><td data-num=113><td><pre><span class="token comment">#     p.kill()</span></pre><tr><td data-num=114><td><pre></pre><tr><td data-num=115><td><pre><span class="token comment">## test stm</span></pre><tr><td data-num=116><td><pre><span class="token comment"># 64</span></pre><tr><td data-num=117><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=118><td><pre><span class="token comment"># for j in table:</span></pre><tr><td data-num=119><td><pre><span class="token comment">#     print(j)</span></pre><tr><td data-num=120><td><pre><span class="token comment">#     a = []</span></pre><tr><td data-num=121><td><pre><span class="token comment">#     a.append(3)</span></pre><tr><td data-num=122><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=123><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 3</span></pre><tr><td data-num=124><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=125><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=126><td><pre><span class="token comment">#     a.append(j) # test stm opcode[768] = 3;</span></pre><tr><td data-num=127><td><pre><span class="token comment">#     a.append(5)</span></pre><tr><td data-num=128><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=129><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 5 # failed to write</span></pre><tr><td data-num=130><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=131><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=132><td><pre><span class="token comment">#     a.append(32) # ldm</span></pre><tr><td data-num=133><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=134><td><pre><span class="token comment">#     a.append(16)</span></pre><tr><td data-num=135><td><pre><span class="token comment">#     a.append(1) # exit</span></pre><tr><td data-num=136><td><pre><span class="token comment">#     a_byte = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=137><td><pre><span class="token comment">#     p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=138><td><pre><span class="token comment">#     p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a_byte)</span></pre><tr><td data-num=139><td><pre><span class="token comment">#     time.sleep(0.1)</span></pre><tr><td data-num=140><td><pre><span class="token comment">#     p.kill()</span></pre><tr><td data-num=141><td><pre></pre><tr><td data-num=142><td><pre><span class="token comment"># # # write</span></pre><tr><td data-num=143><td><pre><span class="token comment"># # write:4</span></pre><tr><td data-num=144><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=145><td><pre><span class="token comment"># for j in table:</span></pre><tr><td data-num=146><td><pre><span class="token comment">#     if (j == 16 or j == 128 or j == 2 or j == 32):</span></pre><tr><td data-num=147><td><pre><span class="token comment">#         continue</span></pre><tr><td data-num=148><td><pre><span class="token comment">#     print(j)</span></pre><tr><td data-num=149><td><pre><span class="token comment">#     a = []</span></pre><tr><td data-num=150><td><pre><span class="token comment">#     a.append(ord('^'))</span></pre><tr><td data-num=151><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=152><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = ord('^')</span></pre><tr><td data-num=153><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=154><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=155><td><pre><span class="token comment">#     a.append(64) # stm opcode[768] = ord('^');</span></pre><tr><td data-num=156><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=157><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=158><td><pre><span class="token comment">#     a.append(4) # opcode[[1]] ++</span></pre><tr><td data-num=159><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=160><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=161><td><pre><span class="token comment">#     a.append(64) # stm opcode[769] = ord('^');</span></pre><tr><td data-num=162><td><pre><span class="token comment">#     a.append(2)</span></pre><tr><td data-num=163><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=164><td><pre><span class="token comment">#     a.append(4) # opcode[[1]] ++</span></pre><tr><td data-num=165><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=166><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=167><td><pre><span class="token comment">#     a.append(64) # stm opcode[769] = ord('^');</span></pre><tr><td data-num=168><td><pre><span class="token comment">#     for i in table: # all register = 1</span></pre><tr><td data-num=169><td><pre><span class="token comment">#         if (i == 8 or i == 4 or i == 64):</span></pre><tr><td data-num=170><td><pre><span class="token comment">#             continue</span></pre><tr><td data-num=171><td><pre><span class="token comment">#         a.append(1)</span></pre><tr><td data-num=172><td><pre><span class="token comment">#         a.append(i)</span></pre><tr><td data-num=173><td><pre><span class="token comment">#         a.append(4)</span></pre><tr><td data-num=174><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=175><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=176><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 1 # fd = io</span></pre><tr><td data-num=177><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=178><td><pre><span class="token comment">#     a.append(j)</span></pre><tr><td data-num=179><td><pre><span class="token comment">#     a.append(1) # write</span></pre><tr><td data-num=180><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=181><td><pre><span class="token comment">#     a.append(16)</span></pre><tr><td data-num=182><td><pre><span class="token comment">#     a.append(1) # exit</span></pre><tr><td data-num=183><td><pre><span class="token comment">#     a_byte = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=184><td><pre><span class="token comment">#     p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=185><td><pre><span class="token comment">#     p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a_byte)</span></pre><tr><td data-num=186><td><pre><span class="token comment">#     time.sleep(0.3)</span></pre><tr><td data-num=187><td><pre><span class="token comment">#     print(p.recv())</span></pre><tr><td data-num=188><td><pre><span class="token comment">#     p.kill()</span></pre><tr><td data-num=189><td><pre></pre><tr><td data-num=190><td><pre><span class="token comment"># ## opcode[1025]</span></pre><tr><td data-num=191><td><pre><span class="token comment"># # 1</span></pre><tr><td data-num=192><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=193><td><pre><span class="token comment"># tmp_a = []</span></pre><tr><td data-num=194><td><pre><span class="token comment"># tmp_a.append(ord('^'))</span></pre><tr><td data-num=195><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=196><td><pre><span class="token comment"># tmp_a.append(4) # opcode[1024] = ord('^')</span></pre><tr><td data-num=197><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=198><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=199><td><pre><span class="token comment"># tmp_a.append(64) # stm opcode[768] = ord('^');</span></pre><tr><td data-num=200><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=201><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=202><td><pre><span class="token comment"># tmp_a.append(4) # opcode[[1]] ++</span></pre><tr><td data-num=203><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=204><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=205><td><pre><span class="token comment"># tmp_a.append(64) # stm opcode[769] = ord('^');</span></pre><tr><td data-num=206><td><pre><span class="token comment"># tmp_a.append(2)</span></pre><tr><td data-num=207><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=208><td><pre><span class="token comment"># tmp_a.append(4) # opcode[[1]] ++</span></pre><tr><td data-num=209><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=210><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=211><td><pre><span class="token comment"># tmp_a.append(64) # stm opcode[769] = ord('^');</span></pre><tr><td data-num=212><td><pre></pre><tr><td data-num=213><td><pre><span class="token comment"># for k in table: # test_register = 1</span></pre><tr><td data-num=214><td><pre><span class="token comment">#     a = tmp_a.copy()</span></pre><tr><td data-num=215><td><pre><span class="token comment">#     # print(a)</span></pre><tr><td data-num=216><td><pre><span class="token comment">#     if (k == 8 or k == 4 or k == 64):</span></pre><tr><td data-num=217><td><pre><span class="token comment">#         continue</span></pre><tr><td data-num=218><td><pre><span class="token comment">#     for i in table: # all register = 0</span></pre><tr><td data-num=219><td><pre><span class="token comment">#         if (i == 8 or i == 4 or i == 64):</span></pre><tr><td data-num=220><td><pre><span class="token comment">#             continue</span></pre><tr><td data-num=221><td><pre><span class="token comment">#         a.append(0)</span></pre><tr><td data-num=222><td><pre><span class="token comment">#         a.append(i)</span></pre><tr><td data-num=223><td><pre><span class="token comment">#         a.append(4)</span></pre><tr><td data-num=224><td><pre><span class="token comment">#     print(k)</span></pre><tr><td data-num=225><td><pre><span class="token comment">#     a.append(2)</span></pre><tr><td data-num=226><td><pre><span class="token comment">#     a.append(k)</span></pre><tr><td data-num=227><td><pre><span class="token comment">#     a.append(4) # one register = 1    </span></pre><tr><td data-num=228><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=229><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=230><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 1 # fd = io</span></pre><tr><td data-num=231><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=232><td><pre><span class="token comment">#     a.append(4)</span></pre><tr><td data-num=233><td><pre><span class="token comment">#     a.append(1) # write</span></pre><tr><td data-num=234><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=235><td><pre><span class="token comment">#     a.append(16)</span></pre><tr><td data-num=236><td><pre><span class="token comment">#     a.append(1) # exit</span></pre><tr><td data-num=237><td><pre><span class="token comment">#     a_byte = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=238><td><pre><span class="token comment">#     p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=239><td><pre><span class="token comment">#     p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a_byte)</span></pre><tr><td data-num=240><td><pre><span class="token comment">#     time.sleep(0.1)</span></pre><tr><td data-num=241><td><pre><span class="token comment">#     print(p.recv())</span></pre><tr><td data-num=242><td><pre><span class="token comment">#     p.kill()</span></pre><tr><td data-num=243><td><pre></pre><tr><td data-num=244><td><pre></pre><tr><td data-num=245><td><pre></pre><tr><td data-num=246><td><pre><span class="token comment">##  opcode[1025]</span></pre><tr><td data-num=247><td><pre><span class="token comment"># 32</span></pre><tr><td data-num=248><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=249><td><pre><span class="token comment"># tmp_a = []</span></pre><tr><td data-num=250><td><pre><span class="token comment"># tmp_a.append(ord('^'))</span></pre><tr><td data-num=251><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=252><td><pre><span class="token comment"># tmp_a.append(4) # opcode[1024] = ord('^')</span></pre><tr><td data-num=253><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=254><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=255><td><pre><span class="token comment"># tmp_a.append(64) # stm opcode[768] = ord('^');</span></pre><tr><td data-num=256><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=257><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=258><td><pre><span class="token comment"># tmp_a.append(4) # opcode[[1]] ++</span></pre><tr><td data-num=259><td><pre><span class="token comment"># tmp_a.append(ord('@'))</span></pre><tr><td data-num=260><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=261><td><pre><span class="token comment"># tmp_a.append(4) # opcode[1024] = ord('^')</span></pre><tr><td data-num=262><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=263><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=264><td><pre><span class="token comment"># tmp_a.append(64) # stm opcode[769] = ord('^');</span></pre><tr><td data-num=265><td><pre><span class="token comment"># tmp_a.append(2)</span></pre><tr><td data-num=266><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=267><td><pre><span class="token comment"># tmp_a.append(4) # opcode[[1]] ++</span></pre><tr><td data-num=268><td><pre><span class="token comment"># tmp_a.append(ord('#'))</span></pre><tr><td data-num=269><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=270><td><pre><span class="token comment"># tmp_a.append(4) # opcode[1024] = ord('^')</span></pre><tr><td data-num=271><td><pre><span class="token comment"># tmp_a.append(8)</span></pre><tr><td data-num=272><td><pre><span class="token comment"># tmp_a.append(1)</span></pre><tr><td data-num=273><td><pre><span class="token comment"># tmp_a.append(64) # stm opcode[769] = ord('^');</span></pre><tr><td data-num=274><td><pre></pre><tr><td data-num=275><td><pre><span class="token comment"># for k in table: # test opcode[1025]</span></pre><tr><td data-num=276><td><pre><span class="token comment">#     if (k == 1 or k == 8 or k == 64 or k == 4):</span></pre><tr><td data-num=277><td><pre><span class="token comment">#         continue</span></pre><tr><td data-num=278><td><pre><span class="token comment">#     a = tmp_a.copy()</span></pre><tr><td data-num=279><td><pre><span class="token comment">#     # print(a)</span></pre><tr><td data-num=280><td><pre><span class="token comment">#     for i in table: # all register = 0</span></pre><tr><td data-num=281><td><pre><span class="token comment">#         if (i == 8 or i == 4 or i == 64 or i == 1):</span></pre><tr><td data-num=282><td><pre><span class="token comment">#             continue</span></pre><tr><td data-num=283><td><pre><span class="token comment">#         a.append(0)</span></pre><tr><td data-num=284><td><pre><span class="token comment">#         a.append(i)</span></pre><tr><td data-num=285><td><pre><span class="token comment">#         a.append(4)</span></pre><tr><td data-num=286><td><pre><span class="token comment">#     print(k)</span></pre><tr><td data-num=287><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=288><td><pre><span class="token comment">#     a.append(k)</span></pre><tr><td data-num=289><td><pre><span class="token comment">#     a.append(4) # opcode[1025] # offset: 1  </span></pre><tr><td data-num=290><td><pre></pre><tr><td data-num=291><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=292><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=293><td><pre><span class="token comment">#     a.append(4) # opcode[1026] # len: 1  </span></pre><tr><td data-num=294><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=295><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=296><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 1 # fd = io</span></pre><tr><td data-num=297><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=298><td><pre><span class="token comment">#     a.append(4)</span></pre><tr><td data-num=299><td><pre><span class="token comment">#     a.append(1) # write</span></pre><tr><td data-num=300><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=301><td><pre><span class="token comment">#     a.append(16)</span></pre><tr><td data-num=302><td><pre><span class="token comment">#     a.append(1) # exit</span></pre><tr><td data-num=303><td><pre><span class="token comment">#     a_byte = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=304><td><pre><span class="token comment">#     p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=305><td><pre><span class="token comment">#     p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a_byte)</span></pre><tr><td data-num=306><td><pre><span class="token comment">#     time.sleep(0.1)</span></pre><tr><td data-num=307><td><pre><span class="token comment">#     print(p.recv())</span></pre><tr><td data-num=308><td><pre><span class="token comment">#     p.kill()</span></pre><tr><td data-num=309><td><pre></pre><tr><td data-num=310><td><pre></pre><tr><td data-num=311><td><pre><span class="token comment"># # read</span></pre><tr><td data-num=312><td><pre><span class="token comment"># 32</span></pre><tr><td data-num=313><td><pre><span class="token comment"># table = [1,2,4,8,16,32,64,0x80]</span></pre><tr><td data-num=314><td><pre><span class="token comment"># for k in [2,32]: # test read</span></pre><tr><td data-num=315><td><pre><span class="token comment">#     a = []</span></pre><tr><td data-num=316><td><pre><span class="token comment">#     print(k)</span></pre><tr><td data-num=317><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=318><td><pre><span class="token comment">#     a.append(32)</span></pre><tr><td data-num=319><td><pre><span class="token comment">#     a.append(4) # opcode[1025] # offset: 1  </span></pre><tr><td data-num=320><td><pre></pre><tr><td data-num=321><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=322><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=323><td><pre><span class="token comment">#     a.append(4) # opcode[1026] # len: 1 </span></pre><tr><td data-num=324><td><pre></pre><tr><td data-num=325><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=326><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=327><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 0 # fd = io</span></pre><tr><td data-num=328><td><pre></pre><tr><td data-num=329><td><pre><span class="token comment">#     a.append(2)</span></pre><tr><td data-num=330><td><pre><span class="token comment">#     a.append(k)</span></pre><tr><td data-num=331><td><pre><span class="token comment">#     a.append(1) # read</span></pre><tr><td data-num=332><td><pre></pre><tr><td data-num=333><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=334><td><pre><span class="token comment">#     a.append(8)</span></pre><tr><td data-num=335><td><pre><span class="token comment">#     a.append(4) # opcode[1024] = 1 # fd = io</span></pre><tr><td data-num=336><td><pre></pre><tr><td data-num=337><td><pre><span class="token comment">#     a.append(1)</span></pre><tr><td data-num=338><td><pre><span class="token comment">#     a.append(4)</span></pre><tr><td data-num=339><td><pre><span class="token comment">#     a.append(1) # write</span></pre><tr><td data-num=340><td><pre><span class="token comment">#     a.append(0)</span></pre><tr><td data-num=341><td><pre><span class="token comment">#     a.append(16)</span></pre><tr><td data-num=342><td><pre><span class="token comment">#     a.append(1) # exit</span></pre><tr><td data-num=343><td><pre><span class="token comment">#     a_byte = b''.join([bytes([i]) for i in a])</span></pre><tr><td data-num=344><td><pre><span class="token comment">#     p = process('/challenge/babyrev_level22.0')</span></pre><tr><td data-num=345><td><pre><span class="token comment">#     p.sendafter(b"This time, YOU'RE in control! Please input your yancode: ",a_byte)</span></pre><tr><td data-num=346><td><pre><span class="token comment">#     time.sleep(0.1)</span></pre><tr><td data-num=347><td><pre><span class="token comment">#     # print(p.recv())</span></pre><tr><td data-num=348><td><pre><span class="token comment">#     p.interactive()</span></pre><tr><td data-num=349><td><pre><span class="token comment">#     p.kill()</span></pre><tr><td data-num=350><td><pre></pre><tr><td data-num=351><td><pre></pre><tr><td data-num=352><td><pre></pre><tr><td data-num=353><td><pre><span class="token comment"># ----------------------------------------------------------------------------------------------------------------------------------- #</span></pre><tr><td data-num=354><td><pre><span class="token comment">#                                                               open -> </span></pre><tr><td data-num=355><td><pre><span class="token comment"># ----------------------------------------------------------------------------------------------------------------------------------- #</span></pre><tr><td data-num=356><td><pre><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=357><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'opcode[1024]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=358><td><pre>        <span class="token keyword">return</span> <span class="token number">8</span></pre><tr><td data-num=359><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'opcode[1025]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=360><td><pre>        <span class="token keyword">return</span> <span class="token number">32</span></pre><tr><td data-num=361><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'opcode[1026]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=362><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span></pre><tr><td data-num=363><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'opcode[1027]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=364><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span></pre><tr><td data-num=365><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'opcode[1028]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=366><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span></pre><tr><td data-num=367><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'opcode[1029]'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=368><td><pre>        <span class="token keyword">return</span> <span class="token number">64</span></pre><tr><td data-num=369><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'err register'</span><span class="token punctuation">)</span></pre><tr><td data-num=370><td><pre></pre><tr><td data-num=371><td><pre><span class="token keyword">def</span> <span class="token function">interpret_instruction</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=372><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'interpret_imm'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=373><td><pre>        <span class="token keyword">return</span> <span class="token number">4</span> <span class="token operator"><<</span> <span class="token number">16</span></pre><tr><td data-num=374><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'interpret_add'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=375><td><pre>        <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator"><<</span> <span class="token number">16</span></pre><tr><td data-num=376><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'interpret_stk'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=377><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span></pre><tr><td data-num=378><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'interpret_stm'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=379><td><pre>        <span class="token keyword">return</span> <span class="token number">64</span> <span class="token operator"><<</span> <span class="token number">16</span></pre><tr><td data-num=380><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'interpret_ldm'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=381><td><pre>        <span class="token keyword">return</span> <span class="token number">32</span> <span class="token operator"><<</span> <span class="token number">16</span></pre><tr><td data-num=382><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'interpret_cmp'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=383><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span></pre><tr><td data-num=384><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'interpret_jmp'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=385><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span></pre><tr><td data-num=386><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'interpret_sys'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=387><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator"><<</span> <span class="token number">16</span></pre><tr><td data-num=388><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'err instruction'</span><span class="token punctuation">)</span></pre><tr><td data-num=389><td><pre></pre><tr><td data-num=390><td><pre><span class="token keyword">def</span> <span class="token function">interpret_imm</span><span class="token punctuation">(</span>regs<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=391><td><pre>    <span class="token keyword">return</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_imm'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span>regs<span class="token punctuation">)</span> <span class="token operator"><<</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span></pre><tr><td data-num=392><td><pre></pre><tr><td data-num=393><td><pre><span class="token keyword">def</span> <span class="token function">interpret_stm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=394><td><pre>    <span class="token comment"># opcode[1025] = offset</span></pre><tr><td data-num=395><td><pre>    <span class="token comment"># opcode[1026] = value</span></pre><tr><td data-num=396><td><pre>    <span class="token keyword">return</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_stm'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1025]'</span><span class="token punctuation">)</span> <span class="token operator"><<</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1026]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=397><td><pre></pre><tr><td data-num=398><td><pre><span class="token keyword">def</span> <span class="token function">interpret_sys</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=399><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'open'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=400><td><pre>        <span class="token keyword">return</span> <span class="token number">8</span> <span class="token operator"><<</span> <span class="token number">8</span></pre><tr><td data-num=401><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'read_code'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=402><td><pre>        <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator"><<</span> <span class="token number">8</span></pre><tr><td data-num=403><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'read'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=404><td><pre>        <span class="token keyword">return</span> <span class="token number">32</span> <span class="token operator"><<</span> <span class="token number">8</span></pre><tr><td data-num=405><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'write'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=406><td><pre>        <span class="token keyword">return</span> <span class="token number">4</span> <span class="token operator"><<</span> <span class="token number">8</span></pre><tr><td data-num=407><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'sleep'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=408><td><pre>        <span class="token keyword">return</span> <span class="token number">128</span> <span class="token operator"><<</span> <span class="token number">8</span></pre><tr><td data-num=409><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">'exit'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=410><td><pre>        <span class="token keyword">return</span> <span class="token number">16</span> <span class="token operator"><<</span> <span class="token number">8</span></pre><tr><td data-num=411><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'err sys'</span><span class="token punctuation">)</span></pre><tr><td data-num=412><td><pre></pre><tr><td data-num=413><td><pre><span class="token keyword">def</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=414><td><pre>    <span class="token comment"># opcode[opcode[1024] + 768] = addr</span></pre><tr><td data-num=415><td><pre>    <span class="token comment"># opcode[1024] = fd</span></pre><tr><td data-num=416><td><pre>    <span class="token comment"># opcode[1026] = len</span></pre><tr><td data-num=417><td><pre>    <span class="token keyword">return</span> interpret_sys<span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">)</span> <span class="token operator">+</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_sys'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1024]'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre><tr><td data-num=418><td><pre></pre><tr><td data-num=419><td><pre><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=420><td><pre>    <span class="token comment"># opcode[1024] = fd</span></pre><tr><td data-num=421><td><pre>    <span class="token comment"># opcode[1025] = ret len</span></pre><tr><td data-num=422><td><pre>    <span class="token keyword">return</span> interpret_sys<span class="token punctuation">(</span><span class="token string">'read'</span><span class="token punctuation">)</span> <span class="token operator">+</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_sys'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1025]'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre><tr><td data-num=423><td><pre></pre><tr><td data-num=424><td><pre><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=425><td><pre>    <span class="token comment"># opcode[1024] = fd</span></pre><tr><td data-num=426><td><pre>    <span class="token keyword">return</span> interpret_sys<span class="token punctuation">(</span><span class="token string">'write'</span><span class="token punctuation">)</span> <span class="token operator">+</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_sys'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>register<span class="token punctuation">(</span><span class="token string">'opcode[1025]'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre><tr><td data-num=427><td><pre></pre><tr><td data-num=428><td><pre><span class="token keyword">def</span> <span class="token function">exitPro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=429><td><pre>    <span class="token keyword">return</span> interpret_sys<span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">)</span> <span class="token operator">+</span> interpret_instruction<span class="token punctuation">(</span><span class="token string">'interpret_sys'</span><span class="token punctuation">)</span></pre><tr><td data-num=430><td><pre></pre><tr><td data-num=431><td><pre>opcode_func <span class="token operator">=</span> <span class="token triple-quoted-string string">'''</span></pre><tr><td data-num=432><td><pre>interpret_imm('opcode[1025]',0) # offset</pre><tr><td data-num=433><td><pre>interpret_imm('opcode[1026]',ord('/')) # value</pre><tr><td data-num=434><td><pre>interpret_stm()</pre><tr><td data-num=435><td><pre>interpret_imm('opcode[1025]',1) # offset</pre><tr><td data-num=436><td><pre>interpret_imm('opcode[1026]',ord('f')) # value</pre><tr><td data-num=437><td><pre>interpret_stm()</pre><tr><td data-num=438><td><pre>interpret_imm('opcode[1025]',2) # offset</pre><tr><td data-num=439><td><pre>interpret_imm('opcode[1026]',ord('l')) # value</pre><tr><td data-num=440><td><pre>interpret_stm()</pre><tr><td data-num=441><td><pre>interpret_imm('opcode[1025]',3) # offset</pre><tr><td data-num=442><td><pre>interpret_imm('opcode[1026]',ord('a')) # value</pre><tr><td data-num=443><td><pre>interpret_stm()</pre><tr><td data-num=444><td><pre>interpret_imm('opcode[1025]',4) # offset</pre><tr><td data-num=445><td><pre>interpret_imm('opcode[1026]',ord('g')) # value</pre><tr><td data-num=446><td><pre>interpret_stm()</pre><tr><td data-num=447><td><pre></pre><tr><td data-num=448><td><pre>interpret_imm('opcode[1024]',0) # addr = opcode[0 + 768]</pre><tr><td data-num=449><td><pre>interpret_imm('opcode[1025]',0)</pre><tr><td data-num=450><td><pre>interpret_imm('opcode[1026]',0)</pre><tr><td data-num=451><td><pre>open()</pre><tr><td data-num=452><td><pre></pre><tr><td data-num=453><td><pre>interpret_imm('opcode[1026]',0x50) # len</pre><tr><td data-num=454><td><pre>read()</pre><tr><td data-num=455><td><pre></pre><tr><td data-num=456><td><pre>interpret_imm('opcode[1024]',1)</pre><tr><td data-num=457><td><pre>interpret_imm('opcode[1025]',0)</pre><tr><td data-num=458><td><pre>interpret_imm('opcode[1026]',0x50) # len</pre><tr><td data-num=459><td><pre>write()</pre><tr><td data-num=460><td><pre>exitPro()</pre><tr><td data-num=461><td><pre>'''</pre><tr><td data-num=462><td><pre>opcode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre><tr><td data-num=463><td><pre>opcode_func <span class="token operator">=</span> opcode_func<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span></pre><tr><td data-num=464><td><pre><span class="token comment"># print(opcode_func)</span></pre><tr><td data-num=465><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> opcode_func<span class="token punctuation">:</span></pre><tr><td data-num=466><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre><tr><td data-num=467><td><pre>        <span class="token keyword">continue</span></pre><tr><td data-num=468><td><pre>    p48 <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre><tr><td data-num=469><td><pre>    opcode<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p48 <span class="token operator">&</span> <span class="token number">0xff</span><span class="token punctuation">)</span></pre><tr><td data-num=470><td><pre>    opcode<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>p48 <span class="token operator">&</span> <span class="token number">0xff00</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span></pre><tr><td data-num=471><td><pre>    opcode<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>p48 <span class="token operator">&</span> <span class="token number">0xff0000</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span></pre><tr><td data-num=472><td><pre>opcode<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0x300</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>opcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><tr><td data-num=473><td><pre></pre><tr><td data-num=474><td><pre>a <span class="token operator">=</span> opcode</pre><tr><td data-num=475><td><pre><span class="token comment"># print(a)</span></pre><tr><td data-num=476><td><pre>a <span class="token operator">=</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span></pre><tr><td data-num=477><td><pre></pre><tr><td data-num=478><td><pre>p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">'/challenge/babyrev_level22.0'</span><span class="token punctuation">)</span></pre><tr><td data-num=479><td><pre>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">b"This time, YOU'RE in control! Please input your yancode: "</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span></pre><tr><td data-num=480><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><tr><td data-num=481><td><pre>p<span class="token punctuation">.</span>kill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></table></figure></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span><span class=text>Edited on</span><time title="Modified: 2024-04-09 10:17:08" datetime=2024-04-09T10:17:08+08:00 itemprop=dateModified>2024-04-09</time></span></div><div class=reward><button><i class="ic i-heartbeat"></i>Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*<div id=qr><div><img alt="Moyao WeChat Pay" data-src=/assets/wechatpay.png loading=lazy><p>WeChat Pay</div><div><img alt="Moyao Alipay" data-src=/assets/alipay.png loading=lazy><p>Alipay</div></div></div><div id=copyright><ul><li class=author><strong>Post author: </strong>Moyao<i class="ic i-at"><em>@</em></i>rev@天枢<li class=link><strong>Post link: </strong><a href=https://demoyao100.github.io/2024/04/08/vm%E5%88%9D%E6%8E%A2/ title=vm初探>https://demoyao100.github.io/2024/04/08/vm初探/</a><li class=license><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel=noopener target=_blank><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> unless stating additionally.</ul></div></footer></article></div><div class=post-nav><div class="item left"><a data-background-image=https://tva4.sinaimg.cn/mw690/6833939bly1gicit31ffoj20zk0m8naf.jpg href=/2024/04/04/sandbox/ itemprop=url rel=prev title=sandbox><span class=type>Previous Post</span><h3>sandbox</h3></a></div><div class="item right"><a data-background-image=https://tva4.sinaimg.cn/mw690/6833939bly1gicis081o9j20zk0m8dmr.jpg href=/2024/04/14/web%E5%85%A5%E9%97%A8%E6%93%8D%E4%BD%9C/ itemprop=url rel=next title=web入门操作><span class=type>Next Post</span><h3>web入门操作</h3></a></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=Contents><ol class=toc><li class="toc-item toc-level-6"><a class=toc-link href=#preface%E6%9C%80%E5%90%8E%E4%B8%A4%E4%B8%AA%E9%80%86%E5%90%91%E9%A2%98%E5%85%B6%E5%AE%9E%E6%9B%B4%E5%83%8Fpwn%E7%9A%84%E5%85%A5%E9%97%A8vm%E5%86%99%E4%B8%AAorw%E6%9C%80%E5%90%8E%E4%B8%80%E9%A2%98%E9%9C%80%E8%A6%81%E7%94%A8%E5%90%84%E7%A7%8D%E6%96%B9%E6%B3%95bruteforce-leak-opcode%E7%94%B1%E4%BA%8E%E9%99%84%E4%BB%B6%E4%B8%8D%E5%90%8C%E8%BF%99%E9%87%8Cexp%E7%9B%B8%E5%BD%93%E4%BA%8E%E4%B8%80%E4%B8%AA%E6%80%9D%E8%B7%AF><span class=toc-number>1.</span> <span class=toc-text> PREFACE：最后两个逆向题，其实更像 pwn 的入门 vm，写个 orw，最后一题需要用各种方法 bruteforce & leak opcode（由于附件不同这里 exp 相当于一个思路）</span></a></ol><li class="toc-item toc-level-5"><a class=toc-link href=#%E7%9B%B4%E7%99%BD%E7%9A%84orw><span class=toc-number></span> <span class=toc-text> 直白的 orw</span></a><li class="toc-item toc-level-5"><a class=toc-link href=#%E9%9A%8F%E6%9C%BA%E5%8C%96opcode%E7%9A%84orw><span class=toc-number></span> <span class=toc-text> 随机化 opcode 的 orw</span></a></div><div class="related panel pjax" data-title=Related></div><div class="overview panel" data-title=Overview><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img alt=Moyao class=image data-src=/assets/avatar.jpg itemprop=image loading=lazy><p class=name itemprop=name>Moyao<div class=description itemprop=description>Write down something interesting I met<br> Feel free to mail me if you have something wanted to talk about, plz mail: &LTmoyaoxue@outlook.com></div></div><nav class=state><div class="item posts"><a href=/archives/><span class=count>74</span><span class=name>posts</span></a></div><div class="item tags"><a href=/tags/><span class=count>14</span><span class=name>tags</span></a></div></nav><div class=social><a class="item github" href=https://github.com/name rel=noopener target=_blank title=https://github.com/name><i class="ic i-github"></i></a></div><div class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i>Home</a></div></div></div></div><ul id=quick><li class="prev pjax"><a title="Previous Post" href=/2024/04/14/web%E5%85%A5%E9%97%A8%E6%93%8D%E4%BD%9C/ rel=prev><i class="ic i-chevron-left"></i></a><li class=up><i class="ic i-arrow-up"></i><li class=down><i class="ic i-arrow-down"></i><li class="next pjax"><a title="Next Post" href=/2024/04/04/sandbox/ rel=next><i class="ic i-chevron-right"></i></a><li class=percent></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>Random Posts</h2><ul><li class=item><div class=breadcrumb></div><span><a href=/2023/09/18/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/>pickle反序列化</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/10/04/flare-on2023/>flare-on2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/09/18/%E9%B9%A4%E5%9F%8E2023/>鹤城2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/11/29/mac%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/>mac环境配置</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/10/03/docker%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%95/>docker操作记录</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/11/08/ACTF2023/>ACTF2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/10/01/mapleCTF2023/>mapleCTF2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2022/08/26/%E5%9F%BA%E4%BA%8Ehexo%E6%A1%86%E6%9E%B6%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/>to build your blog on github</a></span><li class=item><div class=breadcrumb></div><span><a href=/2023/11/12/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%812023/>强网拟态2023</a></span><li class=item><div class=breadcrumb></div><span><a href=/2022/11/01/pythonJail/>pythonJail</a></span></ul></div><div class="rpost pjax"><h2>Recent Comments</h2><ul class=leancloud-recent-comment id=new-comment></ul></div></div><div class=status><div class=copyright>© 2022 -<span itemprop=copyrightYear>2024</span><span class=with-love><i class="ic i-sakura rotate"></i></span><span class=author itemprop=copyrightHolder>Moyao @ Moyao の小屋</span></div><div class=count><span class=post-meta-item-icon><i class="ic i-chart-area"></i></span><span title="Symbols count total">649k words</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon><i class="ic i-coffee"></i></span><span title="Reading time total">9:50</span></div><div class=powered-by>Powered by <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & Theme.<a href=https://github.com/theme-shoka-x/hexo-theme-shokaX/ rel=noopener target=_blank>ShokaX</a></div></div></div></footer></div><script data-config>var LOCAL = {
        path: `2024/04/08/vm初探/`,
        favicon: {
        show: `(●´3｀●) Here we go again.`,
        hide: `(´Д｀) It's a disaster!`
    },
    search: {
        placeholder: "Search for Posts",
        empty: "We didn't find any results for the search: ${query}",
        stats: "${hits} results found in ${time} ms"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">Article Timeliness Alert</span><br>This is an article published {{publish}} days ago and last updated {{updated}} days ago. Some information may have changed, so please be careful to screen it.</p></div>`,
    quiz: {
        choice: `Multiple Choice`,
        multiple: `Multiple Answer`,
        true_false: `True/False`,
        essay: `Questions`,
        gap_fill: `Gap Filling`,
        mistake: `Wrong Answer`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};</script><script src=https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.global.prod.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.2.4/pace.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js></script><script src=https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js></script><script src=https://npm.webcache.cn/quicklink@2.3.0/dist/quicklink.umd.js></script><script src=/js/app.js?v=0.3.15></script>