<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"demoyao100.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="# Some reverse questions I didn’t have time to solve. (Or didn’t solve out…)">
<meta property="og:type" content="article">
<meta property="og:title" content="hnctfRe">
<meta property="og:url" content="https://demoyao100.github.io/hnctfRe/index.html">
<meta property="og:site_name" content="Moyao の小屋">
<meta property="og:description" content="# Some reverse questions I didn’t have time to solve. (Or didn’t solve out…)">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/cm2.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/debug2_1.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/debug2_2.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/dll_1.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/ez_maze_1.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/extracted.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/uncompyle6.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/cmakeInstall.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/magicNumber_1.jpg">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/uncompyle.jpg">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/findItShell.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/finditIda_1.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/finditIda_2.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/finditIda_3.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/flower_junkcode_1.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/flower_junkcode_2.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/flowerPDF.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/flowerIda.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/flowerEncrypt.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/dynamic_1.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/dynamic_2.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/dynamic_3.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/dynamic_4.png">
<meta property="og:image" content="https://demoyao100.github.io/hnctfRe/dynamic_5.png">
<meta property="article:published_time" content="2022-11-02T13:08:02.000Z">
<meta property="article:modified_time" content="2024-05-05T01:55:38.375Z">
<meta property="article:author" content="Moyao">
<meta property="article:tag" content="re">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://demoyao100.github.io/hnctfRe/cm2.png">


<link rel="canonical" href="https://demoyao100.github.io/hnctfRe/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://demoyao100.github.io/hnctfRe/","path":"hnctfRe/","title":"hnctfRe"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>hnctfRe | Moyao の小屋</title>
  
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KKC145B2WB"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KKC145B2WB","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Moyao の小屋</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hi,I'm Moyaoxue</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags.html" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories.html" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-6"><a class="nav-link" href="#some-reverse-questions-i-didnt-have-time-to-solve-or-didnt-solve-out"><span class="nav-number">1.</span> <span class="nav-text"> Some reverse questions I didn’t have time to solve. (Or didn’t solve out…)</span></a></li></ol><li class="nav-item nav-level-3"><a class="nav-link" href="#help_me"><span class="nav-number"></span> <span class="nav-text"> Help_Me!</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#my-exp"><span class="nav-number"></span> <span class="nav-text"> My exp:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#official-exp"><span class="nav-number"></span> <span class="nav-text"> Official exp:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cm2"><span class="nav-number"></span> <span class="nav-text"> CM2</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#dont-understand-how-to-debug-to-find-the-place-though-by-guessing-i-work-it-out-anyway"><span class="nav-number">1.</span> <span class="nav-text"> Don’t understand how to debug to find the place… Though by guessing I work it out anyway.</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#officail-wp"><span class="nav-number"></span> <span class="nav-text"> Officail wp:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#try2debugplusplus"><span class="nav-number"></span> <span class="nav-text"> Try2debugPlusPlus</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what_1in_d11"><span class="nav-number"></span> <span class="nav-text"> What_1in_D11</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#official-writeup"><span class="nav-number"></span> <span class="nav-text"> Official writeup:</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#a-btea-encrypt-which-i-am-not-fimilar-with-yet-shall-get-more-study-about-encryption-and-decryption-later"><span class="nav-number">1.</span> <span class="nav-text"> (A btea encrypt, which I am not fimilar with yet. Shall get more study about encryption and decryption later.)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mazes"><span class="nav-number"></span> <span class="nav-text"> Mazes</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#a-bit-complex-wait-until-later"><span class="nav-number">1.</span> <span class="nav-text"> A bit complex, wait until later…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stub"><span class="nav-number"></span> <span class="nav-text"> stub</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#never-seen-before-later"><span class="nav-number">1.</span> <span class="nav-text"> Never seen before, later…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ez_maze"><span class="nav-number"></span> <span class="nav-text"> ez_maze</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#complex-it-is"><span class="nav-number">1.</span> <span class="nav-text"> complex it is…</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#some-magic-number"><span class="nav-number"></span> <span class="nav-text"> some magic number:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#findit"><span class="nav-number"></span> <span class="nav-text"> findit</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#open-it-with-ida"><span class="nav-number"></span> <span class="nav-text"> Open it with ida.</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#official-wp"><span class="nav-number"></span> <span class="nav-text"> Official wp:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#flower"><span class="nav-number"></span> <span class="nav-text"> flower</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#some-script-to-nop-the-junkcodes"><span class="nav-number"></span> <span class="nav-text"> Some script to nop the junkcodes:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#scripts1"><span class="nav-number"></span> <span class="nav-text"> scripts1:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#scripts2"><span class="nav-number"></span> <span class="nav-text"> scripts2:</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#some-interlude"><span class="nav-number">1.</span> <span class="nav-text"> Some interlude:</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#anyway-the-uncompilation-shall-look-like-this"><span class="nav-number"></span> <span class="nav-text"> Anyway, the uncompilation shall look like this:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#the-encrypt-function"><span class="nav-number"></span> <span class="nav-text"> The encrypt function:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#now-we-get-the-encryption-we-can-know-that-it-is-a-rc4-encryption-and-here-comes-the-official-exp"><span class="nav-number"></span> <span class="nav-text"> Now we get the encryption, we can know that it is a RC4- encryption, and here comes the official exp:</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#just-input-a-series-of-1-and-look-into-the-ecx-register"><span class="nav-number">1.</span> <span class="nav-text"> Just input a series of ‘1’ and look into the  ECX  register!</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#and-so-on"><span class="nav-number"></span> <span class="nav-text"> And so on…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#maze"><span class="nav-number"></span> <span class="nav-text"> MAZE</span></a></li></div>
        </div>
        

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Moyao" src="/images/avatar.webp">
  <p class="site-author-name" itemprop="name">Moyao</p>
  <div class="site-description" itemprop="description">Write down something interesting I met<br>
Feel free to mail me if you have something wanted to talk about, plz
mail: &lt;moyaoxue@outlook.com&gt;
</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">85</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags.html">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/moyaoxue@outlook.com" title="E-Mail → moyaoxue@outlook.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://demoyao100.github.io/hnctfRe/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Moyao">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyao の小屋">
      <meta itemprop="description" content="Write down something interesting I met<br />
Feel free to mail me if you have something wanted to talk about, plz
mail: <moyaoxue@outlook.com>
">
    </span>

    <span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="hnctfRe | Moyao の小屋">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          hnctfRe
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-02 21:08:02" itemprop="dateCreated datePublished" datetime="2022-11-02T21:08:02+08:00">2022-11-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h6 id="some-reverse-questions-i-didnt-have-time-to-solve-or-didnt-solve-out"><a class="markdownIt-Anchor" href="#some-reverse-questions-i-didnt-have-time-to-solve-or-didnt-solve-out">#</a> Some reverse questions I didn’t have time to solve. (Or didn’t solve out…)</h6>
<span id="more"></span>
<h3 id="help_me"><a class="markdownIt-Anchor" href="#help_me">#</a> Help_Me!</h3>
<h5 id="my-exp"><a class="markdownIt-Anchor" href="#my-exp">#</a> My exp:</h5>
<pre><code>#include&lt;bits/stdc++.h&gt;
using namespace std;
int v12[1000]={0};
int v13[1000]={0};
long long maxn;
int v[1000];
void dfs(int cns,int n,int num,long long sum){
    if (num&gt;200 || n==20)
    {
        if (n!=20)
        sum-=v12[n];
        cns--;
        if (sum&gt;=maxn){
            maxn=sum;
            cout&lt;&lt;"sum  =  "&lt;&lt;sum&lt;&lt;"    :  "&lt;&lt;"cns="&lt;&lt;cns&lt;&lt;"   ";
            for (int i=0;i&lt;cns;i++){
                cout&lt;&lt;v[i]&lt;&lt;" ";
            }
            cout&lt;&lt;endl;
        }
        return ;
    }
    
    for (int i=n+1;i&lt;=20;i++){
        v[cns]=i;
        
        dfs(cns+1,i,num+v13[i],sum+v12[i]);
    }
}


int main(){
    
    v12[0] = 26;
    v12[1] = 59;
    v12[2] = 30;
    v12[3] = 19;
    v12[4] = 66;
    v12[5] = 85;
    v12[6] = 94;
    v12[7] = 8;
    v12[8] = 3;
    v12[9] = 44;
    v12[20] = 1000;
    v12[10] = 5;
    v12[11] = 1;
    v12[12] = 41;
    v12[13] = 82;
    v12[14] = 76;
    v12[15] = 1;
    v12[16] = 12;
    v12[17] = 81;
    v12[18] = 73;
    v12[19] = 32;
    v12[20]=1;
    v13[0] = 71;
    v13[1] = 34;
    v13[20] = 1000;
    v13[2] = 82;
    v13[3] = 23;
    v13[4] = 1;
    v13[5] = 88;
    v13[6] = 12;
    v13[7] = 57;
    v13[8] = 10;
    v13[9] = 68;
    v13[10] = 5;
    v13[11] = 33;
    v13[12] = 37;
    v13[13] = 69;
    v13[14] = 98;
    v13[15] = 24;
    v13[16] = 26;
    v13[17] = 83;
    v13[18] = 16;
    v13[19] = 26;
    v13[20]=1;
    maxn=0;
    dfs(0,-1,0,1);
}
</code></pre>
<h5 id="official-exp"><a class="markdownIt-Anchor" href="#official-exp">#</a> Official exp:</h5>
<pre><code>#include "iostream"
#include "stdio.h"
using namespace std;
int val[50]={26, 59, 30, 19, 66, 85, 94, 8, 3, 44, 5, 1, 41, 82, 76, 1,    12,    81,    73,    32},
w[50]={71, 34, 82, 23, 1,88,12,57, 10, 68, 5, 33,    37,    69,    98,    24, 26,    83, 16, 26};
int dp[21][301];
int main()
{
    int t=200;
    int m = 20;
    for(int i=1;i&lt;=m;i++) 
        for(int j=t;j&gt;=0;j--)  
    {
        if(j&gt;=w[i])//容量可以放 
        {
            int tmp;
            dp[i][j]=max(dp[i-1][j-w[i]]+val[i],dp[i-1][j]);
        }  
        else
        {
            dp[i][j]=dp[i-1][j];
        }              
    }
    //dp[i][j] = max(dp[i-1][j-w[i]]+val[i],dp[i-1][j]);
    int x = 20;
    int y = 200;
    while(x!=0)
    {
        if(dp[x-1][y-w[x]]+val[x] &gt; dp[x-1][y])        
        {
            printf("%d,",x); 
            y-=w[x];
        }
        x-=1;
    }
    return 0;
}
</code></pre>
<p>A 0-1 bag problem. And notice that you should <c style="color: #FF0000;">ADD</c> v12, not MULTIPLY, like in the ida…</p>
<h3 id="cm2"><a class="markdownIt-Anchor" href="#cm2">#</a> CM2</h3>
<h6 id="dont-understand-how-to-debug-to-find-the-place-though-by-guessing-i-work-it-out-anyway"><a class="markdownIt-Anchor" href="#dont-understand-how-to-debug-to-find-the-place-though-by-guessing-i-work-it-out-anyway">#</a> Don’t understand how to debug to find the place… Though by guessing I work it out anyway.</h6>
<h5 id="officail-wp"><a class="markdownIt-Anchor" href="#officail-wp">#</a> Officail wp:</h5>
<p><img src="/hnctfRe/cm2.webp" alt="cm2"></p>
<h3 id="try2debugplusplus"><a class="markdownIt-Anchor" href="#try2debugplusplus">#</a> Try2debugPlusPlus</h3>
<p>Nop the  <code>IsDebuggerPresent()</code> (noticed that there are two of them) and get the key(remember to set breakpoint after  <code>printf()</code> ):</p>
<p><img src="/hnctfRe/debug2_1.webp" alt="debug2_1"></p>
<p>Though is easy for us to decrypt the tea_encrypt, question setter seems to have forgotten something…</p>
<p><img src="/hnctfRe/debug2_2.webp" alt="debug2_2"></p>
<h3 id="what_1in_d11"><a class="markdownIt-Anchor" href="#what_1in_d11">#</a> What_1in_D11</h3>
<p>Repair the upx’s features(easy in this problem, to study more you can refer to <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-326995-1-1.html">this blog</a>)</p>
<p>And  <code>upx -d</code>  to unpacked the .dll, check it in ida, we got:</p>
<p><img src="/hnctfRe/dll_1.webp" alt="dll"></p>
<h5 id="official-writeup"><a class="markdownIt-Anchor" href="#official-writeup">#</a> Official writeup:</h5>
<h6 id="a-btea-encrypt-which-i-am-not-fimilar-with-yet-shall-get-more-study-about-encryption-and-decryption-later"><a class="markdownIt-Anchor" href="#a-btea-encrypt-which-i-am-not-fimilar-with-yet-shall-get-more-study-about-encryption-and-decryption-later">#</a> (A btea encrypt, which I am not fimilar with yet. Shall get more study about encryption and decryption later.)</h6>
<pre><code>#include &lt;stdio.h&gt;  
#include &lt;stdint.h&gt;  
#define DELTA 0x9e3779b9  
#define MX (((z&gt;&gt;5^y&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))  
void btea(uint32_t *v, int n, uint32_t const key[4])  
{  
    uint32_t y, z, sum;  
    unsigned p, rounds, e;  
    if (n &gt; 1)            /* Coding Part */  
    {  
        rounds = 6 + 52/n;  
        sum = 0;  
        z = v[n-1];  
        do  
        {  
            sum += DELTA;  
            e = (sum &gt;&gt; 2) &amp; 3;  
            for (p=0; p&lt;n-1; p++)  
            {  
                y = v[p+1];  
                z = v[p] += MX;  
            }  
            y = v[0];  
            z = v[n-1] += MX;  
        }  
        while (--rounds);  
    }  
    else if (n &lt; -1)      /* Decoding Part */  
    {  
        n = -n;  
        rounds = 6 + 52/n;  
        sum = rounds*DELTA;  
        y = v[0];  
        do  
        {  
            e = (sum &gt;&gt; 2) &amp; 3;  
            for (p=n-1; p&gt;0; p--)  
            {  
                z = v[p-1];  
                y = v[p] -= MX;  
            }  
            z = v[n-1];  
            y = v[0] -= MX;  
            sum -= DELTA;  
        }  
        while (--rounds);  
    }  
}  
int main()  
{  
    unsigned int enc[8]={0x22a577c1,0x1c12c03,0xc74c3ebd,0xa9d03c85,0xadb8ffb3};
    uint32_t const k[4]= {55,66,77,88};  
    int n= 5; //n的绝对值表示v的长度，取正表示加密，取负表示解密  
    // v为要加密的数据是两个32位无符号整数  
    // k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位  
    btea(enc, -n, k);  
    for(int i=0;i&lt;5;i++)
    {
            printf("%x",enc[i]);
        }
    return 0;  
}  
</code></pre>
<h3 id="mazes"><a class="markdownIt-Anchor" href="#mazes">#</a> Mazes</h3>
<h6 id="a-bit-complex-wait-until-later"><a class="markdownIt-Anchor" href="#a-bit-complex-wait-until-later">#</a> A bit complex, wait until later…</h6>
<h3 id="stub"><a class="markdownIt-Anchor" href="#stub">#</a> stub</h3>
<h6 id="never-seen-before-later"><a class="markdownIt-Anchor" href="#never-seen-before-later">#</a> Never seen before, later…</h6>
<h3 id="ez_maze"><a class="markdownIt-Anchor" href="#ez_maze">#</a> ez_maze</h3>
<p>We get a .exe file, from its’ icon we know that we should uncompile it to .pyc with  <code>pyinstxtractor</code></p>
<p><img src="/hnctfRe/ez_maze_1.webp" alt="ez_maze"></p>
<p>Then, we got a package  <code>_extracted</code> :</p>
<h6 id="complex-it-is"><a class="markdownIt-Anchor" href="#complex-it-is">#</a> complex it is…</h6>
<p><img src="/hnctfRe/extracted.webp" alt="extracted"></p>
<p>Find a file named  <code>maze</code>  (without a suffix one!) Change its suffix into  <code>.pyc</code>  and Try  <code>compyle6 -o maze.py maze.pyc</code> , it went wrong:</p>
<p><img src="/hnctfRe/uncompyle6.webp" alt="compyle6"></p>
<p>That’s when you find out that pyinstxtractor didn’t fix your .pyc file’s magic number.</p>
<p><img src="/hnctfRe/cmakeInstall.webp" alt="cmake"></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/231188.htm">The link problem setter gives you</a>, which does no help at all…The  <code>magic number</code>  of the file  <code>struct</code>  is destroy as well…</p>
<p><img src="/hnctfRe/magicNumber_1.webp" alt="magicNumber_1"></p>
<p>I been trying tools like  <code>uncompyle6</code> (which does not support python 3.10, and install python 3.9 does not help at all. Later I should look into this problem and try to solved it…)  and  <code>pycdc</code> (which is said to support high edition, but can not identify the magic number as well) However, when I tried to add some magic number from other python edition(Python 3.8b2, if I remember it right), and put it in an <a target="_blank" rel="noopener" href="https://tool.lu/pyc/">online uncompiler</a>. It just worked…</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Here-is-SG/p/15885799.html">a blog from my classmate that may help(though I do not really think so…)</a></p>
</blockquote>
<h5 id="some-magic-number"><a class="markdownIt-Anchor" href="#some-magic-number">#</a> some magic number:</h5>
<pre><code>enum PycMagic {
    MAGIC_1_0 = 0x00999902,
    MAGIC_1_1 = 0x00999903, /* Also covers 1.2 */
    MAGIC_1_3 = 0x0A0D2E89,
    MAGIC_1_4 = 0x0A0D1704,
    MAGIC_1_5 = 0x0A0D4E99,
    MAGIC_1_6 = 0x0A0DC4FC,

    MAGIC_2_0 = 0x0A0DC687,
    MAGIC_2_1 = 0x0A0DEB2A,
    MAGIC_2_2 = 0x0A0DED2D,
    MAGIC_2_3 = 0x0A0DF23B,
    MAGIC_2_4 = 0x0A0DF26D,
    MAGIC_2_5 = 0x0A0DF2B3,
    MAGIC_2_6 = 0x0A0DF2D1,
    MAGIC_2_7 = 0x0A0DF303,

    MAGIC_3_0 = 0x0A0D0C3A,
    MAGIC_3_1 = 0x0A0D0C4E,
    MAGIC_3_2 = 0x0A0D0C6C,
    MAGIC_3_3 = 0x0A0D0C9E,
    MAGIC_3_4 = 0x0A0D0CEE,
    MAGIC_3_5 = 0x0A0D0D16,
    MAGIC_3_5_3 = 0x0A0D0D17,
    MAGIC_3_6 = 0x0A0D0D33,
    MAGIC_3_7 = 0x0A0D0D42,
    MAGIC_3_8 = 0x0A0D0D55,
    MAGIC_3_9 = 0x0A0D0D61,
};
</code></pre>
<p>uncompyle:(to long the maze is, I didn’t put it here)</p>
<p><img src="/hnctfRe/uncompyle.webp" alt="uncompyle"></p>
<p>Dfs script(From official wp):</p>
<pre><code>map1=[...]
map2 =  [[0 for i in range(len(map1))] for i in range(len(map1)) ]
flag=""
def DFS(x,y):
    global flag
    if x == len(map1) - 2 and y == len(map1) - 2: #判断边界
        print(flag)
    if map1[x+1][y] == 0 and map2[x+1][y] == 0:
        map2[x][y] = 1
        flag += 's'
        DFS(x+1,y)
        flag = flag[:-1]
        map2[x][y] = 0
    if map1[x-1][y] == 0 and map2[x-1][y] == 0:
        map2[x][y] = 1
        flag += 'w'
        DFS(x-1,y)
        flag = flag[:-1]
        map2[x][y] = 0
    if map1[x][y+1] == 0 and map2[x][y+1] == 0:
        map2[x][y] = 1
        flag += 'd'
        DFS(x,y+1)
        flag = flag[:-1]
        map2[x][y] = 0
    if map1[x][y-1] == 0 and map2[x][y-1] == 0:
        map2[x][y] = 1
        flag += 'a'
        DFS(x,y-1)
        flag = flag[:-1]
        map2[x][y] = 0
y=1
x=1
DFS(x,y)
</code></pre>
<h3 id="findit"><a class="markdownIt-Anchor" href="#findit">#</a> findit</h3>
<p>Gets a .exe file, check whether shell exists.</p>
<p><img src="/hnctfRe/findItShell.webp" alt="shell"></p>
<h5 id="open-it-with-ida"><a class="markdownIt-Anchor" href="#open-it-with-ida">#</a> Open it with ida.</h5>
<p><img src="/hnctfRe/finditIda_1.webp" alt="ida1"><br>
<img src="/hnctfRe/finditIda_2.webp" alt="ida2"><br>
<img src="/hnctfRe/finditIda_3.webp" alt="ida3"></p>
<p>A complex encryption. The key and the flag both needs to be brute forces out. I shall do a emersion later…</p>
<h5 id="official-wp"><a class="markdownIt-Anchor" href="#official-wp">#</a> Official wp:</h5>
<pre><code>mid=[32,59,121,60,125,45,32,17,38,0,43,45,48,48,28,42,11,20,49,100,63,119,103,53,173,46,136,158,49,78,78,176]
enc=[29,70,92,84,87,19,61,43,62,60,29,9,18,63,6,6,42,14,124,110,109,60,105,191,7,162,64,104,92,61,223,179]
flag=[0]*32
flag[31]=179
flag[30]=223
print(flag)
#th1s_3ncryt_is_s0_e@sy!1
key = [ord(i) for i in "HN_CTF"]
def decrypt(arr):
    for i in range(0,len(arr)//4):
        tmp = arr[4*i:4*i+4]
        st = ""
        st+=chr(tmp[3]^key[i%6])
        st+=chr(tmp[0]^key[i%6])
        st+=chr(tmp[2]^key[i%6])
        st+=chr(tmp[1]^key[i%6])
        print(st,end='')
    print()   
    pass
def dfs(deep):
    global flag
    if(deep==0):
        decrypt(flag)
    else:
        for i in range(0,0xff):
            if( enc[deep-1] == (0x12+deep-1)^ ((i+12)%24 )^ i ^ flag[deep]):
                flag[deep-1] = i
                dfs(deep-1)
dfs(31)
</code></pre>
<h3 id="flower"><a class="markdownIt-Anchor" href="#flower">#</a> flower</h3>
<p>From ida, there are a lot of junkcodes inside, and we have to patch them before I can analyze the code.</p>
<p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1512089-1-1.html">junkcode</a></p>
<h5 id="some-script-to-nop-the-junkcodes"><a class="markdownIt-Anchor" href="#some-script-to-nop-the-junkcodes">#</a> Some script to nop the junkcodes:</h5>
<p><img src="/hnctfRe/flower_junkcode_1.webp" alt="junkcode1"></p>
<h5 id="scripts1"><a class="markdownIt-Anchor" href="#scripts1">#</a> scripts1:</h5>
<pre><code>import idc
import idautils
start =0x00401000
end = 0x00401401
bad=[0x75,0x02,0x74,0x01,0xc7]

for i in range(start,end):
    if idc.get_wide_byte(i) == 0x75:
        flag=1
        for j in range(len(bad)):
            if(idc.get_wide_byte(i+j)!= bad[j]):
                flag=0
                break
        if flag==1:
            for j in range(len(bad)):
                patch_byte(i+j,0x90)
                print("success")
</code></pre>
<h5 id="scripts2"><a class="markdownIt-Anchor" href="#scripts2">#</a> scripts2:</h5>
<p><img src="/hnctfRe/flower_junkcode_2.webp" alt="junkcode2"></p>
<pre><code>import idc
import idautils
start =0x00401000
end = 0x00401401
bad=[0xe8,0x01,0x00,0x00,0x00,0xe8,0x36,0x83,0x04,0x24,0x08,0xc3,0xe8]

for i in range(start,end):
    if idc.get_wide_byte(i) == 0xe8:
        flag=1
        for j in range(len(bad)):
            if(idc.get_wide_byte(i+j)!= bad[j]):
                flag=0
                break
        if flag==1:
            for j in range(len(bad)):
                patch_byte(i+j,0x90)
                print("success")
</code></pre>
<h6 id="some-interlude"><a class="markdownIt-Anchor" href="#some-interlude">#</a> Some interlude:</h6>
<p><img src="/hnctfRe/flowerPDF.webp" alt="PDF"></p>
<h5 id="anyway-the-uncompilation-shall-look-like-this"><a class="markdownIt-Anchor" href="#anyway-the-uncompilation-shall-look-like-this">#</a> Anyway, the uncompilation shall look like this:</h5>
<p><img src="/hnctfRe/flowerIda.webp" alt="ida"></p>
<h5 id="the-encrypt-function"><a class="markdownIt-Anchor" href="#the-encrypt-function">#</a> The encrypt function:</h5>
<p><img src="/hnctfRe/flowerEncrypt.webp" alt="encrypt"></p>
<h5 id="now-we-get-the-encryption-we-can-know-that-it-is-a-rc4-encryption-and-here-comes-the-official-exp"><a class="markdownIt-Anchor" href="#now-we-get-the-encryption-we-can-know-that-it-is-a-rc4-encryption-and-here-comes-the-official-exp">#</a> Now we get the encryption, we can know that it is a RC4- encryption, and here comes the official exp:</h5>
<pre><code>#include &lt;iostream&gt;
using namespace std;
unsigned int ar[40] = { 0x4d,0xffffffe6,0x49,0xffffff95,0x3,0x2d,0x2b,0xffffffba,0xffffffea,0x6d,0xffffffff,0x59,0x70,0x0,0x1b,0xffffffa9,0x2c,0xffffffb0,0x32,0xffffff98,0x6f,0xffffff8c,0x56,0xffffffa2,0x4c,0x79,0x7f };
// c[i]_ = c[i]^c[(i+1)%27]
// c[26]_ = c[26]^c_[0]
unsigned char st[16] = "Hello_Ctfers!!!";
void O0oo00OOo00o0(unsigned char *m, int mlen, int keylen) {
        unsigned char s[256];
        unsigned char t[256];
        int i;
        for ( i = 0; i &lt; 256; i++) { //初始化s和t向量 
                s[i] = i;
                t[i] = st[i%keylen];
        }        
        int j = 0;
        for ( i = 0; i &lt; 256; i++) {
                j = (j + s[i] + t[i]) % 256;
                swap(s[i],s[j]);
                //根据t向量打乱s盒 
        }
        unsigned char k[64];//保存秘钥流，或者直接进行异或 
        i = 0; j = 0; 
        int tmp;
        int index ;
        for ( index = 0; index &lt; mlen; index++) {   //生成与明文长度一致的秘钥流 
                i = (i + 3) % 256;
                j = (j + s[i]+1) % 256;
                swap(s[i],s[j]); 
                tmp = (s[i] + s[j]) % 256;
                k[index] = s[tmp];//保存秘钥 
        }
        for (i = 0; i &lt; mlen; i++)
        {
                m[i] = m[i] ^ k[i];//主要进行了一步异或，加密的逆过程就是解密 
        }
}
int main()
{
        char c[27]={0x4d,0xffffffe6,0x49,0xffffff95,0x3,0x2d,0x2b,0xffffffba,0xffffffea,0x6d,0xffffffff,0x59,0x70,0x0,0x1b,0xffffffa9,0x2c,0xffffffb0,0x32,0xffffff98,0x6f,0xffffff8c,0x56,0xffffffa2,0x4c,0x79,0x7f };
        int i;
        for(i=26;i&gt;=0;i--)
        {
                c[i] = c[(i+1)%27]^c[i];
        }
        for(i=0;i&lt;27;i++)
        {
                printf("0x%x,",c[i]) ;
        }
        O0oo00OOo00o0((unsigned char *)c,27,16);
        printf("\n");
                for(i=0;i&lt;27;i++)
        {
                printf("%c",c[i]&amp;0xff) ;
        }
}
</code></pre>
<p>It base on static crack here, but a bro told me that since there is only <c style="color: #FF0000;">ONE</c>  <code>XOR</code>  that really do something to your flag, you can dynamic debug to get the array  <code>v4</code> . (in the upper encryption photograth) Which is really genius because whether you know how to decrypt rc4 or not you can solve this problem and it do save you tons of work!</p>
<h6 id="just-input-a-series-of-1-and-look-into-the-ecx-register"><a class="markdownIt-Anchor" href="#just-input-a-series-of-1-and-look-into-the-ecx-register">#</a> Just input a series of ‘1’ and look into the  <code>ECX</code>  register!</h6>
<p><img src="/hnctfRe/dynamic_1.webp" alt="dynamic_1"><br>
<img src="/hnctfRe/dynamic_2.webp" alt="dynamic_2"><br>
<img src="/hnctfRe/dynamic_3.webp" alt="dynamic_3"><br>
<img src="/hnctfRe/dynamic_4.webp" alt="dynamic_4"><br>
<img src="/hnctfRe/dynamic_5.webp" alt="dynamic_5"></p>
<h5 id="and-so-on"><a class="markdownIt-Anchor" href="#and-so-on">#</a> And so on…</h5>
<pre><code>###### Two thinkings(should be tried out later):
###### Can `angr` solve `rc4` immediately?
###### Can I add a `hook` so it prints the `ECX` rightaway and I don't need to check it once and once again?
######                                                                                          --2022.11.4
</code></pre>
<p>From here, the last few problems are quite hard…</p>
<h3 id="maze"><a class="markdownIt-Anchor" href="#maze">#</a> MAZE</h3>
<p>We found thounds of junkcodes here, and we nop them:</p>
<pre><code>import idc
import idautils
start =0x00140001000
end = 0x00140CEF1F0
bad=[0x50,0x48,0x0f,0xc7,0xf0,0x58]

for i in range(start,end):
    if idc.get_wide_byte(i) == 0x50:
        flag=1
        for j in range(len(bad)):
            if(idc.get_wide_byte(i+j)!= bad[j]):
                flag=0
                break
        if flag==1:
            for j in range(len(bad)):
                patch_byte(i+j,0x90)
                print("success")
</code></pre>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Moyao
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://demoyao100.github.io/hnctfRe/" title="hnctfRe">https://demoyao100.github.io/hnctfRe/</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/re/" rel="tag"># re</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/pythonJail/" rel="prev" title="pythonJail">
                  <i class="fa fa-angle-left"></i> pythonJail
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/capstone/" rel="next" title="capstone">
                  capstone <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    © 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Moyao</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>





</body></html>